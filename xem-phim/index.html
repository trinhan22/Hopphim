<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đang xem phim - HopPhim</title>
    
    <meta property="og:title" content="HopPhim - Phim Hay Trong Tầm Tay" />
    <meta property="og:description" content="Trang xem phim trực tuyến miễn phí chất lượng cao." />
    <meta property="og:image" content="https://hopphim.netlify.app/panel.webp" />
    <meta property="og:url" content="https://hopphim.netlify.app" />
    <meta property="og:type" content="article" />

    <link rel="icon" type="image/webp" href="/LOGO.WEBP" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CSS GLOBAL --- */
        :root {
            --bg-body: #191b24; 
            --bg-dark: #0f111a; 
            --text-main: #ffffff; 
            --text-sub: #a0a0a0; 
            --bg-card: #23252f;
            --gradient-main: linear-gradient(90deg, #FF8F50, #FF5E62); 
            --primary-color: #FF5E62;
            --radius: 12px;
            --font-main: 'Inter', sans-serif;
            --mobile-menu-bg: #15171e; 
            --mobile-border: rgba(255,255,255,0.05);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); overflow-x: hidden; }
        .text-gradient { background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: inline-block; }

        /* --- QUẢNG CÁO (ADS) --- */
        #ad-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); 
            display: flex; justify-content: center; align-items: center;
            z-index: 99999; transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        #ad-container {
            width: 90%; height: 90%; max-width: 900px; max-height: 506px;
            background-color: #000; border-radius: 12px; overflow: hidden; position: relative; 
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); transform: scale(1); transition: transform 0.5s ease;
        }
        #ad-image { width: 100%; height: 100%; object-fit: cover; display: block; z-index: 10; cursor: pointer; }
        #skip-button, #go-to-website-button {
            position: absolute; top: 10px; padding: 8px 12px; background-color: rgba(0, 0, 0, 0.85); 
            color: white; border: none; border-radius: 4px; font-weight: 600; font-size: 14px; 
            cursor: pointer; z-index: 1000; transition: all 0.2s ease;
        }
        #go-to-website-button { left: 10px; }
        #skip-button { right: 10px; cursor: not-allowed; }
        #skip-button.enabled { background-color: #FF8F50; cursor: pointer; }
        
        /* --- LOADING & TOAST --- */
        #loadingScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--bg-body); z-index: 9990; display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 15px; }
        .loading-img { width: 300px; max-width: 80vw; height: auto; object-fit: contain; animation: zoomIn 0.8s forwards, floatIdle 4s infinite 0.8s; }
        .loading-img.zoom-out { animation: zoomOut 0.5s forwards !important; }
        @keyframes zoomIn { 0% { transform: scale(3); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes zoomOut { to { transform: scale(0); opacity: 0; } }
        @keyframes floatIdle { 0%, 100% { transform: scale(1); } 50% { transform: scale(0.9); } }

        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: #23252f; color: #fff; padding: 15px 25px; border-radius: 12px; display: flex; align-items: center; gap: 12px; min-width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-left: 4px solid var(--primary-color); animation: slideInRight 0.3s ease; pointer-events: auto; }
        .toast.success { border-left-color: #2ecc71; } .toast.error { border-left-color: #ff4757; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- CONFIRM POPUP --- */
        .custom-confirm-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 10001; display: none; justify-content: center; align-items: center; opacity: 0; transition: 0.3s; backdrop-filter: blur(5px); }
        .custom-confirm-overlay.active { display: flex; opacity: 1; }
        .confirm-box { background: #1f222e; width: 90%; max-width: 400px; padding: 30px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .custom-confirm-overlay.active .confirm-box { transform: scale(1); }
        .confirm-icon { font-size: 3rem; margin-bottom: 15px; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .confirm-title { font-size: 1.2rem; font-weight: 700; color: #fff; margin-bottom: 10px; }
        .confirm-desc { font-size: 0.95rem; color: var(--text-sub); margin-bottom: 25px; line-height: 1.5; }
        .confirm-actions { display: flex; gap: 15px; justify-content: center; }
        .btn-confirm { padding: 10px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; font-size: 0.95rem; }
        .btn-cancel { background: transparent; color: #ccc; border: 1px solid rgba(255,255,255,0.2); } .btn-cancel:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-ok { background: var(--gradient-main); color: #fff; box-shadow: 0 4px 15px rgba(255, 94, 98, 0.3); } .btn-ok:hover { transform: translateY(-2px); }

        /* --- MODAL POPUP --- */
        .modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(15, 17, 26, 0.95); padding: 40px; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .modal-grid .movie-card { width: 100%; height: 280px; }

        /* --- HEADER PC --- */
        header { position: fixed; top: 0; width: 100%; height: 70px; padding: 0 4%; display: flex; justify-content: space-between; align-items: center; z-index: 1000; background: var(--bg-dark); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        .header-left-group { display: flex; align-items: center; gap: 30px; height: 100%; }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo img { height: 40px; object-fit: contain; }
        .logo-text { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Nav Links */
        .nav-links { display: flex; gap: 15px; list-style: none; height: 100%; align-items: center; }
        
        /* Item của Menu */
        .nav-item { 
            position: relative; height: 100%; display: flex; align-items: center; 
            padding: 0 10px; cursor: pointer;
        }
        
        .nav-link { 
            color: #ccc; text-decoration: none; font-size: 14px; font-weight: 600; 
            text-transform: uppercase; transition: 0.3s; white-space: nowrap; 
            display: flex; align-items: center; gap: 5px;
        }
        .nav-item:hover .nav-link { color: #fff; }
        .nav-link i { font-size: 0.8rem; margin-top: -2px; }

        /* DROPDOWN MENU (BẢNG XỔ XUỐNG) */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 70px; /* Bằng chiều cao header */
            left: 0;
            background: rgba(15, 17, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-top: 2px solid var(--primary-color);
            padding: 20px;
            border-radius: 0 0 12px 12px;
            width: 500px; /* Chiều rộng bảng */
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform-origin: top left;
            animation: fadeIn 0.2s ease-out;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Cột */
            gap: 12px;
        }

        .dropdown-item-link {
            color: #a0a0a0; text-decoration: none; font-size: 0.9rem; transition: 0.2s;
            padding: 5px 8px; border-radius: 6px;
        }
        .dropdown-item-link:hover {
            color: #fff; background: rgba(255,255,255,0.1);
        }

        /* Hover vào Nav Item thì hiện Dropdown */
        .nav-item:hover .dropdown-menu { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .right-elements { display: flex; align-items: center; gap: 15px; }
        .search-box { display: flex; align-items: center; background: #23252f; padding: 8px 16px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); }
        .search-box input { background: transparent; border: none; color: #fff; margin-left: 10px; font-family: var(--font-main); font-size: 14px; width: 150px; }
        .menu-toggle, .mobile-search-trigger { display: none; font-size: 1.5rem; color: #fff; cursor: pointer; }
        
        .btn-login { background: var(--gradient-main); color: #fff; border: none; padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: 0.3s; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary-color); cursor: pointer; display: none; object-fit: cover; }
        .user-dropdown { position: absolute; top: 100%; right: 0; width: 200px; margin-top: 15px; background: #23252f; border-radius: 8px; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .user-dropdown.active { display: flex; }
        .user-info-item { padding: 12px; color: #fff; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .dropdown-item { background: transparent; border: none; color: #ccc; text-align: left; padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        

        /* --- MOBILE OVERLAYS --- */
        .mobile-overlay { display: none; position: fixed; inset: 0; z-index: 3000; transition: 0.3s ease-in-out; }
        .mobile-overlay.active { transform: translateX(0) !important; opacity: 1 !important; }
        .close-btn-overlay { position: absolute; font-size: 1.8rem; color: #fff; cursor: pointer; z-index: 10; }
        
        #mobileMenuOverlay { display: block; background: var(--mobile-menu-bg); transform: translateX(-100%); padding: 25px; width: 300px; box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
        .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .menu-logo { display: flex; align-items: center; gap: 10px; } .menu-logo img { height: 35px; } .menu-logo span { font-weight: 800; font-size: 1.2rem; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #mobileMenuOverlay .close-btn-overlay { position: static; color: #fff; opacity: 0.7; }
        .member-btn-large { width: 100%; padding: 12px; background: linear-gradient(90deg, #FF8F50, #FF5E62); color: #fff; border: none; border-radius: 8px; font-weight: 700; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 25px; cursor: pointer; }
        .mobile-menu-grid { display: flex; flex-direction: column; gap: 5px; max-height: 80vh; overflow-y: auto; }
        .mobile-menu-link { color: #ccc; text-decoration: none; font-weight: 600; font-size: 1rem; padding: 12px 0; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--mobile-border); }
        .mobile-menu-link i { width: 25px; color: var(--primary-color); text-align: center; }

        #mobileSearchOverlay { display: block; background: #1f212d; transform: translateY(-100%); opacity: 0; }
        #mobileSearchOverlay.active { transform: translateY(0) !important; opacity: 1 !important; }
        .search-header-mobile { display: flex; align-items: center; padding: 15px 20px; background: #2a2d3a; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .search-input-mobile { flex: 1; background: transparent; border: none; color: #fff; font-size: 1rem; font-family: var(--font-main); margin-right: 15px; }
        #mobileSearchOverlay .close-btn-overlay { position: static; color: #fff; }

        /* --- XEM PHIM LAYOUT --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 4%; }
        .watch-wrapper { display: grid; grid-template-columns: 2.8fr 1.2fr; gap: 30px; padding-top: 100px; padding-bottom: 50px; }
        
        .player-box { background: #000; border-radius: var(--radius); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; position: relative; }
        .aspect-ratio-16-9 { width: 100%; padding-top: 56.25%; position: relative; }
        .aspect-ratio-16-9 iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        /* Movie Info Block */
        .movie-info-block { position: relative; background: #161823; padding: 30px; border-radius: 16px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; }
        .movie-info-bg { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0.20; filter: blur(10px) saturate(150%); pointer-events: none; }
        .movie-info-content { position: relative; z-index: 1; }
        .movie-breadcrumbs { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 15px; display: flex; gap: 8px; align-items: center; }
        .movie-breadcrumbs a { color: #ccc; text-decoration: none; } .movie-breadcrumbs a:hover { color: var(--primary-color); }
        .movie-title-large { font-size: 2.4rem; font-weight: 900; margin-bottom: 5px; line-height: 1.2; text-transform: uppercase; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .movie-origin-name { font-size: 1.1rem; color: #a0a0a0; margin-bottom: 20px; font-weight: 600; }
        .movie-tags { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; align-items: center; }
        .tag-item { padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 700; color: #ccc; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.05); }
        .tag-highlight { background: var(--gradient-main); color: #fff; border: none; }
        .movie-description { color: #d1d5db; line-height: 1.7; font-size: 1rem; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; border-left: 3px solid var(--primary-color); }

        .episode-block { background: var(--bg-card); padding: 25px; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; }
        .section-header { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; border-left: 4px solid var(--primary-color); padding-left: 10px; color: #fff; display: flex; justify-content: space-between; align-items: center; }
        .episode-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; }
        .ep-btn { background: #191b24; color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 10px 0; text-align: center; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .ep-btn:hover, .ep-btn.active { background: var(--gradient-main); border-color: transparent; }

        /* Comment Section */
        .comment-section { background: #161823; padding: 30px; border-radius: 16px; margin-top: 30px; border: 1px solid rgba(255,255,255,0.05); }
        .comment-header-title { font-size: 1.2rem; font-weight: 700; color: #fff; margin-bottom: 25px; display: flex; align-items: center; gap: 10px; border-left: 4px solid var(--primary-color); padding-left: 15px; }
        .comment-input-box { display: flex; gap: 20px; margin-bottom: 40px; align-items: flex-start; }
        .current-user-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color); }
        .comment-form { flex: 1; background: #1f222e; border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .comment-input { width: 100%; background: transparent; border: none; color: #fff; font-family: var(--font-main); font-size: 0.95rem; resize: none; min-height: 60px; outline: none; }
        .form-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); }
        .btn-send-cmt { background: var(--gradient-main); color: #fff; border: none; padding: 8px 24px; border-radius: 20px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .comment-list { display: flex; flex-direction: column; gap: 25px; }
        .comment-item { display: flex; gap: 15px; animation: fadeIn 0.5s ease; }
        .comment-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 1px solid rgba(255,255,255,0.1); }
        .comment-body { flex: 1; }
        .comment-meta { display: flex; align-items: baseline; gap: 10px; margin-bottom: 5px; }
        .comment-author { font-weight: 700; font-size: 0.95rem; color: #fff; }
        .comment-text { color: #ccc; font-size: 0.95rem; line-height: 1.5; background: rgba(255,255,255,0.03); padding: 12px 15px; border-radius: 0 12px 12px 12px; display: inline-block; }
        
        /* Sidebar Card */
        .sidebar-right { position: sticky; top: 90px; height: fit-content; }
        .sidebar-card { display: flex; gap: 15px; margin-bottom: 15px; padding: 10px; background: var(--bg-card); border-radius: 8px; transition: 0.2s; cursor: pointer; border: 1px solid transparent; }
        .sidebar-card:hover { background: #2a2d3a; border-color: rgba(255, 94, 98, 0.3); transform: translateX(-5px); }
        .sb-thumb { width: 70px; height: 100px; flex-shrink: 0; border-radius: 6px; overflow: hidden; }
        .sb-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .sb-info { display: flex; flex-direction: column; justify-content: center; }
        .sb-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; color: #fff; }
        .sb-meta { font-size: 0.8rem; color: var(--text-sub); }

        footer { background: var(--bg-dark); padding: 60px 4% 20px; margin-top: 50px; border-top: 1px solid #23252f; font-size: 0.9rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px; margin-bottom: 40px; }
        .footer-col h3 { font-size: 1.1rem; color: #fff; margin-bottom: 20px; font-weight: 700; }
        .footer-brand { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .footer-brand img { height: 50px; object-fit: contain; }
        .footer-col ul { list-style: none; } .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: var(--text-sub); text-decoration: none; transition: 0.3s; } .footer-col ul li a:hover { color: var(--primary-color); }
        .footer-bottom { border-top: 1px solid #23252f; padding-top: 20px; display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 0.8rem; }
        
        @media (max-width: 900px) {
            header { height: 60px; padding: 0 4%; justify-content: space-between; }
            .header-left-group { gap: 25px; order: 1; }
            .menu-toggle { display: block; font-size: 1.5rem; }
            .logo { order: 2; margin: 0; } .logo img { height: 32px; } .logo-text { display: block; font-size: 1.2rem; }
            .right-elements { order: 3; gap: 15px; }
            .mobile-search-trigger { display: block; font-size: 1.2rem; }
            .nav-links, .search-box, .desktop-auth { display: none !important; }
            #mobileMenuOverlay, #mobileSearchOverlay { display: block; }
            .watch-wrapper { grid-template-columns: 1fr; padding-top: 80px; gap: 20px; }
            .movie-title-large { font-size: 1.8rem; }
            .movie-info-block { padding: 20px; }
            .player-box { order: 1; }
            .episode-block-mobile { order: 2; display: block !important; margin-bottom: 20px; }
            .comment-section { order: 4; }
            .sidebar-right { order: 5; position: static; }
            .episode-block-desktop { display: none; }
            .footer-grid { grid-template-columns: 1fr 1fr; gap: 20px; }
            .footer-col:first-child { grid-column: span 2; text-align: center; }
            .footer-brand { justify-content: center; }
        }
        @media (min-width: 901px) { .episode-block-mobile { display: none; } }
    </style>
</head>
<body>
    
    <div id="ad-overlay">
        <div id="ad-container">
            <button id="go-to-website-button">Go to website</button>
            <button id="skip-button" disabled>Skip ad (<span>3</span>)</button>
            <img id="ad-image" alt="Quảng cáo" title="Nhấn để xem chi tiết">
        </div>
    </div>

    <div id="loadingScreen">
    </div>

    <div id="toast-container"></div>

    <div id="confirmModal" class="custom-confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-icon"><i class="fas fa-exclamation-circle"></i></div>
            <h3 class="confirm-title">Xác nhận</h3>
            <p class="confirm-desc" id="confirmMsg">Bạn có chắc chắn muốn thực hiện hành động này?</p>
            <div class="confirm-actions">
                <button class="btn-confirm btn-cancel" id="btnConfirmNo">Hủy bỏ</button>
                <button class="btn-confirm btn-ok" id="btnConfirmYes">Đồng ý</button>
            </div>
        </div>
    </div>

    <div id="mobileMenuOverlay" class="mobile-overlay">
        <div class="menu-header">
            <div class="menu-logo"><img src="/LOGO.WEBP" alt="HopPhim"><span>HOPPHIM</span></div>
             <i class="fas fa-times close-btn-overlay" onclick="closeMobileMenu()"></i>
        </div>
        <button class="member-btn-large" id="mobileMemberBtn" onclick="window.location.href='/login.html'">
            <i class="fas fa-user-circle"></i> <span id="mobileMemberText">Đăng nhập / Đăng ký</span>
        </button>
        <div class="mobile-menu-grid">
            <a href="/" class="mobile-menu-link" onclick="closeMobileMenu()"><i class="fas fa-home"></i> Trang chủ</a>
            
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu()"><i class="fas fa-tv"></i> Phim Bộ</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu()"><i class="fas fa-film"></i> Phim Lẻ</a>

            <div style="border-bottom: 1px solid var(--mobile-border); padding: 10px 0; color:#666; font-size:0.9rem; font-weight:700; text-transform:uppercase;">Thể Loại</div>
            <a href="/" class="mobile-menu-link"><i class="fas fa-fist-raised"></i> Hành Động</a>
            <a href="/" class="mobile-menu-link"><i class="fas fa-heart"></i> Tình Cảm</a>
            <a href="/" class="mobile-menu-link"><i class="fas fa-ghost"></i> Kinh Dị</a>

            <div style="border-bottom: 1px solid var(--mobile-border); padding: 10px 0; color:#666; font-size:0.9rem; font-weight:700; text-transform:uppercase; margin-top:10px;">Quốc Gia</div>
            <a href="/" class="mobile-menu-link"><i class="fas fa-globe-asia"></i> Hàn Quốc</a>
            <a href="/" class="mobile-menu-link"><i class="fas fa-torii-gate"></i> Trung Quốc</a>
            <a href="/" class="mobile-menu-link"><i class="fas fa-globe-americas"></i> Âu Mỹ</a>

            <div style="border-bottom: 1px solid var(--mobile-border); padding: 10px 0; color:#666; font-size:0.9rem; font-weight:700; text-transform:uppercase; margin-top:10px;">Quản Lý</div>
            <a href="hopteam.html" class="mobile-menu-link" onclick="closeMobileMenu()"><i class="fas fa-users"></i> Về HopTeam</a>
            <a href="/profile.html" class="mobile-menu-link" id="mobileAccountLink" style="display: none;" onclick="closeMobileMenu()"><i class="fas fa-user-cog"></i> Quản lý tài khoản</a>
        </div>
    </div>

    <div id="mobileSearchOverlay" class="mobile-overlay">
        <div class="search-header-mobile">
            <i class="fas fa-search" style="color: #a0a0a0; margin-right: 10px;"></i>
            <input type="text" id="mobileSearchInput" class="search-input-mobile" placeholder="Nhập tên phim...">
            <i class="fas fa-times close-btn-overlay" onclick="closeMobileSearch()"></i>
        </div>
        <div class="search-content-mobile"><div id="mobileSearchResults"></div></div>
    </div>

    <header id="header">
        <div class="header-left-group">
            <div class="menu-toggle" onclick="openMobileMenu()"><i class="fas fa-bars"></i></div>
            <div class="logo" onclick="window.location.href='/'">
                <img src="/LOGO.WEBP" alt="HopPhim"><span class="logo-text">HOPPHIM</span>
            </div>
            
            <ul class="nav-links" id="navLinks">
                <li class="nav-item">
                    <a href="/" class="nav-link">Trang chủ</a>
                </li>
                
                <li class="nav-item">
                    <div class="nav-link">Thể loại <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu">
                        <div class="dropdown-grid">
                            <a href="/" class="dropdown-item-link">Hành Động</a>
                            <a href="/" class="dropdown-item-link">Tình Cảm</a>
                            <a href="/" class="dropdown-item-link">Hài Hước</a>
                            <a href="/" class="dropdown-item-link">Cổ Trang</a>
                            <a href="/" class="dropdown-item-link">Tâm Lý</a>
                            <a href="/" class="dropdown-item-link">Hình Sự</a>
                            <a href="/" class="dropdown-item-link">Chiến Tranh</a>
                            <a href="/" class="dropdown-item-link">Thể Thao</a>
                            <a href="/" class="dropdown-item-link">Võ Thuật</a>
                            <a href="/" class="dropdown-item-link">Viễn Tưởng</a>
                            <a href="/" class="dropdown-item-link">Phiêu Lưu</a>
                            <a href="/" class="dropdown-item-link">Khoa Học</a>
                            <a href="/" class="dropdown-item-link">Kinh Dị</a>
                            <a href="/" class="dropdown-item-link">Âm Nhạc</a>
                            <a href="/" class="dropdown-item-link">Thần Thoại</a>
                            <a href="/" class="dropdown-item-link">Tài Liệu</a>
                            <a href="/" class="dropdown-item-link">Gia Đình</a>
                            <a href="/" class="dropdown-item-link">Học Đường</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="/" class="nav-link">Phim Lẻ</a></li>
                <li class="nav-item"><a href="/" class="nav-link">Phim Bộ</a></li>
                <li class="nav-item"><a href="/" class="nav-link">Hoạt Hình</a></li>
                <li class="nav-item"><a href="/" class="nav-link">TV Shows</a></li>

                <li class="nav-item">
                    <div class="nav-link">Quốc gia <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu" style="width: 400px;">
                        <div class="dropdown-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <a href="/" class="dropdown-item-link">Trung Quốc</a>
                            <a href="/" class="dropdown-item-link">Hàn Quốc</a>
                            <a href="/" class="dropdown-item-link">Nhật Bản</a>
                            <a href="/" class="dropdown-item-link">Thái Lan</a>
                            <a href="/" class="dropdown-item-link">Âu Mỹ</a>
                            <a href="/" class="dropdown-item-link">Đài Loan</a>
                            <a href="/" class="dropdown-item-link">Hồng Kông</a>
                            <a href="/" class="dropdown-item-link">Ấn Độ</a>
                            <a href="/" class="dropdown-item-link">Việt Nam</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="../hopteam.html" class="nav-link">Về HopTeam</a></li>
            </ul>
        </div>
        <div class="right-elements">
            <div class="mobile-search-trigger" onclick="openMobileSearch()"><i class="fas fa-search"></i></div>
            <div class="search-box">
                <i class="fas fa-search" style="color: #a0a0a0"></i>
                <input type="text" placeholder="Tìm kiếm phim..." onclick="alert('Vui lòng tìm kiếm tại Trang chủ')">
            </div>
            <div class="desktop-auth" style="position: relative;">
                <button id="btnLogin" class="btn-login" onclick="window.location.href='/login.html'">Đăng nhập</button>
                <img id="userAvatar" class="user-avatar" src="" alt="User" onclick="toggleUserDropdown()">
                <div id="userMenu" class="user-dropdown">
                    <div id="userNameDisplay" class="user-info-item">User</div>
                    <button class="dropdown-item" onclick="window.location.href='/profile.html'"><i class="fas fa-user-cog"></i> Tài khoản</button>
                    <button class="dropdown-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="watch-wrapper">
            
            <div class="main-content">
                <div class="player-box">
                    <div class="aspect-ratio-16-9">
                        <iframe id="videoPlayer" src="" allowfullscreen></iframe>
                    </div>
                </div>

                <div class="episode-block episode-block-mobile">
                    <div class="section-header">
                        <span>Danh sách tập</span>
                        <span class="server-name"><i class="fas fa-server"></i> Server VIP</span>
                    </div>
                    <div class="episode-grid" id="episodeListMobile"></div>
                </div>

                <div class="movie-info-block">
                    <div id="movieInfoBg" class="movie-info-bg"></div>
                    
                    <div class="movie-info-content">
                        <div class="movie-breadcrumbs">
                            <a href="/">Trang chủ</a> <i class="fas fa-chevron-right" style="font-size: 0.7rem; color: #555;"></i> <span id="breadCrumbTitle">Đang xem</span>
                        </div>
                        <h1 class="movie-title-large" id="mName">Loading...</h1>
                        <div class="movie-origin-name" id="mOrigin">Loading...</div>
                        
                        <div class="movie-tags" id="mTags"></div>
                        
                        <div class="movie-description">
                            <h4 style="color:#fff; margin-bottom:10px; font-size:1rem;">Nội dung phim</h4>
                            <span id="mContent">Đang tải nội dung phim...</span>
                        </div>
                    </div>
                </div>

                <div class="comment-section">
                    <div class="comment-header-title">
                        <i class="fas fa-comments" style="color: var(--primary-color);"></i> 
                        Bình luận
                    </div>
                    
                    <div class="comment-input-box">
                        <img src="/Guest.webp" id="cmtMyAvatar" class="current-user-avatar">
                        <div class="comment-form">
                            <textarea id="cmtInput" class="comment-input" placeholder="Viết bình luận của bạn về phim này..."></textarea>
                            <div class="form-actions">
                                <span style="font-size: 0.8rem; color: #666;">Nói tầm xàm, ba láp tao BAN gáng chịu.</span>
                                <button class="btn-send-cmt" onclick="sendComment()">
                                    Gửi <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="comment-list" id="commentList">
                        <div class="empty-comment">
                            <i class="fas fa-spinner fa-spin"></i>
                            Đang tải bình luận...
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-right">
                <div class="episode-block episode-block-desktop">
                    <div class="section-header">
                        <span>Danh sách tập</span>
                        <span class="server-name"><i class="fas fa-server"></i> Server VIP</span>
                    </div>
                    <div class="episode-grid" id="episodeListDesktop"></div>
                </div>

                <div class="section-header" style="border-left-color: #FF8F50; margin-bottom: 15px;">
                    <span style="font-size: 1.1rem;">Đề xuất cho bạn</span>
                </div>
                <div id="relatedList"></div>
            </div>

        </div>
    </div>

    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <div class="footer-brand"><img src="/logo.webp" alt="HopPhim"><span class="logo-text">HOPPHIM</span></div>
                <p style="color: #a0a0a0; line-height: 1.6; margin-top: 15px;">
                    Trang xem phim trực tuyến miễn phí chất lượng cao.
                </p>
            </div>
            <div class="footer-col">
                <h3>Danh mục</h3>
                <ul>
                    <li><a href="/">Phim Mới Cập Nhật</a></li>
                    <li><a href="/">Phim Chiếu Rạp</a></li>
                    <li><a href="/">Phim Bộ Độc Quyền</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Quốc gia</h3>
                <ul>
                    <li><a href="/">Hàn Quốc</a></li>
                    <li><a href="/">Trung Quốc</a></li>
                    <li><a href="/">Âu Mỹ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Hỗ trợ</h3>
                <ul>
                    <li><a href="../lienhequangcao.html">Liên hệ quảng cáo</a></li>
                    <li><a href="../baoloi.html">Báo lỗi</a></li>
                    <li><a href="../hopteam.html">Về HopTeam</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom"><p>&copy; 2026 HopPhim. All Rights Reserved By HopTeam.</p></div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc, addDoc, collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // 1. CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAT6SnKojUmsisDhnuEtsL3H59NwrhZxDc",
            authDomain: "hopphim-29e1c.firebaseapp.com",
            projectId: "hopphim-29e1c",
            storageBucket: "hopphim-29e1c.firebasestorage.app",
            messagingSenderId: "1076044580405",
            appId: "1:1076044580405:web:a3485f8533604f305e537c",
            measurementId: "G-6RT4CX2NR0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 2. CONSTANTS
        const API_BASE = 'https://ophim1.com/v1/api/phim';
        const IMG_BASE = 'https://img.ophim1.com/uploads/movies/';
        
        // UI Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const btnLogin = document.getElementById('btnLogin');
        const userAvatar = document.getElementById('userAvatar');
        const userMenu = document.getElementById('userMenu');
        const mobileMemberBtn = document.getElementById('mobileMemberBtn');
        const mobileMemberText = document.getElementById('mobileMemberText');
        const mobileAccountLink = document.getElementById('mobileAccountLink');
        const cmtMyAvatar = document.getElementById('cmtMyAvatar');

        let currentUser = null;

        // 3. SLUG LOGIC (CRITICAL FOR COMMENTS & LOADING)
        const urlParams = new URLSearchParams(window.location.search);
        let movieSlug = urlParams.get('slug');

        if (!movieSlug) {
            const path = window.location.pathname;
            const parts = path.split('/').filter(part => part !== '');
            const lastPart = parts[parts.length - 1];
            if (lastPart && lastPart !== 'index.html' && lastPart !== 'xem-phim') {
                movieSlug = lastPart;
            }
        }

        if (!movieSlug) {
            alert('Không tìm thấy phim!');
            window.location.href = '/'; 
        }

        // 4. AUTH & USER STATE
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const photo = user.photoURL || '/Guest.webp';
                const name = user.displayName || 'Thành viên';

                btnLogin.style.display = 'none';
                userAvatar.style.display = 'block';
                userAvatar.src = photo;
                document.getElementById('userNameDisplay').innerText = name;
                
                mobileMemberText.innerText = name;
                mobileMemberBtn.innerHTML = `<img src="${photo}" style="width:30px;height:30px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color)"> <span>${name}</span>`;
                mobileMemberBtn.onclick = () => window.location.href = '/profile.html';
                mobileAccountLink.style.display = 'flex';
                
                cmtMyAvatar.src = photo; 
            } else {
                currentUser = null;
                btnLogin.style.display = 'block';
                userAvatar.style.display = 'none';
                userMenu.classList.remove('active');
                mobileMemberText.innerText = "Đăng nhập / Đăng ký";
                mobileMemberBtn.innerHTML = `<i class="fas fa-user-circle"></i> <span>Đăng nhập / Đăng ký</span>`;
                mobileMemberBtn.onclick = () => window.location.href='/login.html';
                mobileAccountLink.style.display = 'none';
                cmtMyAvatar.src = '/Guest.webp';
            }
        });

        // 5. GLOBAL FUNCTIONS
        window.logout = async () => {
            const ok = await window.customConfirm("Bạn có chắc chắn muốn đăng xuất?");
            if(ok) {
                await signOut(auth);
                userMenu.classList.remove('active');
                closeMobileMenu();
                window.showToast("Đã đăng xuất!", "success");
            }
        }
        window.toggleUserDropdown = () => userMenu.classList.toggle('active');

        window.showToast = (msg, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        window.customConfirm = (message) => {
            return new Promise((resolve) => {
                const overlay = document.getElementById('confirmModal');
                document.getElementById('confirmMsg').innerText = message;
                overlay.classList.add('active');
                document.getElementById('btnConfirmYes').onclick = () => { overlay.classList.remove('active'); resolve(true); };
                document.getElementById('btnConfirmNo').onclick = () => { overlay.classList.remove('active'); resolve(false); };
            });
        }

        // --- COMMENT LOGIC ---
        window.sendComment = async () => {
            if(!currentUser) {
                window.showToast("Vui lòng đăng nhập để bình luận!", "error");
                return;
            }
            const text = document.getElementById('cmtInput').value.trim();
            if(!text) return;

            try {
                await addDoc(collection(db, "comments"), {
                    movieId: movieSlug, 
                    userId: currentUser.uid,
                    userName: currentUser.displayName || "Thành viên",
                    userAvatar: currentUser.photoURL || "/Guest.webp",
                    content: text,
                    timestamp: Date.now()
                });
                document.getElementById('cmtInput').value = '';
                window.showToast("Đã gửi bình luận!", "success");
            } catch(e) { 
                console.error(e);
                window.showToast("Lỗi gửi bình luận: " + e.message, "error"); 
            }
        }

        if(movieSlug) {
            const q = query(collection(db, "comments"), where("movieId", "==", movieSlug), orderBy("timestamp", "desc"));
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById('commentList');
                if(snapshot.empty) {
                    list.innerHTML = `<div class="empty-comment"><i class="fas fa-comment-slash"></i> Chưa có bình luận nào. Hãy là người đầu tiên!</div>`;
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const c = doc.data();
                    const timeAgo = timeSince(c.timestamp);
                    const badge = (c.userName === 'Admin') ? '<span class="badge-role">QTV</span>' : '';
                    
                    html += `
                        <div class="comment-item">
                            <img src="${c.userAvatar}" class="comment-avatar">
                            <div class="comment-body">
                                <div class="comment-meta">
                                    <span class="comment-author">${c.userName}</span>
                                    ${badge}
                                    <span class="comment-time">• ${timeAgo}</span>
                                </div>
                                <div class="comment-text">${c.content}</div>
                            </div>
                        </div>`;
                });
                list.innerHTML = html;
            });
        }

        // 6. MOVIE LOGIC
        async function loadMovie() {
            try {
                const res = await fetch(`${API_BASE}/${movieSlug}`);
                const data = await res.json();
                if (data.status) {
                    renderInfo(data.data.item);
                    renderEpisodes(data.data.item.episodes);
                    loadRelated();
                } else { window.showToast('Lỗi tải phim', 'error'); }
            } catch (e) { console.error(e); } finally { 
                if(loadingScreen) {
                    const img = loadingScreen.querySelector('.loading-img');
                    if(img) img.classList.add('zoom-out');
                    setTimeout(() => { loadingScreen.style.display = 'none'; }, 500);
                }
            }
        }

        function renderInfo(movie) {
            document.title = `Xem phim ${movie.name} - HopPhim`;
            document.getElementById('breadCrumbTitle').innerText = movie.name;
            document.getElementById('mName').innerText = movie.name;
            document.getElementById('mOrigin').innerText = `${movie.origin_name} (${movie.year})`;
            
            const contentBox = document.getElementById('mContent');
            const fullContent = movie.content || "Đang cập nhật...";
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = fullContent;
            const plainText = tempDiv.innerText || "";
            const words = plainText.split(/\s+/);
            
            if (words.length > 36) {
                const shortContent = words.slice(0, 36).join(" ") + "...";
                contentBox.innerHTML = `<span id="descContent">${shortContent}</span><span id="toggleDescBtn" style="color: var(--primary-color); cursor: pointer; font-weight: bold; margin-left: 8px;">Xem thêm</span>`;
                const toggleBtn = document.getElementById('toggleDescBtn');
                const descSpan = document.getElementById('descContent');
                toggleBtn.onclick = () => {
                    if (toggleBtn.innerText === "Xem thêm") {
                        descSpan.innerHTML = fullContent;
                        toggleBtn.innerText = "Thu gọn";
                    } else {
                        descSpan.innerText = shortContent;
                        toggleBtn.innerText = "Xem thêm";
                    }
                };
            } else {
                contentBox.innerHTML = fullContent;
            }

            let bgImg = movie.poster_url || movie.thumb_url;
            if (!bgImg.startsWith('http')) bgImg = `https://img.ophim1.com/uploads/movies/${bgImg}`;
            document.getElementById('movieInfoBg').style.backgroundImage = `url('${bgImg}')`;

            let tagsHtml = `<span class="tag-item tag-highlight">${movie.quality || 'HD'}</span>`;
            tagsHtml += `<span class="tag-item">${movie.lang || 'Vietsub'}</span>`;
            tagsHtml += `<span class="tag-item">${movie.year}</span>`;
            
            if (movie.category) movie.category.forEach(cat => { tagsHtml += `<span class="tag-item">${cat.name}</span>`; });
            if (movie.country && movie.country[0]) tagsHtml += `<span class="tag-item"><i class="fas fa-globe"></i> ${movie.country[0].name}</span>`;

            document.getElementById('mTags').innerHTML = tagsHtml;
            setTimeout(() => { if (currentUser) saveToHistory(movie); }, 3000);
        }

        function renderEpisodes(episodes) {
            if (!episodes || episodes.length === 0) return;
            const serverData = episodes[0].server_data;
            let html = '';
            const player = document.getElementById('videoPlayer');
            
            serverData.forEach((ep, index) => {
                if (index === 0) player.src = ep.link_embed;
                html += `<div class="ep-btn ${index === 0 ? 'active' : ''}" onclick="changeEp('${ep.link_embed}', this)">${ep.name}</div>`;
            });
            
            document.getElementById('episodeListMobile').innerHTML = html;
            document.getElementById('episodeListDesktop').innerHTML = html;
        }

        window.changeEp = function(link, btn) {
            document.getElementById('videoPlayer').src = link;
            document.querySelectorAll('.ep-btn').forEach(b => b.classList.remove('active'));
            const allBtns = document.querySelectorAll('.ep-btn');
            for(let b of allBtns) { if(b.innerText === btn.innerText) b.classList.add('active'); }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

// --- CẤU HÌNH DANH SÁCH ĐỀ XUẤT (SIDEBAR) ---
        // Bạn điền slug phim muốn hiển thị vào đây
        const MANUAL_RELATED = [
            "dia-nguc-doc-than-phan-5",
            "yet-hi",            
            "tieng-yeu-nay-anh-dich-duoc-khong",
            "con-say-mua-xuan",
            "kho-do-danh"
        ];

        async function loadRelated() {
            try {
                // Lấy thông tin từng phim trong danh sách MANUAL_RELATED
                const promises = MANUAL_RELATED.map(slug => fetch(`${API_BASE}/${slug}`));
                const results = await Promise.all(promises);
                
                // Chuyển đổi sang JSON
                const jsonResults = await Promise.all(results.map(res => res.json()));

                // Lọc ra những phim lấy dữ liệu thành công
                const validMovies = jsonResults
                    .filter(data => data.status && data.data && data.data.item)
                    .map(data => data.data.item);

                if (validMovies.length > 0) {
                    let html = '';
                    validMovies.forEach(m => {
                        // Xử lý ảnh thumb
                        let img = m.thumb_url;
                        if (!img.startsWith('http')) img = `https://img.ophim1.com/uploads/movies/${img}`;

                        // Tạo HTML
                        html += `
                            <div class="sidebar-card" onclick="window.location.href='/xem-phim/${m.slug}'">
                                <div class="sb-thumb"><img src="${img}" loading="lazy"></div>
                                <div class="sb-info">
                                    <div class="sb-title">${m.name}</div>
                                    <div class="sb-meta">${m.origin_name} (${m.year})</div>
                                    <div class="sb-views"><i class="fas fa-eye"></i> ${Math.floor(Math.random()*10000)}</div>
                                </div>
                            </div>`;
                    });
                    document.getElementById('relatedList').innerHTML = html;
                }
            } catch(e) {
                console.error("Lỗi tải đề xuất:", e);
            }
        }

        async function saveToHistory(movie) {
            if (!currentUser) return; 
            const movieData = {
                slug: movie.slug, name: movie.name, origin_name: movie.origin_name,
                thumb_url: movie.thumb_url, quality: movie.quality, year: movie.year,
                timestamp: Date.now() 
            };
            const userRef = doc(db, "users", currentUser.uid);
            try {
                const docSnap = await getDoc(userRef);
                let history = docSnap.exists() ? (docSnap.data().watchHistory || []) : [];
                history = history.filter(m => m.slug !== movie.slug);
                history.push(movieData);
                if (history.length > 20) history.shift();
                await setDoc(userRef, { watchHistory: history }, { merge: true });
            } catch (e) { console.error(e); }
        }

        function timeSince(date) {
            if (!date) return "Gần đây";
            const seconds = Math.floor((Date.now() - date) / 1000);
            if (seconds < 60) return "Vừa xong";
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return minutes + " phút trước";
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return hours + " giờ trước";
            return Math.floor(hours / 24) + " ngày trước";
        }

        const menuOverlay = document.getElementById('mobileMenuOverlay');
        const searchOverlay = document.getElementById('mobileSearchOverlay');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const mobileSearchResults = document.getElementById('mobileSearchResults');

        window.openMobileMenu = () => menuOverlay.classList.add('active');
        window.closeMobileMenu = () => menuOverlay.classList.remove('active');
        window.openMobileSearch = () => { searchOverlay.classList.add('active'); mobileSearchInput.focus(); }
        window.closeMobileSearch = () => { searchOverlay.classList.remove('active'); mobileSearchInput.value = ''; }

        // Start App
        loadMovie();
    </script>
    
    <script>
        // CẤU HÌNH QUẢNG CÁO
        const adConfig = {
            gifUrl: "https://hopvan.netlify.app/IMG/hero-video.gif",
            targetUrl: "https://hopvan.netlify.app/",
            skipTime: 3 
        };

        const adOverlay = document.getElementById('ad-overlay');
        const adImage = document.getElementById('ad-image');
        const skipButton = document.getElementById('skip-button');
        const goToWebsiteButton = document.getElementById('go-to-website-button'); 

        if (adOverlay && skipButton && goToWebsiteButton && adImage) { 
            adImage.src = adConfig.gifUrl;
            
            const countdownSpan = skipButton.querySelector('span');
            let timeLeft = adConfig.skipTime; 
            if (countdownSpan) countdownSpan.textContent = timeLeft;

            const countdownInterval = setInterval(() => {
                timeLeft -= 1;
                if (timeLeft > 0) {
                    if (countdownSpan) countdownSpan.textContent = timeLeft;
                    else skipButton.textContent = `Skip ad (${timeLeft})`;
                } else {
                    clearInterval(countdownInterval); 
                    skipButton.textContent = 'Skip ad'; 
                    skipButton.classList.add('enabled');
                    skipButton.removeAttribute('disabled'); 
                }
            }, 1000); 

            skipButton.addEventListener('click', (e) => {
                e.stopPropagation();
                if (skipButton.classList.contains('enabled')) closeAd();
            });

            goToWebsiteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                openTarget();
            });

            adImage.addEventListener('click', () => {
                openTarget();
            });

            function openTarget() {
                window.open(adConfig.targetUrl, '_blank'); 
                closeAd();
            }

            function closeAd() {
                adOverlay.style.opacity = '0'; 
                setTimeout(() => { adOverlay.style.display = 'none'; }, 500);
            }
        }
    </script>
</body>
</html>