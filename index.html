<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HopPhim - Phim Hay Trong T·∫ßm Tay</title>
    
    <meta property="og:title" content="HopPhim - Phim Hay Trong T·∫ßm Tay" />
    <meta property="og:description" content="Trang xem phim tr·ª±c tuy·∫øn mi·ªÖn ph√≠ ch·∫•t l∆∞·ª£ng cao." />
    <meta property="og:image" content="https://hopphim.netlify.app/panel.webp" />
    <meta property="og:url" content="https://hopphim.netlify.app" />
    <meta property="og:type" content="article" />

    <link rel="icon" type="image/webp" href="/LOGO.WEBP" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==========================================================================
           1. CSS CORE & VARIABLES (DESIGN SYSTEM)
           ========================================================================== 
        */
        :root {
            --bg-body: #191b24; 
            --bg-dark: #0f111a; 
            --bg-panel: #23252f; 
            --text-main: #ffffff; 
            --text-sub: #a0a0a0;
            --gradient-main: linear-gradient(135deg, #FF8F50 0%, #FF5E62 100%); 
            --primary-color: #FF5E62;
            --gold-color: linear-gradient(90deg, #FF8F50, #FF5E62);
            --font-main: 'Inter', sans-serif; 
            --card-radius: 12px;
            --mobile-menu-bg: #15171e;
            --mobile-border: rgba(255,255,255,0.05);
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --z-header: 5000;
            --z-modal: 10000;
            --z-hover-detail: 99999;
        }

        /* Basic Resets */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            outline: none; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            font-family: var(--font-main); 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            overflow-x: hidden; 
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        a { text-decoration: none; color: inherit; transition: var(--transition-smooth); }
        ul { list-style: none; }
        button { border: none; cursor: pointer; font-family: var(--font-main); }

        /* Custom Scroller */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* ==========================================================================
           2. UTILITY CLASSES & KEYFRAMES
           ========================================================================== 
        */
        .text-gradient { 
            background: var(--gradient-main); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            display: inline-block; 
            font-weight: 800;
        }

        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(1.1); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes floatIdle { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }
        @keyframes rotateBlur { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ==========================================================================
           3. TOAST & CONFIRM COMPONENTS
           ========================================================================== 
        */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 20000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { 
            background: #23252f; color: #fff; padding: 12px 22px; border-radius: 12px; 
            display: flex; align-items: center; gap: 12px; min-width: 280px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-left: 4px solid var(--primary-color); 
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1); pointer-events: auto; 
        }
        .toast.success { border-left-color: #2ecc71; }
        .toast.error { border-left-color: #ff4757; }
        .toast i { font-size: 1.2rem; }

        .custom-confirm-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 20001; 
            display: none; justify-content: center; align-items: center; 
            opacity: 0; transition: 0.3s; backdrop-filter: blur(8px); 
        }
        .custom-confirm-overlay.active { display: flex; opacity: 1; }
        
        .confirm-box { 
            background: #1f222e; width: 90%; max-width: 400px; padding: 35px; 
            border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); 
            transform: scale(0.9); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        }
        .confirm-icon { font-size: 3rem; margin-bottom: 15px; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .confirm-actions { display: flex; justify-content: center; gap: 15px; margin-top: 25px; }
        
        .btn-confirm { padding: 10px 25px; border-radius: 8px; font-weight: 700; transition: 0.3s; }
        .btn-cancel { background: rgba(255,255,255,0.1); color: #ccc; }
        .btn-cancel:hover { background: rgba(255,255,255,0.2); color: #fff; }
        .btn-ok { background: var(--gradient-main); color: #fff; box-shadow: 0 5px 15px rgba(255, 94, 98, 0.3); }
        .btn-ok:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 94, 98, 0.5); }

        /* ==========================================================================
           4. LOADING SCREEN
           ========================================================================== 
        */
        #loadingScreen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; 
            background: var(--bg-body); z-index: 9999; display: flex; 
            justify-content: center; align-items: center; 
        }
        .loading-img { 
            width: 800px; max-width: 80vw; height: auto; object-fit: contain; 
            animation: zoomIn 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards, floatIdle 4s ease-in-out infinite 0.8s; 
        }
        .loading-img.zoom-out { animation: zoomOut 0.5s cubic-bezier(0.6, -0.28, 0.74, 0.05) forwards !important; }
        @media (max-width: 900px) { .loading-img { width: 500px; } }
        @keyframes zoomIn { 0% { transform: scale(2); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes floatIdle { 0% { transform: scale(1); } 50% { transform: scale(0.85); } 100% { transform: scale(1); } }
        @keyframes zoomOut { from { transform: scale(1); opacity: 1; } to { transform: scale(2); opacity: 0; } }

        /* ==========================================================================
           5. HEADER (MOBILE REMASTERED)
           ========================================================================== 
        */
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; padding: 0 4%; 
            display: flex; justify-content: space-between; align-items: center; 
            z-index: 1000; background: transparent; transition: all 0.3s ease-in-out; 
        }
        header.scrolled { background: var(--bg-dark); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        
        /* Desktop Components */
        .header-left-group { display: flex; align-items: center; gap: 30px; height: 100%; }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; z-index: 1002; }
        .logo img { height: 40px; object-fit: contain; }
        .logo-text { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .nav-links { display: flex; gap: 15px; list-style: none; height: 100%; align-items: center; }
        .nav-item { position: relative; height: 100%; display: flex; align-items: center; padding: 0 10px; cursor: pointer; }
        .nav-link { color: #ccc; text-decoration: none; font-size: 14px; font-weight: 600; text-transform: uppercase; transition: 0.3s; white-space: nowrap; display: flex; align-items: center; gap: 5px; }
        .nav-item:hover .nav-link { color: #fff; }
        .nav-link i { font-size: 0.8rem; margin-top: -2px; }

        /* Dropdown */
        .dropdown-menu { display: none; position: absolute; top: 70px; left: 0; background: rgba(15, 17, 26, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-top: 2px solid var(--primary-color); padding: 20px; border-radius: 0 0 12px 12px; width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); transform-origin: top left; animation: fadeIn 0.2s ease-out; }
        .dropdown-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .dropdown-item-link { color: #a0a0a0; text-decoration: none; font-size: 0.9rem; transition: 0.2s; padding: 5px 8px; border-radius: 6px; }
        .dropdown-item-link:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .nav-item:hover .dropdown-menu { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .right-elements { display: flex; align-items: center; gap: 15px; }
        .search-box { display: flex; align-items: center; background: rgba(255,255,255,0.08); padding: 8px 18px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); }
        .search-box input { background: transparent; border: none; color: #fff; margin-left: 10px; font-family: var(--font-main); font-size: 14px; width: 150px; }
        
        .btn-login { background: var(--gradient-main); color: #fff; border: none; padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: 0.3s; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary-color); cursor: pointer; display: none; object-fit: cover; }
        .user-dropdown { position: absolute; top: 100%; right: 0; width: 220px; margin-top: 15px; background: #23252f; border-radius: 8px; padding: 5px; box-shadow: 0 15px 40px rgba(0,0,0,0.6); display: none; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .user-dropdown.active { display: flex; }
        .user-info-item { padding: 12px; color: #fff; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .dropdown-item { background: transparent; border: none; color: #ccc; text-align: left; padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        
        /* --- NEW MOBILE HEADER ELEMENTS --- */
        .mobile-left-container { display: none; align-items: center; gap: 12px; }
        .mobile-menu-toggle { font-size: 1.6rem; color: #fff; cursor: pointer; }
        .mobile-search-trigger { display: none; font-size: 1.5rem; color: #fff; cursor: pointer; }

        @media (max-width: 900px) {
            header { height: 65px; padding: 0 15px; justify-content: space-between; background: var(--bg-dark); }
            /* ·∫®n Desktop Elements */
            .header-left-group, .nav-links, .search-box, .desktop-auth { display: none !important; }
            
            /* Hi·ªán Mobile Left (Menu + Logo) */
            .mobile-left-container { display: flex !important; }
            .mobile-left-container .logo { position: static; transform: none; margin: 0; }
            .mobile-left-container .logo img { height: 32px; }
            .mobile-left-container .logo-text { font-size: 1.2rem; }

            /* Hi·ªán Mobile Right (Search) */
            .mobile-search-trigger { display: block !important; }
        }

        /* --- MOBILE MENU DRAWER (NEW STYLE) --- */
        .mobile-overlay { position: fixed; inset: 0; z-index: 10000; transition: 0.4s cubic-bezier(0.77, 0, 0.175, 1); visibility: hidden; }
        .mobile-overlay.active { visibility: visible; }
        
        #mobileMenuOverlay { 
            background: var(--mobile-menu-bg); 
            transform: translateX(-100%); 
            width: 300px; /* ƒê·ªô r·ªông drawer */
            height: 100%; 
            box-shadow: 20px 0 60px rgba(0,0,0,0.8);
            position: absolute; top: 0; left: 0;
            display: flex; flex-direction: column;
            transition: 0.4s cubic-bezier(0.77, 0, 0.175, 1);
        }
        #mobileMenuOverlay.active { transform: translateX(0); }

        .drawer-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .drawer-content { flex: 1; overflow-y: auto; padding: 10px 0; }
        
        /* User Profile Button in Drawer */
        .drawer-user-card { padding: 20px; }
        .drawer-user-btn {
            width: 100%; background: var(--gradient-main); border-radius: 8px;
            padding: 12px; display: flex; align-items: center; justify-content: center; gap: 10px;
            color: #fff; font-weight: 700; box-shadow: 0 5px 15px rgba(255, 94, 98, 0.4); cursor: pointer;
        }
        .drawer-user-btn img { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #fff; object-fit: cover; }

        .drawer-item { display: flex; align-items: center; gap: 15px; padding: 12px 25px; color: #ccc; text-decoration: none; font-weight: 600; font-size: 0.95rem; transition: 0.2s; }
        .drawer-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .drawer-item i { width: 20px; text-align: center; color: var(--primary-color); }
        .drawer-label { color: #666; font-size: 0.75rem; font-weight: 800; padding: 15px 25px 5px; text-transform: uppercase; margin-top: 10px; }
        
        .backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.7); opacity: 0; transition: 0.4s; z-index: -1; }
        .mobile-overlay.active .backdrop { opacity: 1; }

        /* --- MOBILE SEARCH OVERLAY (SLIDE DOWN) --- */
        #mobileSearchOverlay {
            position: fixed; inset: 0; z-index: 10001; background: #1f212d;
            transform: translateY(-100%); opacity: 0; transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 20px; display: flex; flex-direction: column;
        }
        #mobileSearchOverlay.active { transform: translateY(0); opacity: 1; }
        
        .ms-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .ms-input-group { display: flex; align-items: center; gap: 10px; flex: 1; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        .ms-input-group input { background: transparent; border: none; color: #fff; font-size: 1.2rem; width: 100%; outline: none; }

        /* ==========================================================================
           6. HERO SECTION & TOPICS (GLASS REDESIGN)
           ========================================================================== 
        */
        .hero { 
            height: 75vh; display: flex; align-items: center; justify-content: center; 
            position: relative; background: url('home-background.jpg') center/cover no-repeat;
        }
        
        /* FIX CH·ªñ N√ÄY: Xo√° background ƒëen m·ªù (Overlay) */
        .hero::before { 
            content: ''; position: absolute; inset: 0; 
            background: transparent; 
        }
        
        .hero::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 300px; 
            background: linear-gradient(to bottom, transparent, var(--bg-body)); 
        }
        .hero-content { position: relative; z-index: 10; text-align: center; max-width: 1000px; padding: 20px; }
        .hero-title { font-size: 5rem; font-weight: 900; line-height: 1.1; letter-spacing: -3px; }
        .hero-desc { font-size: 1.4rem; color: #eee; font-weight: 600; margin-top: 20px; }

        /* ==========================================================================
           TOPICS SECTION
           ========================================================================== */
        .topics-section { padding: 0 4%; margin-top: -60px; position: relative; z-index: 20; margin-bottom: 60px; }
        .section-label { font-size: 1.4rem; font-weight: 800; margin-bottom: 25px; color: #fff; letter-spacing: -0.5px; }
        .topic-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; }
        
        .topic-card { 
            height: 115px; border-radius: 20px; padding: 22px; 
            display: flex; flex-direction: column; justify-content: space-between; 
            cursor: pointer; position: relative; overflow: hidden; 
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px); isolation: isolate;
        }
        .topic-card:hover { transform: translateY(-8px); border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); }
        .topic-card::before { content: ''; position: absolute; top: 50%; left: 50%; width: 120px; height: 120px; border-radius: 50%; transform: translate(-50%, -50%); filter: blur(40px); opacity: 0.3; z-index: -2; transition: all 0.6s ease; }
        .topic-card:hover::before { width: 160px; height: 160px; opacity: 0.6; }
        .topic-card::after { content: ''; position: absolute; bottom: -20%; right: -10%; width: 80px; height: 80px; border-radius: 50%; filter: blur(30px); opacity: 0; z-index: -1; transition: all 0.6s ease; }
        .topic-card:hover::after { opacity: 0.4; transform: translate(-10px, -10px); }
        .topic-card i.floating-icon { position: absolute; bottom: -8px; right: -5px; font-size: 3.8rem; color: rgba(255, 255, 255, 0.05); transform: rotate(-15deg); transition: 0.5s; z-index: -1; }
        .topic-card:hover i.floating-icon { color: rgba(255, 255, 255, 0.12); transform: rotate(0deg) scale(1.1); }
        .topic-name { font-size: 1.3rem; font-weight: 900; z-index: 2; position: relative; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .topic-link { font-size: 0.8rem; font-weight: 800; display: flex; align-items: center; gap: 6px; z-index: 2; position: relative; color: rgba(255,255,255,0.6); transition: 0.3s; }
        .topic-card:hover .topic-link { color: #fff; gap: 10px; }

        /* Color Mixins */
        .bg-marvel::before { background: #ed1d24; } .bg-marvel::after { background: #ff8e0d; }
        .bg-sitcom::before { background: #00d2ff; } .bg-sitcom::after { background: #3a7bd5; }
        .bg-voice::before { background: #ff75c3; } .bg-voice::after { background: radial-gradient(circle, #ff75c3 0%, #74ebd5 100%); opacity: 0.1; } .bg-voice:hover::after { opacity: 0.5; }
        .bg-trans::before { background: #8e44ad; } .bg-trans::after { background: #ff00cc; }
        .bg-ancient::before { background: #f1c40f; } .bg-ancient::after { background: #e67e22; }
        .bg-4k::before { background: #ffffff; } .bg-4k::after { background: #2c3e50; }

        /* ==========================================================================
           7. MERGED COUNTRY BLOCK & GRID FIX
           ========================================================================== 
        */
        .merged-block { 
            background: var(--bg-panel); border-radius: 24px; margin: 0 4% 60px; 
            padding: 30px 45px; border: 1px solid rgba(255,255,255,0.05); 
            box-shadow: 0 25px 70px rgba(0,0,0,0.3); overflow: visible !important; isolation: isolate;
        }
        .country-section { margin-bottom: 40px; position: relative; overflow: visible !important; }
        .country-section:last-child { margin-bottom: 0; }
        .country-section:not(:last-child) { border-bottom: 1px solid rgba(255,255,255,0.04); padding-bottom: 20px; }
        .country-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }
        .ch-title { font-size: 2.2rem; font-weight: 900; letter-spacing: -0.5px; }
        .ch-link { font-size: 1rem; color: var(--text-sub); display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 700; }
        .grid-wrapper { position: relative; width: 100%; overflow: visible !important; }
        
        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; 
            background: rgba(0,0,0,0.85); border: 1px solid rgba(255,255,255,0.15); color: #fff;
            border-radius: 50%; cursor: pointer; z-index: 1002; display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: var(--transition-smooth); backdrop-filter: blur(5px);
        }
        .grid-wrapper:hover .nav-arrow { opacity: 1; }
        .arrow-prev { left: -25px; } .arrow-next { right: -25px; }
        .nav-arrow:hover { background: var(--primary-color); border-color: transparent; transform: translateY(-50%) scale(1.1); }

        /* üî•üî•üî• THE ULTIMATE FIX FOR CLIPPING (PH·∫†M VI HOVER) üî•üî•üî•
           K·ªπ thu·∫≠t: Deep Padding Buffer + Negative Margin
           - TƒÉng padding-top l√™n 100px ƒë·ªÉ ch·ª©a card hover bay l√™n.
           - TƒÉng padding ngang 40px ƒë·ªÉ ch·ª©a scale.
           - D√πng margin √¢m ƒë·ªÉ k√©o layout v·ªÅ v·ªã tr√≠ c≈©.
        */
        .country-grid { 
            display: flex; flex-wrap: nowrap; gap: 20px; 
            overflow-x: auto !important; scroll-behavior: smooth; scrollbar-width: none;
            /* DEEP PADDING FIX */
            padding-top: 100px !important; 
            padding-bottom: 40px !important; 
            padding-left: 40px !important; 
            padding-right: 40px !important;
            /* NEGATIVE MARGIN FIX */
            margin-top: -100px !important; 
            margin-bottom: -40px !important;
            margin-left: -40px !important; 
            margin-right: -40px !important;
        }
        .country-grid::-webkit-scrollbar { display: none; }

        /* ==========================================================================
           NEW CARD SYSTEM (INLINE HOVER - FIXED)
           ========================================================================== 
        */
        
        /* Container Card: Gi·ªØ n·ªôi dung b√™n trong, bo g√≥c */
        .n-card {
            flex: 0 0 calc(25% - 15px); /* PC: 4 card/h√†ng */
            position: relative; 
            aspect-ratio: 16/9; 
            border-radius: 12px; 
            overflow: hidden; /* C·∫Øt ph·∫ßn th·ª´a khi zoom */
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            background: #1a1c24;
            z-index: 1;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Hover: Ph√≥ng to nh·∫π to√†n b·ªô card */
        .n-card:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 15px 30px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* ·∫¢nh Poster */
        .n-poster { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transition: 0.4s;
        }

        /* Hover: ·∫¢nh t·ªëi ƒëi v√† zoom nh·∫π b√™n trong */
        .n-card:hover .n-poster {
            filter: brightness(0.6);
            transform: scale(1.1); 
        }

/* ƒêi·ªÅu ch·ªânh Info Layer khi kh√¥ng c√≤n description */
        .n-info-layer {
            position: absolute; bottom: 0; left: 0; width: 100%; 
            padding: 15px;
            background: linear-gradient(to top, #0f111a 20%, rgba(15, 17, 26, 0.8) 80%, transparent 100%);
            /* ƒê·∫©y xu·ªëng th·∫•p h∆°n v√¨ n·ªôi dung √≠t ƒëi */
            transform: translateY(55%); 
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex; flex-direction: column; gap: 8px; /* TƒÉng kho·∫£ng c√°ch c√°c d√≤ng */
        }
        
        /* ƒê·∫£m b·∫£o Meta info lu√¥n cƒÉn tr√°i */
        .n-meta-in { 
            display: flex; 
            align-items: center; 
            gap: 12px; /* Kho·∫£ng c√°ch gi·ªØa c√°c th·∫ª HD, NƒÉm... */
            justify-content: flex-start; /* CƒÉn tr√°i */
            font-size: 0.75rem; 
            color: #ccc; 
            opacity: 0; 
            transition: 0.3s; 
        }

        /* Khi Hover: Tr∆∞·ª£t l√™n v·ªã tr√≠ c≈© */
        .n-card:hover .n-info-layer {
            transform: translateY(0);
            background: linear-gradient(to top, #0f111a 30%, rgba(15, 17, 26, 0.95) 90%, transparent 100%);
        }

        /* Tinh ch·ªânh t√™n phim cho g·ªçn */
        .n-title-in {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.3;
            text-shadow: 0 2px 4px rgba(0,0,0,1); /* TƒÉng b√≥ng ƒëen cho ch·ªØ r√µ h∆°n */
            margin-bottom: 2px;
            
            /* ƒê·∫£m b·∫£o t√™n phim kh√¥ng b·ªã c·∫Øt ngang n·∫øu d√†i */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .n-card:hover .n-meta-in { opacity: 1; }

        /* H√†ng n√∫t b·∫•m (·∫®n khi ch∆∞a hover) */
        .n-actions-in {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            opacity: 0;
            transition: 0.3s 0.1s;
        }
        .n-card:hover .n-actions-in { opacity: 1; }

        /* N√∫t Xem ngay nh·ªè */
        .btn-mini-play {
            flex: 1;
            background: var(--gradient-main);
            border: none;
            color: #fff;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 8px;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            cursor: pointer;
        }
        .btn-mini-play:hover { filter: brightness(1.1); }

        /* N√∫t Th√™m nh·ªè */
        .btn-mini-add {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .btn-mini-add:hover { background: #fff; color: #000; }

        /* Style ri√™ng cho n√∫t X√≥a kh·ªèi l·ªãch s·ª≠ */
        .btn-mini-remove {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: 0.3s;
        }
        /* Hover v√†o th√¨ chuy·ªÉn m√†u ƒë·ªè b√°o hi·ªáu x√≥a */
        .btn-mini-remove:hover { 
            background: #ff4757; 
            border-color: #ff4757; 
            color: #fff;
        }

        /* Mobile Adjustment */
        @media (max-width: 900px) {
            .n-card { flex: 0 0 160px; aspect-ratio: 2/3; } /* Mobile d√πng ·∫£nh d·ªçc */
            .n-info-layer { transform: translateY(0); padding: 10px; } /* Lu√¥n hi·ªán title */
            .n-meta-in, .n-actions-in { display: none; } /* ·∫®n n√∫t tr√™n mobile cho g·ªçn */
            .n-card:hover { transform: none; }
        }

        /* RESET PADDING GRID (Quan tr·ªçng):
           V√¨ card kh√¥ng c√≤n popup to ƒë√πng bay ra ngo√†i n·ªØa, 
           n√™n ta tr·∫£ padding c·ªßa Grid v·ªÅ b√¨nh th∆∞·ªùng cho ƒë·∫πp.
        */
        .country-grid {
            padding: 20px 5px !important;
            margin: 0 !important;
        }

        

        /* ====================
           TOP 5 TRENDING (UPDATED)
           ==================== */
        .top-10-wrapper { position: relative; z-index: 20; padding: 0 4% 80px; }
        .top-10-header { display: flex; align-items: center; gap: 20px; margin-bottom: 45px; }
        .top-10-header h2 { font-size: 2.8rem; font-weight: 900; font-style: italic; letter-spacing: -1px; text-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .top-5-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 25px; }
        
        .top-card-style2 { position: relative; cursor: pointer; transition: 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); width: 100%; }
        
        /* Hi·ªáu ·ª©ng Hover Top 5: Bay l√™n & Lo√© s√°ng */
        .top-card-style2:hover { transform: translateY(-15px) scale(1.02); }
        
        .top-poster-style2 { 
            width: 100%; aspect-ratio: 2/3; border-radius: 18px; overflow: hidden; position: relative; 
            border: 2px solid transparent; /* Vi·ªÅn ch·ªù */
            transition: 0.4s;
            box-shadow: 0 15px 45px rgba(0,0,0,0.6);
        }

        /* Khi hover: Vi·ªÅn s√°ng + B√≥ng ƒë·ªï m√†u cam r·ª±c r·ª° */
        .top-card-style2:hover .top-poster-style2 {
            border-color: #ff8f50;
            box-shadow: 0 0 30px rgba(255, 143, 80, 0.6), 0 0 10px rgba(255, 255, 255, 0.5) inset;
        }

        .top-poster-style2 img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        
        .top-info-row { display: flex; align-items: flex-start; margin-top: 20px; }
        
            .top-rank-style2 { 
            font-size: 4.5rem; 
            /* FIX 1: TƒÉng line-height l√™n 1 ƒë·ªÉ hi·ªÉn th·ªã tr·ªçn v·∫πn s·ªë */
            line-height: 1; 
            font-family: 'Impact', sans-serif; 
            font-style: italic; 
            font-weight: 900; 
            background: linear-gradient(to bottom, #ffd700, #ff8c00); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            margin-right: 15px; 
            
            /* FIX 2: Th√™m padding ƒë·ªÉ b√≥ng ƒë·ªï v√† g√≥c nghi√™ng kh√¥ng b·ªã c·∫Øt */
            padding-right: 10px; 
            padding-bottom: 5px;
            
            filter: drop-shadow(2px 4px 0px rgba(0,0,0,0.5));
            
            /* ƒê·∫£m b·∫£o kh·ªëi s·ªë kh√¥ng b·ªã co l·∫°i */
            flex-shrink: 0;
        }
        
        .top-text-style2 { flex: 1; padding-top: 5px; }
        .top-title-style2 { font-size: 1.1rem; font-weight: 800; color: #fff; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .top-meta-style2 { font-size: 0.85rem; color: #aaa; font-weight: 600; display: flex; gap: 10px; }
        .top-meta-badge { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: #fff; font-size: 0.7rem; }

        /* Footer */
        footer { background: var(--bg-dark); padding: 60px 4% 20px; margin-top: 50px; border-top: 1px solid #23252f; font-size: 0.9rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px; margin-bottom: 40px; }
        .footer-col h3 { font-size: 1.1rem; color: #fff; margin-bottom: 20px; font-weight: 700; }
        .footer-brand { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .footer-brand img { height: 50px; object-fit: contain; }
        .footer-col ul { list-style: none; } .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: var(--text-sub); text-decoration: none; transition: 0.3s; } .footer-col ul li a:hover { color: var(--primary-color); }
        .footer-bottom { border-top: 1px solid #23252f; padding-top: 20px; display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 0.8rem; }
        
        .modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(15, 17, 26, 0.95); padding: 40px; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .modal-grid .movie-card { width: 100%; height: 280px; }

        /* Responsive Mobile */
        @media (max-width: 900px) {
            .footer-grid { grid-template-columns: 1fr; gap: 40px; text-align: center; }
            .footer-col ul { display: flex; flex-direction: column; align-items: center; }
            .footer-brand { justify-content: center; }
            .hero-title { font-size: 3rem; }
            .topic-grid { display: flex; overflow-x: auto; scrollbar-width: none; }
            .topic-card { flex: 0 0 160px; height: 95px; }
            
            .merged-block { padding: 35px 20px; border-radius: 0; margin: 0 0 40px; overflow: hidden !important; }
            /* Mobile Grid Adjustment */
            .country-grid { 
                padding: 40px 30px !important; 
                margin: -30px -30px !important; 
                gap: 15px; 
            }
            .n-card { flex: 0 0 260px; }
            .nav-arrow { display: none; } 
            .top-10-header h2 { font-size: 2rem; }
            .top-5-grid { display: flex !important; flex-wrap: nowrap !important; overflow-x: auto !important; gap: 15px; padding-bottom: 20px; scrollbar-width: none; }
            .top-card-style2 { flex: 0 0 160px; }
            .top-rank-style2 { font-size: 3.2rem !important; }
            .modal-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
        }

        /* N√∫t xo√° l·ªãch s·ª≠ */
        .btn-remove-history {
            position: absolute; top: 10px; right: 10px; width: 28px; height: 28px;
            border-radius: 50%; background: rgba(255, 255, 255, 0.1); border: 1.5px solid rgba(255, 255, 255, 0.2);
            color: #fff; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 100; transition: 0.3s; font-size: 0.8rem;
        }
        .btn-remove-history:hover { background: #ff4757; border-color: transparent; transform: scale(1.1); }


/* CSS cho k·∫øt qu·∫£ t√¨m ki·∫øm */
.search-result-item {
    display: flex;
    gap: 15px;
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    transition: 0.2s;
}
.search-result-item:hover {
    background: rgba(255,255,255,0.05);
}
.search-result-item img {
    width: 50px;
    height: 75px;
    object-fit: cover;
    border-radius: 4px;
}
.search-result-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.search-result-title {
    color: #fff;
    font-weight: 700;
    font-size: 0.95rem;
    margin-bottom: 4px;
}
.search-result-meta {
    color: #a0a0a0;
    font-size: 0.8rem;
}

/* Container k·∫øt qu·∫£ Desktop (Th√™m c√°i n√†y ƒë·ªÉ Desktop c≈©ng hi·ªán k·∫øt qu·∫£) */
#desktopSearchResults {
    position: absolute;
    top: 100%;
    right: 0;
    width: 350px;
    background: #1f212d;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    max-height: 400px;
    overflow-y: auto;
    display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
    z-index: 10002;
    margin-top: 10px;
    border: 1px solid rgba(255,255,255,0.1);
}
#desktopSearchResults.active { display: block; }

/* --- PANEL QU·∫¢NG C√ÅO 728x90 (D·ªçc & Tƒ©nh) --- */
        .ad-panel-wrapper {
            display: flex;
            flex-direction: column; /* X·∫øp c√°c qu·∫£ng c√°o theo h√†ng d·ªçc */
            align-items: center;    /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
            gap: 0px;              /* Kho·∫£ng c√°ch gi·ªØa c√°c banner */
            margin: 0 auto 40px;    /* Canh gi·ªØa trang, c√°ch d∆∞·ªõi 40px */
            padding: 0 4%;
            width: 100%;
            max-width: 1400px;
        }

        .ad-link {
            display: block;
            width: 100%;
            max-width: 728px; /* K√≠ch th∆∞·ªõc t·ªëi ƒëa chu·∫©n */
            /* ƒê√£ xo√° transition v√† hover transform */
        }

        .ad-img-728 {
            width: 100%;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: block;
        }

        /* Mobile: T·ª± thu nh·ªè */
        @media (max-width: 768px) {
            .ad-img-728 {
                height: auto;
                aspect-ratio: 728/90;
            }
        }
    </style>
</head>
<body>

    <div id="loadingScreen">
        <img src="/Loading.png" class="loading-img" alt="HopPhim">
    </div>

    <div id="toast-container"></div>

    <div id="confirmModal" class="custom-confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-icon"><i class="fas fa-question-circle"></i></div>
            <h3 style="color:#fff; font-size:1.6rem; margin-bottom:12px;">X√°c nh·∫≠n</h3>
            <p id="confirmMsg" style="color:#888; font-size:1.05rem;">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
            <div class="confirm-actions" style="margin-top:25px;">
                <button class="btn-confirm btn-cancel" id="btnConfirmNo">H·ªßy b·ªè</button>
                <button class="btn-confirm btn-ok" id="btnConfirmYes">ƒê·ªìng √Ω</button>
            </div>
        </div>
    </div>

    <div id="mobileMenuOverlay" class="mobile-overlay">
        <div class="backdrop" onclick="closeMobileMenu()"></div>
        <div id="mobileMenuContent" style="background: var(--mobile-menu-bg); width: 300px; height: 100%; display: flex; flex-direction: column; position: relative; z-index: 2; box-shadow: 20px 0 60px rgba(0,0,0,0.8);">
            
            <div class="drawer-header">
                <div style="display:flex; align-items:center; gap:10px;"><img src="/LOGO.WEBP" style="height:30px;"><span class="text-gradient" style="font-size:1.2rem;">HOPPHIM</span></div>
                <i class="fas fa-times" onclick="closeMobileMenu()" style="color:#fff; font-size:1.5rem; cursor:pointer;"></i>
            </div>

            <div class="drawer-user-card">
                <div class="drawer-user-btn" onclick="handleUserClick()">
                    <img src="/Guest.webp" id="drawerAvatar" class="drawer-user-avatar">
                    <span id="drawerUserName">ƒêƒÉng nh·∫≠p</span>
                </div>
            </div>

            <div class="drawer-content">
                <a href="/" class="drawer-item"><i class="fas fa-home"></i> Trang ch·ªß</a>
                <a href="#" onclick="loadCategory('phim-bo', 'Phim B·ªô'); closeMobileMenu()" class="drawer-item"><i class="fas fa-tv"></i> Phim B·ªô</a>
                <a href="#" onclick="loadCategory('phim-le', 'Phim L·∫ª'); closeMobileMenu()" class="drawer-item"><i class="fas fa-film"></i> Phim L·∫ª</a>

                <div class="drawer-label">QU·∫¢N L√ù</div>
                <a href="/hopteam" class="drawer-item"><i class="fas fa-users"></i> V·ªÅ HopTeam</a>
                <div id="drawerLogout" class="drawer-item" style="color:#ff4757; display:none;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</div>
            </div>
        </div>
    </div>

    <div id="mobileSearchOverlay">
        <div class="ms-header">
            <div class="ms-input-group">
                <i class="fas fa-search" style="color:#aaa;"></i>
                <input type="text" id="mobileSearchInput" placeholder="Nh·∫≠p t√™n phim..." autocomplete="off">
            </div>
            <i class="fas fa-times" onclick="closeMobileSearch()" style="color:#fff; font-size:1.5rem; cursor:pointer; padding-left: 15px;"></i>
        </div>
        <div id="mobileSearchResults" style="flex:1; overflow-y:auto; margin-top:10px;">
            </div>
    </div>

    <header id="siteHeader">
        <div class="mobile-left-container">
            <i class="fas fa-bars mobile-menu-toggle" onclick="openMobileMenu()"></i>
            <div class="logo" onclick="loadHome()">
                <img src="/LOGO.WEBP" alt="Logo"><span class="logo-text">HOPPHIM</span>
            </div>
        </div>

        <div class="header-left-group">
            <div class="logo" onclick="loadHome()">
                <img src="/LOGO.WEBP" alt="Logo"><span class="logo-text text-gradient">HOPPHIM</span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li class="nav-item">
                    <a href="/" class="nav-link" onclick="loadHome()">Trang ch·ªß</a>
                </li>
                
                <li class="nav-item">
                    <div class="nav-link">Th·ªÉ lo·∫°i <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu">
                        <div class="dropdown-grid">
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hanh-dong', 'H√†nh ƒê·ªông')">H√†nh ƒê·ªông</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tinh-cam', 'T√¨nh C·∫£m')">T√¨nh C·∫£m</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hai-huoc', 'H√†i H∆∞·ªõc')">H√†i H∆∞·ªõc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('co-trang', 'C·ªï Trang')">C·ªï Trang</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tam-ly', 'T√¢m L√Ω')">T√¢m L√Ω</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hinh-su', 'H√¨nh S·ª±')">H√¨nh S·ª±</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('chien-tranh', 'Chi·∫øn Tranh')">Chi·∫øn Tranh</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('the-thao', 'Th·ªÉ Thao')">Th·ªÉ Thao</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vo-thuat', 'V√µ Thu·∫≠t')">V√µ Thu·∫≠t</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vien-tuong', 'Vi·ªÖn T∆∞·ªüng')">Vi·ªÖn T∆∞·ªüng</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('phieu-luu', 'Phi√™u L∆∞u')">Phi√™u L∆∞u</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('khoa-hoc', 'Khoa H·ªçc')">Khoa H·ªçc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('kinh-di', 'Kinh D·ªã')">Kinh D·ªã</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('am-nhac', '√Çm Nh·∫°c')">√Çm Nh·∫°c</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('than-thoai', 'Th·∫ßn Tho·∫°i')">Th·∫ßn Tho·∫°i</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tai-lieu', 'T√†i Li·ªáu')">T√†i Li·ªáu</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('gia-dinh', 'Gia ƒê√¨nh')">Gia ƒê√¨nh</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hoc-duong', 'H·ªçc ƒê∆∞·ªùng')">H·ªçc ƒê∆∞·ªùng</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-le', 'Phim L·∫ª')">Phim L·∫ª</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-bo', 'Phim B·ªô')">Phim B·ªô</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('tv-shows', 'TV Shows')">TV Shows</a></li>

                <li class="nav-item">
                    <div class="nav-link">Qu·ªëc gia <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu" style="width: 400px;"> <div class="dropdown-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('trung-quoc', 'Trung Qu·ªëc')">Trung Qu·ªëc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('han-quoc', 'H√†n Qu·ªëc')">H√†n Qu·ªëc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('nhat-ban', 'Nh·∫≠t B·∫£n')">Nh·∫≠t B·∫£n</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('thai-lan', 'Th√°i Lan')">Th√°i Lan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('au-my', '√Çu M·ªπ')">√Çu M·ªπ</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('dai-loan', 'ƒê√†i Loan')">ƒê√†i Loan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('hong-kong', 'H·ªìng K√¥ng')">H·ªìng K√¥ng</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('an-do', '·∫§n ƒê·ªô')">·∫§n ƒê·ªô</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('viet-nam', 'Vi·ªát Nam')">Vi·ªát Nam</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a class='nav-link' href='/hopteam'>V·ªÅ HopTeam</a></li>
            </ul>
        </div>
        <div class="right-elements">
            <div class="mobile-search-trigger" onclick="openMobileSearch()"><i class="fas fa-search"></i></div>
            
            <div class="search-box desktop-auth" style="position: relative;"> 
                <i class="fas fa-search" style="color: #a0a0a0"></i>
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm phim..." autocomplete="off">
                <div id="desktopSearchResults"></div>
            </div>

            <div class="desktop-auth" style="position: relative;">
                <button id="btnLogin" class="btn-login" onclick="window.location.href='/login.html'">ƒêƒÉng nh·∫≠p</button>
                <img id="userAvatar" class="user-avatar" src="" alt="User" onclick="toggleUserDropdown()">
                <div id="userMenu" class="user-dropdown">
                    <div id="userNameDisplay" class="user-info-item">User</div>
                    <button class="dropdown-item" onclick="window.location.href='/profile.html'"><i class="fas fa-user-cog"></i> T√†i kho·∫£n</button>
                    <button class="dropdown-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title"><span class="text-gradient">HopPhim - Phim Hay<BR>Trong T·∫ßm Tay</span></h1>
            <p class="hero-desc">Xem phim chu·∫©n FHD Vietsub, c·∫≠p nh·∫≠t li√™n t·ª•c t·∫°i HopPhim.</p>
        </div>
    </section>

    <div class="topics-section">
        <div class="section-label">G·ª£i √Ω ch·ªß ƒë·ªÅ</div>
        <div class="topic-grid">
            <div class="topic-card bg-marvel" onclick="loadCategory('hanh-dong', 'Marvel')"><i class="fab fa-quinscape floating-icon"></i><div class="topic-name">Marvel</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-sitcom" onclick="loadCategory('hai-huoc', 'Sitcom')"><i class="fas fa-laugh-squint floating-icon"></i><div class="topic-name">Sitcom</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-voice" onclick="loadCategory('hoat-hinh', 'Anime')"><i class="fas fa-shinto--gate floating-icon"></i><div class="topic-name">Anime</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-trans" onclick="loadCategory('vien-tuong', 'Vi·ªÖn T∆∞·ªüng')"><i class="fas fa-rocket floating-icon"></i><div class="topic-name">Vi·ªÖn T∆∞·ªüng</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-ancient" onclick="loadCategory('co-trang', 'C·ªï Trang')"><i class="fas fa-dragon floating-icon"></i><div class="topic-name">C·ªï Trang</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-4k" onclick="loadCategory('kinh-di', 'Kinh D·ªã')"><i class="fas fa-ghost floating-icon"></i><div class="topic-name">Kinh D·ªã</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
        </div>
    </div>

    <div class="ad-panel-wrapper">
        <a href="https://hopvan.netlify.app" target="_blank" class="ad-link">
            <img src="https://ax.mpcdn.top/motchill/uploads/5a78df669da7d12e44fbc89e3f05c8d2.gif" alt="Qu·∫£ng c√°o" class="ad-img-728">
        </a>
        <a href="https://hopvan.netlify.app" target="_blank" class="ad-link">
            <img src="https://ax.mpcdn.top/motchill/uploads/8284c7302b169dafdb531bcdab46d1e0.gif" alt="Qu·∫£ng c√°o" class="ad-img-729">
        </a>
    </div>

    <div id="history-container"></div>

    <main id="main-content">
        <div class="merged-block">
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">H√†n Qu·ªëc</span></div><div class="ch-link" onclick="openModal('han-quoc', 'Phim H√†n Qu·ªëc')">Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('koreaList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="koreaList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('koreaList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">Trung Qu·ªëc</span></div><div class="ch-link" onclick="openModal('trung-quoc', 'Phim Trung Qu·ªëc')">Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('chinaList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="chinaList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('chinaList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">Th√°i Lan</span></div><div class="ch-link" onclick="openModal('thai-lan', 'Phim Th√°i Lan')">Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('thaiList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="thaiList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('thaiList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </main>

    <div class="ad-panel-wrapper">
        <a href="https://hopvan.netlify.app" target="_blank" class="ad-link">
            <img src="https://ax.mpcdn.top/motchill/uploads/d482b9059085ad01e631948e6b6d6041.gif" alt="Qu·∫£ng c√°o" class="ad-img-728">
        </a>
        <a href="https://hopvan.netlify.app" target="_blank" class="ad-link">
            <img src="https://ax.mpcdn.top/motchill/uploads/5de1033eb5666a06823992f4a72b06ed.gif" alt="Qu·∫£ng c√°o" class="ad-img-729">
        </a>
    </div>

    <section class="top-10-wrapper">
        <div class="top-10-header"><i class="fas fa-fire" style="color:var(--primary-color); font-size: 2.5rem;"></i><h2>Top 5 th·ªãnh h√†nh</h2></div>
        <div class="top-5-grid" id="top5List"></div>
    </section>

    <div id="modalPopup" class="modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; border-bottom:1px solid #222; padding-bottom:20px;">
            <h2 id="modalTitle" class="text-gradient" style="font-size: 2rem;">Danh s√°ch phim</h2>
            <i class="fas fa-times" onclick="closeModal()" style="font-size:2.5rem; color:#fff; cursor:pointer;"></i>
        </div>
        <div id="modalContent" class="modal-grid"></div>
    </div>

    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <div class="footer-brand"><img src="/logo.webp" alt="HopPhim"><span class="logo-text">HOPPHIM</span></div>
                <p style="color: #a0a0a0; line-height: 1.6; margin-top: 15px;">Trang xem phim tr·ª±c tuy·∫øn mi·ªÖn ph√≠ ch·∫•t l∆∞·ª£ng cao.</p>
            </div>
            <div class="footer-col">
                <h3>Danh m·ª•c</h3>
                <ul>
                    <li><a href="#" onclick="loadCategory('phim-moi', 'Phim M·ªõi C·∫≠p Nh·∫≠t')">Phim M·ªõi C·∫≠p Nh·∫≠t</a></li>
                    <li><a href="#" onclick="loadCategory('phim-le', 'Phim L·∫ª')">Phim Chi·∫øu R·∫°p</a></li>
                    <li><a href="#" onclick="loadCategory('phim-bo', 'Phim B·ªô')">Phim B·ªô ƒê·ªôc Quy·ªÅn</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Qu·ªëc gia</h3>
                <ul>
                    <li><a href="#" onclick="loadCountry('han-quoc', 'H√†n Qu·ªëc')">H√†n Qu·ªëc</a></li>
                    <li><a href="#" onclick="loadCountry('trung-quoc', 'Trung Qu·ªëc')">Trung Qu·ªëc</a></li>
                    <li><a href="#" onclick="loadCountry('au-my', '√Çu M·ªπ')">√Çu M·ªπ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>H·ªó tr·ª£</h3>
                <ul>
                    <li><a href='/lienhequangcao'>Li√™n h·ªá qu·∫£ng c√°o</a></li>
                    <li><a href='/baoloi'>B√°o l·ªói</a></li>
                    <li><a href='/hopteam'>V·ªÅ HopTeam</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom"><p>&copy; 2026 HopPhim. All Rights Reserved By HopTeam.</p></div>
    </footer>

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAT6SnKojUmsisDhnuEtsL3H59NwrhZxDc", authDomain: "hopphim-29e1c.firebaseapp.com", projectId: "hopphim-29e1c", storageBucket: "hopphim-29e1c.firebasestorage.app", messagingSenderId: "1076044580405", appId: "1:1076044580405:web:a3485f8533604f305e537c", measurementId: "G-6RT4CX2NR0" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- 1. QU·∫¢N L√ù ƒêƒÇNG NH·∫¨P (AUTH) ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // ƒê√£ ƒëƒÉng nh·∫≠p
                window.currentUser = user;
                document.getElementById('btnLogin').style.display = 'none';
                document.getElementById('userAvatar').style.display = 'block';
                document.getElementById('userAvatar').src = user.photoURL || '/Guest.webp';
                
                // C·∫≠p nh·∫≠t Mobile Drawer
                const drawerName = document.getElementById('drawerUserName');
                if(drawerName) drawerName.innerText = user.displayName;
                const drawerLogout = document.getElementById('drawerLogout');
                if(drawerLogout) drawerLogout.style.display = 'flex';
                
                // C·∫≠p nh·∫≠t Desktop Menu
                document.getElementById('userNameDisplay').innerText = user.displayName;
                
                // T·∫£i l·ªãch s·ª≠
                loadHistory(user.uid);
            } else {
                // Ch∆∞a ƒëƒÉng nh·∫≠p
                window.currentUser = null;
                document.getElementById('btnLogin').style.display = 'block';
                document.getElementById('userAvatar').style.display = 'none';
                
                document.getElementById('drawerUserName').innerText = "ƒêƒÉng nh·∫≠p";
                document.getElementById('drawerLogout').style.display = 'none';
                document.getElementById('history-container').innerHTML = '';
            }
        });

        // --- 2. H√ÄM TH√îNG B√ÅO (TOAST) - G√°n v√†o Window ƒë·ªÉ d√πng to√†n c·ª•c ---
        window.showToast = (msg, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '<i class="fas fa-check-circle" style="color:#2ecc71"></i>' : '<i class="fas fa-exclamation-triangle" style="color:#ff4757"></i>';
            toast.innerHTML = `${icon} <span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.transition = "0.4s";
                toast.style.opacity = "0";
                toast.style.transform = "translateX(100%)";
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        // --- 3. H√ÄM H·ªòP THO·∫†I X√ÅC NH·∫¨N (CONFIRM) ---
        window.customConfirm = (msg) => {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmModal');
                const msgEl = document.getElementById('confirmMsg');
                const btnYes = document.getElementById('btnConfirmYes');
                const btnNo = document.getElementById('btnConfirmNo');

                msgEl.innerText = msg;
                modal.classList.add('active');

                // X·ª≠ l√Ω s·ª± ki·ªán click
                const handleYes = () => { cleanup(); resolve(true); };
                const handleNo = () => { cleanup(); resolve(false); };

                const cleanup = () => {
                    modal.classList.remove('active');
                    btnYes.onclick = null;
                    btnNo.onclick = null;
                }

                btnYes.onclick = handleYes;
                btnNo.onclick = handleNo;
            });
        }

        // --- 4. CH·ª®C NƒÇNG ƒêƒÇNG XU·∫§T (ƒê√É FIX) ---
        window.logout = async () => {
            const ok = await window.customConfirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?");
            if(ok) {
                try {
                    await signOut(auth);
                    window.showToast("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!");
                    
                    // ƒê√≥ng c√°c menu th·ªß c√¥ng ƒë·ªÉ tr√°nh l·ªói ph·ª• thu·ªôc
                    document.getElementById('mobileMenuOverlay').classList.remove('active');
                    document.getElementById('userMenu').classList.remove('active');
                } catch (e) {
                    console.error(e);
                    window.showToast("L·ªói ƒëƒÉng xu·∫•t", "error");
                }
            }
        }

        // --- 5. LOGIC D·ªÆ LI·ªÜU (L·ªäCH S·ª¨ & DANH S√ÅCH) ---
        
        // L∆∞u l·ªãch s·ª≠
        window.saveToHistory = async (slug, name, thumb) => {
            if (!window.currentUser) return;
            const ref = doc(db, "users", window.currentUser.uid);
            try {
                const snap = await getDoc(ref);
                let history = snap.exists() ? (snap.data().watchHistory || []) : [];
                history = history.filter(m => m.slug !== slug);
                history.push({ slug, name, thumb_url: thumb, timestamp: Date.now() });
                if (history.length > 15) history.shift();
                
                if(snap.exists()) await updateDoc(ref, { watchHistory: history });
                else await setDoc(ref, { email: window.currentUser.email, watchHistory: history });
                
                loadHistory(window.currentUser.uid);
            } catch (e) {}
        };

        // Load l·ªãch s·ª≠
        async function loadHistory(uid) {
            try {
                const snap = await getDoc(doc(db, "users", uid));
                if(snap.exists() && snap.data().watchHistory && snap.data().watchHistory.length > 0) {
                    window.renderHistoryRow(snap.data().watchHistory.reverse().slice(0, 8));
                } else {
                    document.getElementById('history-container').innerHTML = '';
                }
            } catch(e) {}
        }

        // Xo√° phim kh·ªèi l·ªãch s·ª≠ (ƒê√£ Fix: T√¨m Card Ch√≠nh X√°c + Toast Ngay)
        window.removeFromHistory = async (slug, btnElement) => {
            if (!window.currentUser) { window.showToast("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!", "error"); return; }

            // A. X·ª¨ L√ù GIAO DI·ªÜN (UI)
            let card = document.querySelector(`.history-card-${slug}`);
            if (!card && btnElement) card = btnElement.closest('.n-card');

            if (card) {
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    card.remove();
                    // N·∫øu xo√° h·∫øt th√¨ ·∫©n khung ch·ª©a
                    const container = document.getElementById('historyList');
                    if(container && container.children.length === 0) {
                        document.getElementById('history-container').innerHTML = '';
                    }
                }, 300);
                // Hi·ªán th√¥ng b√°o NGAY L·∫¨P T·ª®C
                window.showToast("ƒê√£ xo√° phim kh·ªèi l·ªãch s·ª≠", "success");
            }

            // B. X·ª¨ L√ù DATABASE (FIREBASE)
            const ref = doc(db, "users", window.currentUser.uid);
            try {
                const snap = await getDoc(ref);
                if (snap.exists()) {
                    let history = snap.data().watchHistory || [];
                    const newHistory = history.filter(m => m.slug !== slug);
                    await updateDoc(ref, { watchHistory: newHistory });
                }
            } catch (e) { 
                console.error(e); 
                window.showToast("L·ªói k·∫øt n·ªëi database!", "error"); 
            }
        };

        // L∆∞u phim y√™u th√≠ch
        window.addToMyList = async (slug, name, thumb) => {
            if (!window.currentUser) { window.showToast("Vui l√≤ng ƒëƒÉng nh·∫≠p!", "error"); return; }
            const ref = doc(db, "users", window.currentUser.uid);
            const snap = await getDoc(ref);
            let list = snap.exists() ? (snap.data().myList || []) : [];
            if (list.some(m => m.slug === slug)) { window.showToast("Phim ƒë√£ c√≥ trong danh s√°ch!", "error"); return; }
            
            list.push({ slug, name, thumb_url: thumb, timestamp: Date.now() });
            
            if(snap.exists()) await updateDoc(ref, { myList: list }); 
            else await setDoc(ref, { email: window.currentUser.email, myList: list });
            
            window.showToast(`ƒê√£ th√™m: ${name}`);
        };
        
        // Helper UI
        window.toggleUserDropdown = () => document.getElementById('userMenu').classList.toggle('active');
        window.handleUserClick = () => { window.location.href = window.currentUser ? '/profile.html' : '/login.html'; }
    </script>

<script>
        const API_BASE = 'https://ophim1.com/v1/api';
        const IMG_BASE = 'https://img.ophim1.com/uploads/movies/';

        // --- TIME HELPER ---
        function timeAgo(timestamp) {
            if (!timestamp) return '';
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return "V·ª´a xong";
            const intervals = { nƒÉm: 31536000, th√°ng: 2592000, ng√†y: 86400, gi·ªù: 3600, ph√∫t: 60 };
            for (const [unit, sec] of Object.entries(intervals)) {
                const val = Math.floor(seconds / sec);
                if (val >= 1) return val + " " + unit + " tr∆∞·ªõc";
            }
            return "V·ª´a xong";
        }

        // --- RENDER CARD ---
        window.createMovieCardHTML = (m, isHistory = false, timeString = "") => {
            const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
            const nameFixed = m.name.replace(/'/g, "\\'");
            const historyClass = isHistory ? `history-card-${m.slug}` : '';

            const actionBtn = isHistory 
                ? `<button class="btn-mini-remove" title="Xo√°" onclick="event.stopPropagation(); removeFromHistory('${m.slug}', this)"><i class="fas fa-minus"></i></button>`
                : `<button class="btn-mini-add" title="L∆∞u" onclick="event.stopPropagation(); addToMyList('${m.slug}', '${nameFixed}', '${m.thumb_url}')"><i class="fas fa-plus"></i></button>`;

            const metaInfo = isHistory 
                ? `<span style="color:#aaa; font-size:0.75rem;"><i class="fas fa-history"></i> ${timeString}</span> <span class="badge-hd">HD</span>`
                : `<span style="color:#46d369; font-weight:800;">${m.year || 2024}</span> <span class="badge-hd">HD</span> <span>${m.lang||'Vietsub'}</span>`;

            return `
            <div class="n-card ${historyClass}" onclick="window.location.href='/xem-phim/${m.slug}'">
                <img src="${img}" class="n-poster" loading="lazy">
                <div class="n-info-layer">
                    <div class="n-title-in">${m.name}</div>
                    <div class="n-meta-in">
                        ${metaInfo}
                    </div>
                    <div class="n-actions-in">
                        <button class="btn-mini-play"><i class="fas fa-play"></i> ${isHistory?'TI·∫æP T·ª§C':'XEM NGAY'}</button>
                        ${actionBtn}
                    </div>
                </div>
            </div>`;
        };

        // --- RENDER HISTORY ROW ---
        window.renderHistoryRow = (movies) => {
            const container = document.getElementById('history-container');
            if(!movies || movies.length === 0) { container.innerHTML = ''; return; }
            
            const historyGridId = 'historyList'; 
            let cards = movies.map(m => window.createMovieCardHTML(m, true, timeAgo(m.timestamp))).join('');
            
            container.innerHTML = `
                <div class="merged-block" style="margin-top:0; padding-bottom:30px;">
                    <div class="country-section" style="border:none;">
                        <div class="country-header">
                            <div class="ch-title"><i class="fas fa-clock" style="color:var(--primary-color); margin-right:10px;"></i> Xem ti·∫øp</div>
                        </div>
                        <div class="grid-wrapper">
                            <button class="nav-arrow arrow-prev" onclick="scrollGrid('${historyGridId}', -1)"><i class="fas fa-chevron-left"></i></button>
                            <div class="country-grid" id="${historyGridId}">${cards}</div>
                            <button class="nav-arrow arrow-next" onclick="scrollGrid('${historyGridId}', 1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>`;
        }

        /* ==============================================
           üî• FIX SEARCH LOGIC (T√åM KI·∫æM)
           ============================================== */
        let searchTimeout;
        
        // H√†m g·ªçi API t√¨m ki·∫øm v√† hi·ªÉn th·ªã k·∫øt qu·∫£
        async function performSearch(keyword, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return; // B·∫£o v·ªá n·∫øu kh√¥ng t√¨m th·∫•y container

            if (!keyword || keyword.length < 2) {
                container.innerHTML = '';
                container.classList.remove('active');
                return;
            }

            container.classList.add('active');
            container.innerHTML = '<div style="color:#ccc; padding:15px; text-align:center;">ƒêang t√¨m ki·∫øm...</div>';

            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                try {
                    const res = await fetch(`https://ophim1.com/v1/api/tim-kiem?keyword=${keyword}`);
                    const data = await res.json();

                    if (data.data && data.data.items && data.data.items.length > 0) {
                        let html = '';
                        data.data.items.forEach(m => {
                            const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
                            html += `
                                <div class="search-result-item" onclick="window.location.href='/xem-phim/${m.slug}'">
                                    <img src="${img}" loading="lazy">
                                    <div class="search-result-info">
                                        <div class="search-result-title">${m.name}</div>
                                        <div class="search-result-meta">${m.year || ''} ‚Ä¢ ${m.origin_name || ''}</div>
                                    </div>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<div style="color:#aaa; padding:15px; text-align:center;">Kh√¥ng t√¨m th·∫•y phim n√†o.</div>';
                    }
                } catch (e) {
                    console.error(e);
                    container.innerHTML = '<div style="color:#ff4757; padding:15px; text-align:center;">L·ªói k·∫øt n·ªëi server!</div>';
                }
            }, 500); // Debounce 500ms
        }

        // --- RENDER TOP 5 ---
        async function loadTop5() {
            const MANUAL_TOP_5 = ["con-ra-the-thong-gi-nua", "dia-nguc-doc-than-phan-5", "tieng-yeu-nay-anh-dich-duoc-khong", "con-say-mua-xuan", "duong-cung-ky-an-thanh-vu-phong-minh"];
            const container = document.getElementById('top5List');
            let html = '';
            for (let i = 0; i < MANUAL_TOP_5.length; i++) {
                try {
                    const res = await fetch(`${API_BASE}/phim/${MANUAL_TOP_5[i]}`);
                    const data = await res.json();
                    if(data.status) {
                        const m = data.data.item;
                        const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.poster_url;
                        html += `
                        <div class="top-card-style2" onclick="window.location.href='/xem-phim/${m.slug}'">
                            <div class="top-poster-style2"><img src="${img}"></div>
                            <div class="top-info-row">
                                <div class="top-rank-style2">${i+1}</div>
                                <div class="top-text-style2">
                                    <div class="top-title-style2">${m.name}</div>
                                    <div class="top-meta-style2">
                                        <span class="top-meta-badge">${m.quality || 'HD'}</span>
                                        <span>${m.year}</span>
                                        <span>‚Ä¢ ${m.time || 'N/A'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    }
                } catch(e){}
            }
            container.innerHTML = html;
        }

        // --- OTHER LOAD FUNCTIONS ---
        async function loadCountrySection(slug, elementId) {
            try {
                const res = await fetch(`${API_BASE}/quoc-gia/${slug}?page=1`);
                const data = await res.json();
                if(data.data) {
                    let html = '';
                    data.data.items.slice(0, 16).forEach(m => html += window.createMovieCardHTML(m));
                    document.getElementById(elementId).innerHTML = html;
                }
            } catch(e) {}
        }

        window.scrollGrid = (id, direction) => {
            const el = document.getElementById(id);
            if(el) el.scrollBy({ left: direction * el.clientWidth, behavior: 'smooth' });
        };

        window.openModal = async (slug, title) => {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalPopup').classList.add('active');
            const res = await fetch(`${API_BASE}/quoc-gia/${slug}?page=1`);
            const data = await res.json();
            const container = document.getElementById('modalContent');
            let html = '';
            if(data.data) {
                data.data.items.forEach(m => {
                    const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
                    html += `<div class="modal-card" onclick="window.location.href='/xem-phim/${m.slug}'"><img src="${img}" style="width:100%; border-radius:8px;"><div style="padding:15px; font-weight:700; font-size:0.9rem; color:#fff;">${m.name}</div></div>`;
                });
            }
            container.innerHTML = html;
        }

        window.closeModal = () => document.getElementById('modalPopup').classList.remove('active');
        
        window.openMobileMenu = () => { document.getElementById('mobileMenuOverlay').classList.add('active'); }
        window.closeMobileMenu = () => { document.getElementById('mobileMenuOverlay').classList.remove('active'); }
        
        window.openMobileSearch = () => { 
            const overlay = document.getElementById('mobileSearchOverlay');
            overlay.classList.add('active'); 
            setTimeout(() => document.getElementById('mobileSearchInput').focus(), 300);
        }
        window.closeMobileSearch = () => { document.getElementById('mobileSearchOverlay').classList.remove('active'); }
        
        window.loadHome = () => window.location.href = '/';

        // --- INIT & EVENT LISTENERS ---
        window.addEventListener('load', () => {
            loadTop5();
            loadCountrySection('han-quoc', 'koreaList');
            loadCountrySection('trung-quoc', 'chinaList');
            loadCountrySection('thai-lan', 'thaiList');
            setTimeout(() => document.getElementById('loadingScreen').style.display = 'none', 1000);

            // üî• G√ÅN S·ª∞ KI·ªÜN T√åM KI·∫æM (Mobile & Desktop)
            const mobileInput = document.getElementById('mobileSearchInput');
            if(mobileInput) {
                mobileInput.addEventListener('input', (e) => performSearch(e.target.value, 'mobileSearchResults'));
            }

            const desktopInput = document.getElementById('searchInput');
            if(desktopInput) {
                desktopInput.addEventListener('input', (e) => performSearch(e.target.value, 'desktopSearchResults'));
                
                // ·∫®n k·∫øt qu·∫£ khi click ra ngo√†i
                document.addEventListener('click', (e) => {
                    const searchBox = document.querySelector('.search-box');
                    const results = document.getElementById('desktopSearchResults');
                    if (searchBox && !searchBox.contains(e.target) && results) {
                        results.classList.remove('active');
                    }
                });
            }
        });

        window.addEventListener('scroll', () => {
            document.getElementById('siteHeader').classList.toggle('scrolled', window.scrollY > 50);
        });
    </script>

<script src="backtotop.js"></script>
</body>
</html>