<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HopPhim - Xem Phim Thả Ga Style Netflix</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #e50914;
            --dark-bg: #141414;
            --darker-bg: #0b0b0b;
            --light-text: #fff;
            --gray-text: #b3b3b3;
            --card-width: 220px; /* Card to hơn xíu cho đẹp */
            --card-height: 330px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; scrollbar-width: thin; scrollbar-color: var(--primary-color) var(--darker-bg);}
        body { font-family: 'Roboto', sans-serif; background-color: var(--dark-bg); color: var(--light-text); overflow-x: hidden; }
        
        /* Custom Scrollbar cho đẹp */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--darker-bg); }
        ::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }

        /* --- HEADER & NAV --- */
        header {
            position: fixed; top: 0; width: 100%; padding: 15px 4%; display: flex;
            justify-content: space-between; align-items: center; z-index: 1000;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%);
            transition: background-color 0.4s;
        }
        header.scrolled { background-color: var(--darker-bg); box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        
        .logo img {
            height: 40px; /* Chỗ để logo ảnh của ông */
            /* Ví dụ: content: url('path/to/your/logo.png'); */
        }
        /* Tạm thời tôi dùng text demo, ông có ảnh thì xóa dòng dưới và dùng thẻ img bên trên */
        .logo-text-demo { font-size: 30px; font-weight: 900; color: var(--primary-color); text-transform: uppercase; letter-spacing: 2px;}

        .nav-links { display: flex; gap: 25px; list-style: none; align-items: center;}
        .nav-links li a { color: var(--light-text); text-decoration: none; font-size: 15px; font-weight: 500; transition: color 0.3s; }
        .nav-links li a:hover { color: var(--gray-text); }
        .search-box { display: flex; align-items: center; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.3); padding: 6px 12px; border-radius: 4px; }
        .search-box input { background: transparent; border: none; color: #fff; outline: none; width: 220px; margin-left: 10px; font-size: 14px;}

        /* --- HERO SECTION (WELCOME STYLE) --- */
        .hero {
            height: 85vh; background-size: cover; background-position: center; position: relative;
            display: flex; align-items: center; justify-content: center; text-align: center;
            margin-bottom: -100px; /* Kéo nội dung lên đè lên hero một chút */
        }
        .hero::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0.3) 0%, var(--dark-bg) 100%);
        }
        .hero-content { z-index: 10; max-width: 800px; padding: 20px; }
        .hero-title { font-size: 3.5rem; margin-bottom: 20px; font-weight: 900; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); }
        .hero-desc { font-size: 1.3rem; font-weight: 300; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }

        /* --- MOVIE LISTS & SLIDER CONTROLS --- */
        main { position: relative; z-index: 20; padding-top: 20px; background: linear-gradient(to bottom, transparent, var(--dark-bg) 15%);}
        .category-section { padding: 25px 4%; position: relative; }
        
        .category-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 15px; }
        .category-title { font-size: 1.5rem; font-weight: 700; color: #e5e5e5; }
        .see-all-link { color: var(--gray-text); text-decoration: none; font-size: 0.9rem; font-weight: 600; transition: color 0.3s; cursor: pointer; display: flex; align-items: center;}
        .see-all-link:hover { color: var(--light-text); }
        .see-all-link i { margin-left: 5px; font-size: 0.8rem;}

        .slider-container { position: relative; group: hover .slider-arrow { opacity: 1; } }
        .movie-row { display: flex; overflow-x: scroll; overflow-y: hidden; gap: 10px; padding: 20px 0; scroll-behavior: smooth; -ms-overflow-style: none; scrollbar-width: none; }
        .movie-row::-webkit-scrollbar { display: none; }

        /* Nút mũi tên trái phải */
        .slider-arrow {
            position: absolute; top: 50%; transform: translateY(-50%); z-index: 90;
            background: rgba(0,0,0,0.5); color: #fff; border: none; width: 50px; height: 100%;
            font-size: 2rem; cursor: pointer; opacity: 0; transition: opacity 0.3s, background 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .slider-container:hover .slider-arrow { opacity: 1; }
        .slider-arrow:hover { background: rgba(0,0,0,0.8); color: var(--primary-color); }
        .arrow-left { left: -4%; border-top-right-radius: 4px; border-bottom-right-radius: 4px;}
        .arrow-right { right: -4%; border-top-left-radius: 4px; border-bottom-left-radius: 4px;}


        /* --- MOVIE CARD V2 (NETFLIX HOVER STYLE) --- */
        .movie-card {
            flex: 0 0 var(--card-width); position: relative; height: var(--card-height);
            border-radius: 6px; overflow: hidden; cursor: pointer; transition: all 0.3s ease-in-out;
            border: 1px solid transparent;
        }
        .movie-poster { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s, filter 0.4s; }
        
        /* Khi hover vào card */
        .movie-card:hover {
            transform: scale(1.05); /* Phóng to nhẹ */
            z-index: 99;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            border-color: rgba(255,255,255,0.1);
        }
        .movie-card:hover .movie-poster {
            filter: brightness(0.4) blur(2px); /* Làm tối và mờ ảnh nền */
        }

        /* Phần thông tin trồi lên khi hover */
        .movie-info-hover {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.95) 40%, transparent);
            opacity: 0; transform: translateY(20px); transition: all 0.4s ease-in-out;
            display: flex; flex-direction: column; gap: 8px;
        }
        .movie-card:hover .movie-info-hover {
            opacity: 1; transform: translateY(0); bottom: 10px;
        }

        .hover-btns { display: flex; gap: 10px; margin-bottom: 5px; }
        .h-btn {
            width: 36px; height: 36px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.5);
            display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5);
            color: #fff; transition: all 0.2s; font-size: 0.9rem;
        }
        .h-btn-play { background: #fff; color: #000; border: none; }
        .h-btn:hover { transform: scale(1.1); border-color: #fff; }
        .h-btn-play:hover { background: var(--primary-color); color: #fff;}

        .movie-name-hover { font-size: 1rem; font-weight: 700; margin-bottom: 5px; }
        .movie-meta-hover { font-size: 0.8rem; display: flex; gap: 10px; color: #46d369; font-weight: 600; align-items: center;}
        .quality-tag { border: 1px solid rgba(255,255,255,0.4); padding: 1px 5px; color: #fff; font-size: 0.7rem; border-radius: 3px; }
        
        /* Mô tả ngắn trong hover */
        .movie-desc-hover {
            font-size: 0.8rem; color: #ddd; line-height: 1.4;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; /* Giới hạn 3 dòng */
            margin-top: 5px; font-weight: 300;
        }


        /* --- MODAL POPUP (XEM TẤT CẢ) --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); overflow-y: auto; padding: 50px 4%; opacity: 0; transition: opacity 0.3s;
        }
        .modal.active { display: block; opacity: 1;}
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; position: sticky; top: 0; background: var(--dark-bg); padding: 20px 0; z-index: 2001;}
        .modal-title { font-size: 2rem; }
        .close-modal { font-size: 2.5rem; color: var(--gray-text); cursor: pointer; transition: color 0.2s;}
        .close-modal:hover { color: var(--primary-color); }
        
        /* Grid Layout cho Modal */
        .modal-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px 15px;
        }
        .modal-grid .movie-card { width: 100%; height: 280px; } /* Card trong modal nhỏ hơn xíu */


        /* --- FOOTER --- */
        footer { background: var(--darker-bg); padding: 50px 4% 20px; margin-top: 50px; color: var(--gray-text); font-size: 0.9rem;}
        .footer-content { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; margin-bottom: 30px;}
        .footer-col h3 { color: #fff; margin-bottom: 15px; font-size: 1.1rem; }
        .footer-col ul { list-style: none; }
        .footer-col ul li { margin-bottom: 10px; }
        .footer-col ul li a { color: var(--gray-text); text-decoration: none; }
        .footer-col ul li a:hover { text-decoration: underline; }
        .copyright { text-align: center; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem;}
        .social-icons a { color: #fff; margin-right: 15px; font-size: 1.2rem; transition: color 0.3s;}
        .social-icons a:hover { color: var(--primary-color); }

        .loading { text-align: center; padding: 50px; color: var(--primary-color); font-size: 1.2rem;}

        /* Responsive cơ bản */
        @media (max-width: 768px) {
            .hero-title { font-size: 2.5rem; }
            .nav-links { display: none; } /* Tạm ẩn menu trên mobile cho gọn */
            .footer-content { grid-template-columns: 1fr 1fr; }
            .slider-arrow { display: none !important; } /* Ẩn nút mũi tên trên mobile, dùng cảm ứng */
        }
    </style>
</head>
<body>

    <header id="header">
        <div class="logo">
            <span class="logo-text-demo">HOPPHIM</span>
        </div>
        <ul class="nav-links">
            <li><a href="#" onclick="loadHome()">Trang chủ</a></li>
            <li><a href="#" onclick="loadCategory('phim-bo', 'Phim Bộ')">Phim Bộ</a></li>
            <li><a href="#" onclick="loadCategory('phim-le', 'Phim Lẻ')">Phim Lẻ</a></li>
            <li><a href="#" onclick="loadCountry('han-quoc', 'Phim Hàn Quốc')">Hàn Quốc</a></li>
            <li><a href="#" onclick="loadCountry('trung-quoc', 'Phim Trung Quốc')">Trung Quốc</a></li>
            <li><a href="#" onclick="loadCategory('hoat-hinh', 'Anime')">Anime</a></li>
        </ul>
        <div class="search-box">
            <i class="fas fa-search" style="color: var(--gray-text)"></i>
            <input type="text" id="searchInput" placeholder="Tìm kiếm phim, diễn viên...">
        </div>
    </header>

    <section id="hero" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Chào mừng bạn đến với HopPhim</h1>
            <p class="hero-desc">Khám phá hàng ngàn bộ phim bom tấn, phim bộ độc quyền và Anime hấp dẫn. Cập nhật liên tục, xem miễn phí chất lượng cao.</p>
        </div>
    </section>

    <main id="main-content">
        </main>

    <div id="modalPopup" class="modal">
        <div class="modal-header">
            <h2 id="modalTitle" class="modal-title">Danh sách phim</h2>
            <span class="close-modal" onclick="closeModal()">&times;</span>
        </div>
        <div id="modalContent" class="modal-grid">
            </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <h3>HopPhim</h3>
                <p>Trải nghiệm xem phim đỉnh cao, giao diện hiện đại, tốc độ nhanh chóng.</p>
                <div class="social-icons" style="margin-top: 15px;">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-col">
                <h3>Danh mục</h3>
                <ul>
                    <li><a href="#">Phim Mới</a></li>
                    <li><a href="#">Phim Chiếu Rạp</a></li>
                    <li><a href="#">Phim Bộ Đang Chiếu</a></li>
                    <li><a href="#">TV Shows</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Quốc gia</h3>
                <ul>
                    <li><a href="#">Hàn Quốc</a></li>
                    <li><a href="#">Trung Quốc</a></li>
                    <li><a href="#">Âu Mỹ</a></li>
                    <li><a href="#">Nhật Bản</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Hỗ trợ</h3>
                <ul>
                    <li><a href="#">Hỏi đáp (FAQ)</a></li>
                    <li><a href="#">Liên hệ</a></li>
                    <li><a href="#">Chính sách riêng tư</a></li>
                    <li><a href="#">Điều khoản sử dụng</a></li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2024 HopPhim. Design by a Pro Developer for my graphic designer friend.</p>
        </div>
    </footer>

    <script>
        // --- CẤU HÌNH API ---
        const API_BASE = 'https://ophim1.com/v1/api';
        const IMG_BASE = 'https://img.ophim1.com/uploads/movies/';

        // --- DOM Elements ---
        const heroSection = document.getElementById('hero');
        const mainContent = document.getElementById('main-content');
        const searchInput = document.getElementById('searchInput');
        const header = document.getElementById('header');
        const modalPopup = document.getElementById('modalPopup');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');

        // --- UTILS ---
        // Hiệu ứng scroll header
        window.addEventListener('scroll', () => {
            header.classList.toggle('scrolled', window.scrollY > 50);
        });

        // Hàm gọi API chung
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                console.error("Lỗi API:", error);
                return null;
            }
        }

        // Tạo HTML cho 1 Movie Card (Dùng chung cho Slider và Modal)
        function createCardHTML(movie) {
             // Xử lý ảnh fallback nếu lỗi
            const imgUrl = movie.thumb_url.startsWith('http') ? movie.thumb_url : `${IMG_BASE}${movie.thumb_url}`;
            // Giả lập mô tả ngắn vì API list không trả về content chi tiết, ta lấy tạm tên gốc + năm
            const shortDesc = `${movie.origin_name} (${movie.year}). Một bộ phim hấp dẫn thuộc thể loại ${movie.category ? movie.category.map(c => c.name).join(', ') : 'Hành động'}.`;

            return `
                <div class="movie-card" onclick="alert('Chức năng chuyển trang xem phim sẽ được cập nhật sau!')">
                    <img src="${imgUrl}" alt="${movie.name}" class="movie-poster" loading="lazy" onerror="this.src='https://via.placeholder.com/220x330?text=HopPhim+Error'">
                    
                    <div class="movie-info-hover">
                        <div class="hover-btns">
                             <button class="h-btn h-btn-play"><i class="fas fa-play"></i></button>
                             <button class="h-btn"><i class="fas fa-plus"></i></button>
                             <button class="h-btn" style="margin-left: auto;"><i class="fas fa-chevron-down"></i></button>
                        </div>
                        <div class="movie-name-hover">${movie.name}</div>
                         <div class="movie-meta-hover">
                            <span style="color: #46d369;">98% Match</span>
                            <span class="quality-tag">${movie.quality || 'HD'}</span>
                            <span>${movie.year}</span>
                        </div>
                         <div class="movie-desc-hover">${shortDesc}</div>
                    </div>
                </div>
            `;
        }

        // --- RENDER FUNCTIONS ---

        // 1. Load Hero Background Image (Lấy phim mới nhất làm nền)
        async function loadHeroBg() {
            const data = await fetchAPI('/home');
            if (data?.data?.items?.[0]) {
                 // Ưu tiên poster_url cho ảnh to, nếu không có thì dùng thumb
                const bgUrl = data.data.items[0].poster_url.startsWith('http') ? data.data.items[0].poster_url : `${IMG_BASE}${data.data.items[0].poster_url}`;
                heroSection.style.backgroundImage = `url('${bgUrl}')`;
            }
        }

        // 2. Tạo Slider Row (Có mũi tên và nút Xem tất cả)
        function createMovieRow(title, movies, slugForSeeAll) {
            const section = document.createElement('section');
            section.className = 'category-section';
            const rowId = 'row-' + Math.random().toString(36).substr(2, 9); // ID duy nhất cho mỗi row

            let cardsHtml = movies.map(createCardHTML).join('');

            section.innerHTML = `
                <div class="category-header">
                    <h2 class="category-title">${title}</h2>
                    ${slugForSeeAll ? `<a class="see-all-link" onclick="openModal('${slugForSeeAll}', '${title}')">Xem tất cả <i class="fas fa-chevron-right"></i></a>` : ''}
                </div>
                <div class="slider-container">
                    <button class="slider-arrow arrow-left" onclick="slide('${rowId}', 'left')"><i class="fas fa-chevron-left"></i></button>
                    <div class="movie-row" id="${rowId}">
                        ${cardsHtml}
                    </div>
                    <button class="slider-arrow arrow-right" onclick="slide('${rowId}', 'right')"><i class="fas fa-chevron-right"></i></button>
                </div>
            `;
            return section;
        }
        
        // Hàm điều khiển trượt slider
        function slide(rowId, direction) {
            const row = document.getElementById(rowId);
            const scrollAmount = row.clientWidth * 0.8; // Trượt 80% chiều rộng màn hình
            if (direction === 'left') {
                row.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                row.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }


        // 3. Load Trang Chủ (Tổng hợp nhiều mục)
        async function loadHome() {
            mainContent.innerHTML = '<div class="loading"><i class="fas fa-circle-notch fa-spin"></i> Đang tải HopPhim...</div>';
            searchInput.value = ''; // Xóa ô tìm kiếm
            
            // Gọi song song các API
            const [home, phimLe, phimBo, hanQuoc, hoatHinh] = await Promise.all([
                fetchAPI('/home'), // Lấy phim mới cập nhật
                fetchAPI('/danh-sach/phim-le'),
                fetchAPI('/danh-sach/phim-bo'),
                fetchAPI('/quoc-gia/han-quoc'),
                fetchAPI('/danh-sach/hoat-hinh')
            ]);

            mainContent.innerHTML = ''; // Clear loading

            // Thứ tự hiển thị trên trang chủ
            if (home?.data?.items) mainContent.appendChild(createMovieRow('Mới Cập Nhật', home.data.items, null)); // Home không có xem tất cả cụ thể
            if (phimLe?.data?.items) mainContent.appendChild(createMovieRow('Phim Lẻ Hot', phimLe.data.items, '/danh-sach/phim-le'));
            if (phimBo?.data?.items) mainContent.appendChild(createMovieRow('Phim Bộ Binge-Worthy', phimBo.data.items, '/danh-sach/phim-bo'));
            if (hanQuoc?.data?.items) mainContent.appendChild(createMovieRow('K-Drama Tuyển Chọn', hanQuoc.data.items, '/quoc-gia/han-quoc'));
            if (hoatHinh?.data?.items) mainContent.appendChild(createMovieRow('Thế Giới Anime', hoatHinh.data.items, '/danh-sach/hoat-hinh'));
        }

        // 4. Load danh mục riêng lẻ (Khi click menu)
        async function loadCategory(slug, title) {
            mainContent.innerHTML = '<div class="loading">Loading...</div>';
            const data = await fetchAPI(`/${slug.includes('quoc-gia') ? '' : 'danh-sach/'}${slug}`); // Hack nhẹ để check endpoint
            mainContent.innerHTML = '';
            if (data?.data?.items) {
                // Ở trang riêng thì không cần nút "Xem tất cả" nữa
                mainContent.appendChild(createMovieRow(title, data.data.items, null));
            }
        }
         // Wrapper cho quốc gia vì endpoint khác xíu
        async function loadCountry(slug, title) {
             mainContent.innerHTML = '<div class="loading">Loading...</div>';
             const data = await fetchAPI(`/quoc-gia/${slug}`);
             mainContent.innerHTML = '';
             if(data?.data?.items) {
                  mainContent.appendChild(createMovieRow(title, data.data.items, null));
             }
        }

        // --- MODAL POPUP LOGIC ---
        async function openModal(apiEndpoint, title) {
            modalTitle.innerText = title;
            modalContent.innerHTML = '<div class="loading" style="grid-column: 1/-1">Đang tải danh sách đầy đủ...</div>';
            modalPopup.classList.add('active');
            document.body.style.overflow = 'hidden'; // Khóa scroll body lại

            // Mặc định API trả về 1 trang, muốn lấy nhiều phải loop hoặc pagination (Demo lấy 2 trang cho nhiều)
            const [page1, page2] = await Promise.all([
                fetchAPI(apiEndpoint + '?page=1'),
                fetchAPI(apiEndpoint + '?page=2')
            ]);
            
            let allMovies = [];
            if (page1?.data?.items) allMovies = [...page1.data.items];
            if (page2?.data?.items) allMovies = [...allMovies, ...page2.data.items];

            if (allMovies.length > 0) {
                modalContent.innerHTML = allMovies.map(createCardHTML).join('');
            } else {
                 modalContent.innerHTML = '<div style="grid-column: 1/-1; text-align: center;">Không tải được dữ liệu.</div>';
            }
        }

        function closeModal() {
            modalPopup.classList.remove('active');
            document.body.style.overflow = 'auto'; // Mở khóa scroll
             // Đợi animation đóng xong mới xóa content để tránh giật
            setTimeout(() => { modalContent.innerHTML = ''; }, 300);
        }
        
        // Đóng modal khi click ra ngoài
        window.onclick = function(event) {
            if (event.target == modalPopup) closeModal();
        }

        // --- SEARCH LOGIC (Debounce) ---
        let timeout = null;
        searchInput.addEventListener('keyup', function (e) {
            clearTimeout(timeout);
            timeout = setTimeout(async () => {
                const keyword = e.target.value;
                if (keyword.length > 1) {
                    const data = await fetchAPI(`/tim-kiem?keyword=${keyword}`);
                    mainContent.innerHTML = '';
                    if (data?.data?.items?.length > 0) {
                        // Tìm kiếm thì hiện dạng Grid luôn cho dễ nhìn, tái sử dụng class modal-grid
                        mainContent.innerHTML = `
                            <section class="category-section">
                                <h2 class="category-title">Kết quả tìm kiếm: "${keyword}"</h2>
                                <div class="modal-grid" style="margin-top: 20px;">
                                    ${data.data.items.map(createCardHTML).join('')}
                                </div>
                            </section>
                        `;
                    } else {
                        mainContent.innerHTML = `<h3 style="text-align:center; padding:50px; color: var(--gray-text)">Không tìm thấy phim nào cho "${keyword}"</h3>`;
                    }
                } else if (keyword.length === 0) {
                    loadHome();
                }
            }, 500);
        });

        // --- INIT ---
        loadHeroBg(); // Load ảnh nền cho Hero
        loadHome();   // Load nội dung chính
    </script>
</body>
</html>