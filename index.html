<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HopPhim - Phim Hay Trong Tầm Tay</title>
    
    <meta property="og:title" content="HopPhim - Phim Hay Trong Tầm Tay" />
    <meta property="og:description" content="Trang xem phim trực tuyến miễn phí chất lượng cao." />
    <meta property="og:image" content="https://hopphim.netlify.app/panel.webp" />
    <meta property="og:url" content="https://hopphim.netlify.app" />
    <meta property="og:type" content="article" />

    <link rel="icon" type="image/webp" href="LOGO.WEBP" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-body: #191b24; 
            --bg-dark: #0f111a; 
            --text-main: #ffffff; 
            --text-sub: #a0a0a0;
            --gradient-main: linear-gradient(90deg, #FF8F50, #FF5E62); 
            --primary-color: #FF5E62;
            --badge-bg: linear-gradient(135deg, #FF8F50 0%, #FF5E62 100%);
            --font-main: 'Inter', sans-serif; 
            --card-radius: 12px;
            --mobile-menu-bg: #15171e; 
            --mobile-border: rgba(255,255,255,0.05);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); overflow-x: hidden; }
        .text-gradient { background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: inline-block; }

        /* --- TOAST & CONFIRM (Giữ nguyên) --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: #23252f; color: #fff; padding: 15px 25px; border-radius: 12px; display: flex; align-items: center; gap: 12px; min-width: 300px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-left: 4px solid var(--primary-color); animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1); pointer-events: auto; }
        .toast.success { border-left-color: #2ecc71; } .toast.error { border-left-color: #ff4757; } .toast i { font-size: 1.2rem; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .custom-confirm-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 10001; display: none; justify-content: center; align-items: center; opacity: 0; transition: 0.3s; backdrop-filter: blur(5px); }
        .custom-confirm-overlay.active { display: flex; opacity: 1; }
        .confirm-box { background: #1f222e; width: 90%; max-width: 400px; padding: 30px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .custom-confirm-overlay.active .confirm-box { transform: scale(1); }
        .confirm-icon { font-size: 3rem; margin-bottom: 15px; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .confirm-title { font-size: 1.2rem; font-weight: 700; color: #fff; margin-bottom: 10px; }
        .confirm-desc { font-size: 0.95rem; color: var(--text-sub); margin-bottom: 25px; line-height: 1.5; }
        .confirm-actions { display: flex; gap: 15px; justify-content: center; }
        .btn-confirm { padding: 10px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; font-size: 0.95rem; }
        .btn-cancel { background: transparent; color: #ccc; border: 1px solid rgba(255,255,255,0.2); } .btn-cancel:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-ok { background: var(--gradient-main); color: #fff; box-shadow: 0 4px 15px rgba(255, 94, 98, 0.3); } .btn-ok:hover { transform: translateY(-2px); }

        /* --- LOADING SCREEN --- */
        #loadingScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--bg-body); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .loading-img { width: 800px; max-width: 80vw; height: auto; object-fit: contain; animation: zoomIn 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards, floatIdle 4s ease-in-out infinite 0.8s; }
        .loading-img.zoom-out { animation: zoomOut 0.5s cubic-bezier(0.6, -0.28, 0.74, 0.05) forwards !important; }
        @media (max-width: 900px) { .loading-img { width: 500px; } }
        @keyframes zoomIn { 0% { transform: scale(1.1); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes floatIdle { 0% { transform: scale(1); } 50% { transform: scale(0.85); } 100% { transform: scale(1); } }
        @keyframes zoomOut { from { transform: scale(1); opacity: 1; } to { transform: scale(2.2); opacity: 0; } }

        /* ======================== HEADER PC (MENU MỚI) ======================== */
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; padding: 0 4%; 
            display: flex; justify-content: space-between; align-items: center; 
            z-index: 1000; background: transparent; transition: all 0.3s ease-in-out; 
        }
        header.scrolled { background: var(--bg-dark); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        
        .header-left-group { display: flex; align-items: center; gap: 30px; height: 100%; }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; z-index: 1002; }
        .logo img { height: 40px; object-fit: contain; }
        .logo-text { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        /* Nav Links */
        .nav-links { display: flex; gap: 15px; list-style: none; height: 100%; align-items: center; }
        
        /* Item của Menu */
        .nav-item { 
            position: relative; height: 100%; display: flex; align-items: center; 
            padding: 0 10px; cursor: pointer;
        }
        
        .nav-link { 
            color: #ccc; text-decoration: none; font-size: 14px; font-weight: 600; 
            text-transform: uppercase; transition: 0.3s; white-space: nowrap; 
            display: flex; align-items: center; gap: 5px;
        }
        .nav-item:hover .nav-link { color: #fff; }
        .nav-link i { font-size: 0.8rem; margin-top: -2px; }

        /* DROPDOWN MENU (BẢNG XỔ XUỐNG) */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 70px; /* Bằng chiều cao header */
            left: 0;
            background: rgba(15, 17, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-top: 2px solid var(--primary-color);
            padding: 20px;
            border-radius: 0 0 12px 12px;
            width: 500px; /* Chiều rộng bảng */
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform-origin: top left;
            animation: fadeIn 0.2s ease-out;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Cột */
            gap: 12px;
        }

        .dropdown-item-link {
            color: #a0a0a0; text-decoration: none; font-size: 0.9rem; transition: 0.2s;
            padding: 5px 8px; border-radius: 6px;
        }
        .dropdown-item-link:hover {
            color: #fff; background: rgba(255,255,255,0.1);
        }

        /* Hover vào Nav Item thì hiện Dropdown */
        .nav-item:hover .dropdown-menu { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Right Elements */
        .right-elements { display: flex; align-items: center; gap: 15px; }
        .search-box { display: flex; align-items: center; background: #23252f; padding: 8px 16px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); }
        .search-box input { background: transparent; border: none; color: #fff; margin-left: 10px; font-family: var(--font-main); font-size: 14px; width: 150px; }
        .menu-toggle, .mobile-search-trigger { display: none; font-size: 1.5rem; color: #fff; cursor: pointer; }
        .btn-login { background: var(--gradient-main); color: #fff; border: none; padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: 0.3s; white-space: nowrap; }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255, 94, 98, 0.4); }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary-color); cursor: pointer; display: none; object-fit: cover; }
        .user-dropdown { position: absolute; top: 100%; right: 0; width: 200px; margin-top: 15px; background: #23252f; border-radius: 8px; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .user-dropdown.active { display: flex; }
        .user-info-item { padding: 12px; color: #fff; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .dropdown-item { background: transparent; border: none; color: #ccc; text-align: left; padding: 10px; cursor: pointer; transition: 0.2s; border-radius: 4px; font-size: 0.9rem; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: #fff; }

        /* --- HERO SECTION --- */
        .hero { 
            height: 70vh; 
            display: flex; align-items: center; justify-content: center; 
            position: relative; 
            background-image: url('home-background.jpg'); 
            background-size: cover; background-position: center center; background-repeat: no-repeat; 
        }
        .hero::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; 
            height: 250px; 
            /* Gradient làm mờ chân Hero vào nền web */
            background: linear-gradient(to bottom, transparent 0%, var(--bg-body) 100%); 
            z-index: 1; pointer-events: none; 
        }
        .hero-content { z-index: 10; text-align: center; max-width: 900px; padding: 20px; animation: fadeUp 1s ease-out; }
        .hero-title { font-size: 4rem; font-weight: 900; margin-bottom: 15px; letter-spacing: -2px; background: var(--gradient-main); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3)); }
        .hero-desc { font-size: 1.2rem; color: #fff; font-weight: 500; max-width: 700px; margin: 0 auto; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        main { position: relative; z-index: 20; padding-bottom: 50px; }
        .category-section { padding: 0 4% 40px; }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-left: 4px solid var(--primary-color); padding-left: 15px; }
        .category-title { font-size: 1.5rem; font-weight: 800; text-transform: uppercase; letter-spacing: -0.5px; }
        .see-all-link { color: var(--text-sub); font-size: 0.9rem; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .see-all-link:hover { color: var(--primary-color); }

        /* --- SLIDER (Regular Movies) --- */
        .slider-container { position: relative; }
        .movie-row { display: flex; gap: 15px; overflow-x: auto; scroll-behavior: smooth; padding: 10px 0; scrollbar-width: none; }
        .movie-row::-webkit-scrollbar { display: none; }
        .slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); z-index: 50; width: 45px; height: 45px; border-radius: 50%; background: rgba(15,17,26, 0.8); color: #fff; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; opacity: 0; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .slider-container:hover .slider-arrow { opacity: 1; } .slider-arrow:hover { background: var(--primary-color); border-color: var(--primary-color); }
        .arrow-left { left: -20px; } .arrow-right { right: -20px; }

        /* --- MOVIE CARD (Regular) --- */
        .movie-card { flex: 0 0 200px; height: 300px; position: relative; border-radius: var(--card-radius); overflow: hidden; cursor: pointer; background: #23252f; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.3s ease; }
        .movie-poster { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .card-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.5) 30%, transparent 60%); z-index: 2; pointer-events: none; }
        .card-info { position: absolute; bottom: 0; left: 0; width: 100%; padding: 12px; z-index: 5; transition: transform 0.3s ease; }
        .movie-name { font-size: 1rem; font-weight: 700; color: #fff; margin-bottom: 6px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .movie-meta { display: flex; align-items: center; gap: 8px; font-size: 0.75rem; color: #e0e0e0; font-weight: 500; }
        .badge-hd { background: var(--badge-bg); color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 800; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .dot { width: 4px; height: 4px; background: #FF5E62; border-radius: 50%; }
        .hover-actions { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 10px; z-index: 6; opacity: 0; transition: all 0.3s ease; }
        .btn-hover-play, .btn-hover-delete { width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.2); backdrop-filter: blur(4px); border: 2px solid #fff; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.2s; cursor: pointer; }
        .btn-hover-delete { background: rgba(255, 71, 87, 0.8); }
        .btn-hover-play:hover { background: var(--primary-color); border-color: var(--primary-color); transform: scale(1.1); }
        .btn-hover-delete:hover { background: #ff4757; transform: scale(1.1); border-color: #ff4757; }
        .movie-card:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 10px 25px rgba(0,0,0,0.6); }
        .movie-card:hover .movie-poster { filter: brightness(0.6); }
        .movie-card:hover .hover-actions { opacity: 1; }

        /* ======================== TOP 5 SECTION (STYLE ẢNH 2: POSTER TRÊN, SỐ NGOÀI) ======================== */
        .top-10-wrapper {
            position: relative;
            z-index: 20; 
            margin-top: 50px; 
            padding-bottom: 20px;
        }

        .top-10-header {
            padding: 0 4% 10px;
            display: flex; align-items: center; gap: 15px;
        }
        
        .top-10-header h2 {
            font-size: 2.2rem; font-weight: 900; font-style: italic; text-transform: uppercase; color: #fff; 
            text-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 10px;
        }

        /* GRID LAYOUT CHO TOP 5 PC */
        .top-5-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 Cột đều nhau */
            gap: 20px;
            padding: 20px 4%;
        }

        /* CARD TOP MỚI */
        .top-card-style2 {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .top-card-style2:hover {
            transform: translateY(-10px);
        }

        /* Khung Poster */
        .top-poster-style2 {
            width: 100%;
            aspect-ratio: 2/3; /* Tỷ lệ poster chuẩn */
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .top-poster-style2 img { width: 100%; height: 100%; object-fit: cover; }

        /* INFO ROW: Hàng ngang chứa Số + Text */
        .top-info-row {
            display: flex;
            align-items: flex-start; /* Căn hàng trên */
            margin-top: 15px; /* Cách poster ra */
        }

        /* SỐ HẠNG: Nằm bên trái, to, màu vàng */
        .top-rank-style2 {
            font-size: 4rem; 
            line-height: 0.9;
            font-family: 'Impact', sans-serif;
            font-style: italic;
            font-weight: 900;
            color: #eebb5d; /* Màu vàng kem */
            margin-right: 15px; 
            text-shadow: 2px 2px 0px #000;
            flex-shrink: 0; /* Không bị co lại */
        }

        /* Khối chữ: Bên phải */
        .top-text-style2 {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-top: 2px;
        }

        .top-title-style2 {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            line-height: 1.4;
            margin-bottom: 4px;
            
            /* Cắt chữ nếu quá dài (2 dòng) */
            display: -webkit-box;
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .top-meta-style2 {
            font-size: 0.8rem;
            color: #888;
        }

        /* ======================== FOOTER & MODAL ======================== */
        footer { background: var(--bg-dark); padding: 60px 4% 20px; margin-top: 80px; border-top: 1px solid #23252f; font-size: 0.9rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px; margin-bottom: 40px; }
        .footer-col h3 { font-size: 1.1rem; color: #fff; margin-bottom: 20px; font-weight: 700; }
        .footer-brand { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .footer-brand img { height: 50px; object-fit: contain; }
        .footer-col ul { list-style: none; } .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: var(--text-sub); text-decoration: none; transition: 0.3s; } .footer-col ul li a:hover { color: var(--primary-color); padding-left: 5px; }
        .footer-bottom { border-top: 1px solid #23252f; padding-top: 20px; display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 0.8rem; }
        .modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(15, 17, 26, 0.95); padding: 40px; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .modal-grid .movie-card { width: 100%; height: 280px; }

        /* --- MOBILE OVERLAYS & RESPONSIVE --- */
        .mobile-overlay { display: none; position: fixed; inset: 0; z-index: 3000; transition: 0.3s ease-in-out; }
        .mobile-overlay.active { transform: translateX(0) !important; opacity: 1 !important; }
        .close-btn-overlay { position: absolute; font-size: 1.8rem; color: #fff; cursor: pointer; z-index: 10; }
        @media (max-width: 900px) {
            header { height: 60px; padding: 0 4%; justify-content: space-between; }
            .header-left-group { gap: 25px; order: 1; }
            .menu-toggle { display: block; font-size: 1.5rem; }
            .logo { order: 2; margin: 0; } .logo img { height: 32px; } .logo-text { display: block; font-size: 1.2rem; }
            .right-elements { order: 3; gap: 15px; }
            .mobile-search-trigger { display: block; font-size: 1.2rem; }
            .nav-links, .search-box, .desktop-auth { display: none !important; }
            #mobileMenuOverlay { display: block; background: var(--mobile-menu-bg); transform: translateX(-100%); padding: 25px; width: 300px; box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
            .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
            .menu-logo { display: flex; align-items: center; gap: 10px; } .menu-logo img { height: 35px; } .menu-logo span { font-weight: 800; font-size: 1.2rem; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
            #mobileMenuOverlay .close-btn-overlay { position: static; color: #fff; opacity: 0.7; }
            .member-btn-large { width: 100%; padding: 12px; background: linear-gradient(90deg, #FF8F50, #FF5E62); color: #fff; border: none; border-radius: 8px; font-weight: 700; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 25px; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 94, 98, 0.3); }
            .mobile-menu-grid { display: flex; flex-direction: column; gap: 5px; }
            .mobile-menu-link { color: #ccc; text-decoration: none; font-weight: 600; font-size: 1rem; padding: 12px 0; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--mobile-border); }
            .mobile-menu-link i { width: 25px; color: var(--primary-color); text-align: center; } .mobile-menu-link:hover { color: #fff; padding-left: 5px; transition: 0.2s; }
            #mobileSearchOverlay { display: block; background: #1f212d; transform: translateY(-100%); opacity: 0; }
            #mobileSearchOverlay.active { transform: translateY(0) !important; opacity: 1 !important; }
            .search-header-mobile { display: flex; align-items: center; padding: 15px 20px; background: #2a2d3a; border-bottom: 1px solid rgba(255,255,255,0.1); }
            .search-input-mobile { flex: 1; background: transparent; border: none; color: #fff; font-size: 1rem; font-family: var(--font-main); margin-right: 15px; }
            #mobileSearchOverlay .close-btn-overlay { position: static; color: #fff; }
            .search-content-mobile { padding: 20px; overflow-y: auto; height: calc(100vh - 70px); }
            
            /* Responsive cho Top 5 (Mobile: Trượt ngang) */
            .top-5-grid {
                display: flex; gap: 15px; overflow-x: auto; padding: 10px 4% 20px;
                scroll-behavior: smooth; scrollbar-width: none;
            }
            .top-5-grid::-webkit-scrollbar { display: none; }
            .top-card-style2 { flex: 0 0 160px; /* Chiều rộng card trên mobile */ }
            .top-rank-style2 { font-size: 3rem; margin-right: 10px; }
            .top-title-style2 { font-size: 0.9rem; }
            
            .hero { height: 50vh; } .hero-title { font-size: 2.2rem; } .hero-desc { font-size: 0.9rem; }
            .movie-card { flex: 0 0 140px; height: 210px; }
            .slider-arrow { display: none; }
            .footer-grid { grid-template-columns: 1fr 1fr; gap: 20px; }
            .footer-col:first-child { grid-column: span 2; text-align: center; }
            .footer-brand { justify-content: center; }
            .hover-actions { display: none; }
        }
    </style>
</head>
<body>

    <div id="loadingScreen">
        <img src="/Loading.png" class="loading-img" alt="Loading...">
    </div>

    <div id="toast-container"></div>

    <div id="confirmModal" class="custom-confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-icon"><i class="fas fa-exclamation-circle"></i></div>
            <h3 class="confirm-title">Xác nhận</h3>
            <p class="confirm-desc" id="confirmMsg">Bạn có chắc chắn muốn thực hiện hành động này?</p>
            <div class="confirm-actions">
                <button class="btn-confirm btn-cancel" id="btnConfirmNo">Hủy bỏ</button>
                <button class="btn-confirm btn-ok" id="btnConfirmYes">Đồng ý</button>
            </div>
        </div>
    </div>

    <div id="mobileMenuOverlay" class="mobile-overlay">
        <div class="menu-header">
            <div class="menu-logo"><img src="/LOGO.WEBP" alt="HopPhim"><span>HOPPHIM</span></div>
             <i class="fas fa-times close-btn-overlay" onclick="closeMobileMenu()"></i>
        </div>
        <button class="member-btn-large" id="mobileMemberBtn" onclick="window.location.href='/login.html'">
            <i class="fas fa-user-circle"></i> <span id="mobileMemberText">Đăng nhập / Đăng ký</span>
        </button>
        <div class="mobile-menu-grid">
            <a href="/" class="mobile-menu-link" onclick="closeMobileMenu(); loadHome()"><i class="fas fa-home"></i> Trang chủ</a>
            
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCategory('phim-bo', 'Phim Bộ')"><i class="fas fa-tv"></i> Phim Bộ</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCategory('phim-le', 'Phim Lẻ')"><i class="fas fa-film"></i> Phim Lẻ</a>

            <div style="border-bottom: 1px solid var(--mobile-border); padding: 10px 0; color:#666; font-size:0.9rem; font-weight:700; text-transform:uppercase;">Thể Loại</div>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCategory('hanh-dong', 'Hành Động')"><i class="fas fa-fist-raised"></i> Hành Động</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCategory('tinh-cam', 'Tình Cảm')"><i class="fas fa-heart"></i> Tình Cảm</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCategory('kinh-di', 'Kinh Dị')"><i class="fas fa-ghost"></i> Kinh Dị</a>

            <div style="border-bottom: 1px solid var(--mobile-border); padding: 10px 0; color:#666; font-size:0.9rem; font-weight:700; text-transform:uppercase; margin-top:10px;">Quốc Gia</div>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCountry('han-quoc', 'Hàn Quốc')"><i class="fas fa-globe-asia"></i> Hàn Quốc</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCountry('trung-quoc', 'Trung Quốc')"><i class="fas fa-torii-gate"></i> Trung Quốc</a>
            <a href="#" class="mobile-menu-link" onclick="closeMobileMenu(); loadCountry('au-my', 'Âu Mỹ')"><i class="fas fa-globe-americas"></i> Âu Mỹ</a>

            <a href="hopteam.html" class="mobile-menu-link" onclick="closeMobileMenu()" style="margin-top:15px; border-top:1px solid var(--mobile-border);"><i class="fas fa-users"></i> Về HopTeam</a>
            <a href="/profile.html" class="mobile-menu-link" id="mobileAccountLink" style="display: none;" onclick="closeMobileMenu()"><i class="fas fa-user-cog"></i> Quản lý tài khoản</a>
        </div>
    </div>

    <div id="mobileSearchOverlay" class="mobile-overlay">
        <div class="search-header-mobile">
            <i class="fas fa-search" style="color: #a0a0a0; margin-right: 10px;"></i>
            <input type="text" id="mobileSearchInput" class="search-input-mobile" placeholder="Nhập tên phim...">
            <i class="fas fa-times close-btn-overlay" onclick="closeMobileSearch()"></i>
        </div>
        <div class="search-content-mobile"><div id="mobileSearchResults"></div></div>
    </div>

    <header id="header">
        <div class="header-left-group">
            <div class="menu-toggle" onclick="openMobileMenu()"><i class="fas fa-bars"></i></div>
            <div class="logo" onclick="loadHome()"><img src="/LOGO.WEBP" alt="HopPhim"><span class="logo-text">HOPPHIM</span></div>
            
            <ul class="nav-links" id="navLinks">
                <li class="nav-item">
                    <a href="/" class="nav-link" onclick="loadHome()">Trang chủ</a>
                </li>
                
                <li class="nav-item">
                    <div class="nav-link">Thể loại <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu">
                        <div class="dropdown-grid">
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hanh-dong', 'Hành Động')">Hành Động</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tinh-cam', 'Tình Cảm')">Tình Cảm</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hai-huoc', 'Hài Hước')">Hài Hước</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('co-trang', 'Cổ Trang')">Cổ Trang</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tam-ly', 'Tâm Lý')">Tâm Lý</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hinh-su', 'Hình Sự')">Hình Sự</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('chien-tranh', 'Chiến Tranh')">Chiến Tranh</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('the-thao', 'Thể Thao')">Thể Thao</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vo-thuat', 'Võ Thuật')">Võ Thuật</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vien-tuong', 'Viễn Tưởng')">Viễn Tưởng</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('phieu-luu', 'Phiêu Lưu')">Phiêu Lưu</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('khoa-hoc', 'Khoa Học')">Khoa Học</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('kinh-di', 'Kinh Dị')">Kinh Dị</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('am-nhac', 'Âm Nhạc')">Âm Nhạc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('than-thoai', 'Thần Thoại')">Thần Thoại</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tai-lieu', 'Tài Liệu')">Tài Liệu</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('gia-dinh', 'Gia Đình')">Gia Đình</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hoc-duong', 'Học Đường')">Học Đường</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-le', 'Phim Lẻ')">Phim Lẻ</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-bo', 'Phim Bộ')">Phim Bộ</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('hoat-hinh', 'Hoạt Hình')">Hoạt Hình</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('tv-shows', 'TV Shows')">TV Shows</a></li>

                <li class="nav-item">
                    <div class="nav-link">Quốc gia <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu" style="width: 400px;"> <div class="dropdown-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('trung-quoc', 'Trung Quốc')">Trung Quốc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('han-quoc', 'Hàn Quốc')">Hàn Quốc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('nhat-ban', 'Nhật Bản')">Nhật Bản</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('thai-lan', 'Thái Lan')">Thái Lan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('au-my', 'Âu Mỹ')">Âu Mỹ</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('dai-loan', 'Đài Loan')">Đài Loan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('hong-kong', 'Hồng Kông')">Hồng Kông</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('an-do', 'Ấn Độ')">Ấn Độ</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('viet-nam', 'Việt Nam')">Việt Nam</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="hopteam.html" class="nav-link">Về HopTeam</a></li>
            </ul>
        </div>
        
        <div class="right-elements">
            <div class="mobile-search-trigger" onclick="openMobileSearch()"><i class="fas fa-search"></i></div>
            <div class="search-box"><i class="fas fa-search" style="color: #a0a0a0"></i><input type="text" id="searchInput" placeholder="Tìm kiếm phim..."></div>
            <div class="desktop-auth" style="position: relative;">
                <button id="btnLogin" class="btn-login" onclick="window.location.href='/login.html'">Đăng nhập</button>
                <img id="userAvatar" class="user-avatar" src="" alt="User" onclick="toggleUserDropdown()">
                <div id="userMenu" class="user-dropdown">
                    <div id="userNameDisplay" class="user-info-item">User</div>
                    <button class="dropdown-item" onclick="window.location.href='/profile.html'"><i class="fas fa-user-cog"></i> Tài khoản</button>
                    <button class="dropdown-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                </div>
            </div>
        </div>
    </header>

    <section id="hero" class="hero">
        <div class="hero-content">
            <h1 class="hero-title">HopPhim - Phim Hay<br>Trong Tầm Tay</h1>
            <p class="hero-desc">Kho phim miễn phí chất lượng cao, cập nhật liên tục 24/7. Trải nghiệm điện ảnh đỉnh cao ngay tại nhà.</p>
        </div>
    </section>

    <div id="history-container"></div>

    <main id="main-content"></main>

    <div id="modalPopup" class="modal">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; color:#fff; align-items:center;">
                <h2 id="modalTitle" class="text-gradient" style="font-size: 1.5rem; font-weight:800">Danh sách</h2>
                <span onclick="closeModal()" style="font-size:2rem; cursor:pointer; padding:5px;">&times;</span>
            </div>
            <div id="modalContent" class="modal-grid"></div>
        </div>
    </div>

    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <div class="footer-brand"><img src="/logo.webp" alt="HopPhim"><span class="logo-text">HOPPHIM</span></div>
                <p style="color: #a0a0a0; line-height: 1.6; margin-top: 15px;">Trang xem phim trực tuyến miễn phí chất lượng cao.</p>
            </div>
            <div class="footer-col">
                <h3>Danh mục</h3>
                <ul>
                    <li><a href="#" onclick="loadCategory('phim-moi', 'Phim Mới Cập Nhật')">Phim Mới Cập Nhật</a></li>
                    <li><a href="#" onclick="loadCategory('phim-le', 'Phim Lẻ')">Phim Chiếu Rạp</a></li>
                    <li><a href="#" onclick="loadCategory('phim-bo', 'Phim Bộ')">Phim Bộ Độc Quyền</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Quốc gia</h3>
                <ul>
                    <li><a href="#" onclick="loadCountry('han-quoc', 'Hàn Quốc')">Hàn Quốc</a></li>
                    <li><a href="#" onclick="loadCountry('trung-quoc', 'Trung Quốc')">Trung Quốc</a></li>
                    <li><a href="#" onclick="loadCountry('au-my', 'Âu Mỹ')">Âu Mỹ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Hỗ trợ</h3>
                <ul>
                    <li><a href="#">Liên hệ quảng cáo</a></li>
                    <li><a href="#">Báo lỗi</a></li>
                    <li><a href="hopteam.html">Về HopTeam</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom"><p>&copy; 2026 HopPhim. All Rights Reserved By HopTeam.</p></div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAT6SnKojUmsisDhnuEtsL3H59NwrhZxDc",
            authDomain: "hopphim-29e1c.firebaseapp.com",
            projectId: "hopphim-29e1c",
            storageBucket: "hopphim-29e1c.firebasestorage.app",
            messagingSenderId: "1076044580405",
            appId: "1:1076044580405:web:a3485f8533604f305e537c",
            measurementId: "G-6RT4CX2NR0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Elements
        const btnLogin = document.getElementById('btnLogin');
        const userAvatar = document.getElementById('userAvatar');
        const userMenu = document.getElementById('userMenu');
        const mobileMemberBtn = document.getElementById('mobileMemberBtn');
        const mobileMemberText = document.getElementById('mobileMemberText');
        const mobileAccountLink = document.getElementById('mobileAccountLink');
        const historyContainer = document.getElementById('history-container');

        let currentUser = null;

        // AUTH FUNCTIONS
        window.logout = async () => {
            const ok = await window.customConfirm("Bạn có chắc muốn đăng xuất?");
            if(ok) {
                await signOut(auth);
                userMenu.classList.remove('active');
                closeMobileMenu();
                window.showToast("Đã đăng xuất!", "success");
            }
        }
        window.toggleUserDropdown = () => userMenu.classList.toggle('active');

        // AUTH STATE OBSERVER
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const photo = user.photoURL || '/Guest.webp';
                const name = user.displayName || 'Thành viên';

                btnLogin.style.display = 'none';
                userAvatar.style.display = 'block';
                userAvatar.src = photo;
                document.getElementById('userNameDisplay').innerText = name;

                mobileMemberText.innerText = name;
                mobileMemberBtn.innerHTML = `<img src="${photo}" style="width:30px;height:30px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color)"> <span>${name}</span>`;
                mobileMemberBtn.onclick = () => window.location.href = '/profile.html';
                mobileAccountLink.style.display = 'flex';

                loadHistory(user.uid);
            } else {
                currentUser = null;
                btnLogin.style.display = 'block';
                userAvatar.style.display = 'none';
                userMenu.classList.remove('active');

                mobileMemberText.innerText = "Đăng nhập / Đăng ký";
                mobileMemberBtn.innerHTML = `<i class="fas fa-user-circle"></i> <span>Đăng nhập / Đăng ký</span>`;
                mobileMemberBtn.onclick = () => window.location.href='/login.html';
                mobileAccountLink.style.display = 'none';

                historyContainer.innerHTML = '';
            }
        });

        // 1. HELPER: SHOW TOAST
        window.showToast = (msg, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${msg}</span>`;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // 2. HELPER: CUSTOM CONFIRM
        window.customConfirm = (message) => {
            return new Promise((resolve) => {
                const overlay = document.getElementById('confirmModal');
                const msgEl = document.getElementById('confirmMsg');
                const btnYes = document.getElementById('btnConfirmYes');
                const btnNo = document.getElementById('btnConfirmNo');

                msgEl.innerText = message;
                overlay.classList.add('active');

                btnYes.onclick = () => { overlay.classList.remove('active'); resolve(true); };
                btnNo.onclick = () => { overlay.classList.remove('active'); resolve(false); };
            });
        }

        // 3. XÓA KHỎI LỊCH SỬ
        window.removeFromHistory = async (slug) => {
            if(!currentUser) return;
            const confirm = await window.customConfirm("Bạn có chắc muốn xóa phim này khỏi lịch sử?");
            if(!confirm) return;

            const userRef = doc(db, "users", currentUser.uid);
            try {
                const docSnap = await getDoc(userRef);
                if(!docSnap.exists()) return;

                let history = docSnap.data().watchHistory || [];
                const newHistory = history.filter(m => m.slug !== slug);
                
                await updateDoc(userRef, { watchHistory: newHistory });
                
                if (newHistory.length === 0) {
                    historyContainer.innerHTML = ''; 
                } else {
                    renderHistoryRow(newHistory.slice().reverse()); 
                }
                window.showToast("Đã xóa khỏi lịch sử!");
            } catch(e) { 
                console.error(e);
                window.showToast("Lỗi khi xóa phim!", "error");
            }
        }

        // 4. THÊM VÀO DANH SÁCH
        window.addToMyList = async (movieSlug, movieName, thumbUrl) => {
            if (!currentUser) {
                window.showToast("Vui lòng đăng nhập để lưu!", "error");
                return setTimeout(() => window.location.href = '/login.html', 1500);
            }

            const userRef = doc(db, "users", currentUser.uid);
            try {
                const docSnap = await getDoc(userRef);
                let list = docSnap.exists() ? (docSnap.data().myList || []) : [];
                
                if (list.some(m => m.slug === movieSlug)) {
                    window.showToast("Phim đã có trong danh sách!", "error");
                    return;
                }
                
                list.push({ slug: movieSlug, name: movieName, thumb_url: thumbUrl, timestamp: Date.now() });
                
                if(docSnap.exists()) await updateDoc(userRef, { myList: list });
                else await setDoc(userRef, { email: currentUser.email, myList: list });

                window.showToast("Đã thêm vào danh sách yêu thích!");
            } catch (e) { window.showToast("Lỗi lưu phim: " + e.message, "error"); }
        };

        // LOAD HISTORY
        async function loadHistory(uid) {
            try {
                const docSnap = await getDoc(doc(db, "users", uid));
                if(docSnap.exists() && docSnap.data().watchHistory && docSnap.data().watchHistory.length > 0) {
                    const history = docSnap.data().watchHistory.reverse();
                    renderHistoryRow(history);
                } else {
                    historyContainer.innerHTML = ''; 
                }
            } catch(e) { console.error(e); }
        }

        function renderHistoryRow(movies) {
            const section = document.createElement('section');
            section.className = 'category-section';
            const rowId = 'history-row';
            const html = movies.map(m => window.createHistoryCardHTML(m)).join('');
            
            section.innerHTML = `
                <div class="category-header">
                    <h2 class="category-title text-gradient"><i class="fas fa-history"></i> Xem tiếp</h2>
                </div>
                <div class="slider-container">
                    <button class="slider-arrow arrow-left" onclick="window.slide('${rowId}', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="movie-row" id="${rowId}">${html}</div>
                    <button class="slider-arrow arrow-right" onclick="window.slide('${rowId}', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>`;
            historyContainer.innerHTML = '';
            historyContainer.appendChild(section);
        }
    </script>

    <script>
        // --- NEW LOADING LOGIC ---
        function hideLoading() {
            const screen = document.getElementById('loadingScreen');
            const img = document.querySelector('.loading-img');
            if(screen && img) {
                img.classList.add('zoom-out');
                setTimeout(() => {
                    screen.style.display = 'none';
                }, 500); 
            }
        }
        setTimeout(() => { hideLoading(); }, 2500);

        // --- TIME HELPER ---
        function timeSince(date) {
            if (!date) return "Gần đây";
            const seconds = Math.floor((Date.now() - date) / 1000);
            if (seconds < 60) return "Vừa xong";
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return minutes + " phút trước";
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return hours + " giờ trước";
            return Math.floor(hours / 24) + " ngày trước";
        }

        // --- MOBILE OVERLAY FUNCTIONS ---
        const menuOverlay = document.getElementById('mobileMenuOverlay');
        const searchOverlay = document.getElementById('mobileSearchOverlay');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const mobileSearchResults = document.getElementById('mobileSearchResults');

        function openMobileMenu() { menuOverlay.classList.add('active'); }
        function closeMobileMenu() { menuOverlay.classList.remove('active'); }

        async function openMobileSearch() {
            searchOverlay.classList.add('active');
            mobileSearchInput.focus();
            if(!mobileSearchResults.hasChildNodes()) {
                 const data = await fetchAPI('/danh-sach/phim-le?page=1');
                 if(data?.data?.items) {
                      mobileSearchResults.innerHTML = '';
                      mobileSearchResults.appendChild(createMovieRow('Phim Đề Xuất', data.data.items));
                 }
            }
        }
        function closeMobileSearch() {
            searchOverlay.classList.remove('active');
            mobileSearchInput.value = '';
        }
        
        let mobileSearchTimeout = null;
        mobileSearchInput.addEventListener('keyup', (e) => {
            clearTimeout(mobileSearchTimeout);
            mobileSearchTimeout = setTimeout(() => {
                const keyword = e.target.value;
                if(keyword.length > 2) {
                      mobileSearchResults.innerHTML = '<div class="loader-spinner" style="margin: 20px auto;"></div>';
                      fetchAPI(`/tim-kiem?keyword=${keyword}`).then(data => {
                        mobileSearchResults.innerHTML = '';
                        if(data?.data?.items) {
                            mobileSearchResults.appendChild(createMovieRow(`Kết quả: ${keyword}`, data.data.items));
                        } else {
                             mobileSearchResults.innerHTML = '<div style="color:#ccc;text-align:center;padding:20px;">Không tìm thấy</div>';
                        }
                    });
                }
            }, 500);
        });

        // --- CORE LOGIC ---
        const navLinks = document.getElementById('navLinks');
        const searchInput = document.getElementById('searchInput');
        const mainContent = document.getElementById('main-content');
        const header = document.getElementById('header');
        const modalPopup = document.getElementById('modalPopup');

        function toggleMenu() { navLinks.classList.toggle('active'); }
        function closeMenu() { navLinks.classList.remove('active'); }

        window.addEventListener('scroll', () => header.classList.toggle('scrolled', window.scrollY > 20));

        const API_BASE = 'https://ophim1.com/v1/api';
        const IMG_BASE = 'https://img.ophim1.com/uploads/movies/';

        async function fetchAPI(endpoint) {
            try { return await (await fetch('https://ophim1.com/v1/api' + endpoint)).json(); } catch { return null; }
        }

        // --- CẤU HÌNH TOP 5 THỦ CÔNG ---
        const MANUAL_TOP_5 = [
            "yet-hi",
            "tieng-yeu-nay-anh-dich-duoc-khong", 
            "con-say-mua-xuan",
            "kho-do-danh",
            "nu-hoang-nuoc-mat" 
        ];

        // 1. TẠO HTML TOP 5 (GIAO DIỆN CHUẨN POSTER TRÊN - THÔNG TIN DƯỚI)
        window.createTop10HTML = function(movie, index) {
            let displayImg = movie.poster_url; 
            if (!displayImg || displayImg === "") displayImg = movie.thumb_url;
            if (!displayImg.startsWith('http')) displayImg = `${IMG_BASE}${displayImg}`;
            
            const playLink = `/xem-phim/${movie.slug}`;
            const rank = index + 1; 

            return `
                <div class="top-card-style2" onclick="window.location.href='${playLink}'">
                    <div class="top-poster-style2">
                        <img src="${displayImg}" loading="lazy" alt="${movie.name}">
                        <div style="position:absolute; top:10px; right:10px; background:var(--primary-color); color:#fff; font-size:0.7rem; font-weight:800; padding:2px 6px; border-radius:4px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                            ${movie.quality || 'HD'}
                        </div>
                    </div>
                    
                    <div class="top-info-row">
                        <div class="top-rank-style2">${rank}</div>
                        <div class="top-text-style2">
                            <div class="top-title-style2">${movie.name}</div>
                            <div class="top-meta-style2">${movie.origin_name} (${movie.year})</div>
                        </div>
                    </div>
                </div>`;
        }

        // HÀM TẢI TOP 10
        async function loadManualTop10() {
            const promises = MANUAL_TOP_5.map(slug => fetchAPI(`/phim/${slug}`));
            const results = await Promise.all(promises);
            const validMovies = results
                .filter(res => res && res.status && res.data && res.data.item)
                .map(res => res.data.item);

            if (validMovies.length > 0) {
                const section = document.createElement('section');
                section.className = 'top-10-wrapper';
                const rowId = 'row-top-10';

                section.innerHTML = `
                    <div class="top-10-header">
                        <i class="fas fa-fire" style="color: #FF5E62; font-size: 2rem;"></i>
                        <h2>TOP 5 THỊNH HÀNH</h2>
                    </div>
                    
                    <div class="top-5-grid">
                        ${validMovies.map((m, i) => window.createTop10HTML(m, i)).join('')}
                    </div>
                `;
                mainContent.prepend(section);
            }
        }

        // 2. TẠO HTML CHO CARD THƯỜNG
        window.createCardHTML = function(movie) {
            let imgUrl = movie.thumb_url;
            if (!imgUrl.startsWith('http')) imgUrl = `${IMG_BASE}${movie.thumb_url}`;
            const playLink = `/xem-phim/${movie.slug}`;

            return `
                <div class="movie-card" onclick="window.location.href='${playLink}'">
                    <img src="${imgUrl}" alt="${movie.name}" class="movie-poster" loading="lazy">
                    <div class="card-overlay"></div>
                    <div class="card-info">
                        <div class="movie-name">${movie.name}</div>
                        <div class="movie-meta">
                            <span class="badge-hd">${movie.quality || 'HD'}</span>
                            <span>${movie.year}</span>
                            <span class="dot"></span>
                            <span>${movie.lang || 'Vietsub'}</span>
                        </div>
                    </div>
                    <div class="hover-actions">
                        <button class="btn-hover-play"><i class="fas fa-play"></i></button>
                        <button class="btn-hover-play" onclick="event.stopPropagation(); addToMyList('${movie.slug}', '${movie.name}', '${movie.thumb_url}')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>`;
        }

        window.createHistoryCardHTML = function(movie, timeLabel) {
            let imgUrl = movie.thumb_url;
            if (!imgUrl.startsWith('http')) imgUrl = `${IMG_BASE}${movie.thumb_url}`;
            const playLink = `/xem-phim/${movie.slug}`;
            const safeTime = timeSince(movie.timestamp);

            return `
                <div class="movie-card" onclick="window.location.href='${playLink}'">
                    <img src="${imgUrl}" alt="${movie.name}" class="movie-poster" loading="lazy">
                    <div class="card-overlay"></div>
                    <div class="card-info">
                        <div class="movie-name">${movie.name}</div>
                        <div class="movie-meta">
                            <i class="fas fa-clock" style="color:var(--primary-color); margin-right:5px"></i>
                            <span style="color: #ddd; font-weight: 500;">${safeTime}</span>
                        </div>
                    </div>
                    <div class="hover-actions">
                        <button class="btn-hover-play"><i class="fas fa-play"></i></button>
                        <button class="btn-hover-delete" onclick="event.stopPropagation(); removeFromHistory('${movie.slug}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>`;
        }

        window.slide = function(id, dir) {
            const row = document.getElementById(id);
            row.scrollBy({ left: dir * row.clientWidth * 0.8, behavior: 'smooth' });
        }

        function createMovieRow(title, movies, slugForSeeAll) {
            const section = document.createElement('section');
            section.className = 'category-section';
            const rowId = 'row-' + Math.random().toString(36).substr(2, 9);
            section.innerHTML = `
                <div class="category-header">
                    <h2 class="category-title text-gradient">${title}</h2>
                    ${slugForSeeAll ? `<a class="see-all-link" onclick="openModal('${slugForSeeAll}', '${title}')">Xem tất cả <i class="fas fa-chevron-right"></i></a>` : ''}
                </div>
                <div class="slider-container">
                    <button class="slider-arrow arrow-left" onclick="window.slide('${rowId}', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="movie-row" id="${rowId}">${movies.map(window.createCardHTML).join('')}</div>
                    <button class="slider-arrow arrow-right" onclick="window.slide('${rowId}', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>`;
            return section;
        }

        async function loadHome() {
            try {
                mainContent.innerHTML = ''; 
                await loadManualTop10(); // Tải Top 10 trước

                const [home, bo, han, hoat] = await Promise.all([
                    fetchAPI('/home'), 
                    fetchAPI('/danh-sach/phim-bo'),
                    fetchAPI('/quoc-gia/han-quoc'), 
                    fetchAPI('/danh-sach/hoat-hinh')
                ]);
                
                if(home?.data?.items) mainContent.appendChild(createMovieRow('Phim Mới Cập Nhật', home.data.items));
                if(bo?.data?.items) mainContent.appendChild(createMovieRow('Phim Bộ Tuyển Chọn', bo.data.items, '/danh-sach/phim-bo'));
                if(han?.data?.items) mainContent.appendChild(createMovieRow('K-Drama', han.data.items, '/quoc-gia/han-quoc'));
                if(hoat?.data?.items) mainContent.appendChild(createMovieRow('Anime', hoat.data.items, '/danh-sach/hoat-hinh'));

            } catch(e) { console.log(e); } 
            finally { hideLoading(); }
        }

        async function loadCategory(slug, title) {
            // Xử lý API cho thể loại (the-loai) và quốc gia (quoc-gia)
            // API mẫu: /the-loai/hanh-dong, /quoc-gia/han-quoc
            let prefix = 'danh-sach'; 
            if(['han-quoc','trung-quoc','au-my','nhat-ban','thai-lan','dai-loan','hong-kong','an-do','viet-nam'].includes(slug)) prefix = 'quoc-gia';
            else if(['hanh-dong','tinh-cam','hai-huoc','co-trang','tam-ly','hinh-su','chien-tranh','the-thao','vo-thuat','vien-tuong','phieu-luu','khoa-hoc','kinh-di','am-nhac','than-thoai','tai-lieu','gia-dinh','hoc-duong'].includes(slug)) prefix = 'the-loai';
            
            const data = await fetchAPI(`/${prefix}/${slug}`);
            mainContent.innerHTML = '';
            if(data?.data?.items) mainContent.appendChild(createMovieRow(title, data.data.items));
        }
        async function loadCountry(slug, title) { loadCategory(slug, title); }

        async function openModal(slug, title) {
            document.getElementById('modalTitle').innerText = title;
            modalPopup.classList.add('active');
            const data = await fetchAPI(slug + '?page=1');
            const container = document.getElementById('modalContent');
            container.innerHTML = data?.data?.items ? data.data.items.map(window.createCardHTML).join('') : 'Trống';
        }
        function closeModal() { modalPopup.classList.remove('active'); }

        let timeout = null;
        searchInput.addEventListener('keyup', (e) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                if(e.target.value.length > 2) {
                    fetchAPI(`/tim-kiem?keyword=${e.target.value}`).then(data => {
                        mainContent.innerHTML = '';
                        if(data?.data?.items) mainContent.appendChild(createMovieRow(`Kết quả: ${e.target.value}`, data.data.items));
                    });
                } else if(e.target.value.length === 0) loadHome();
            }, 500);
        });

        loadHome();
    </script>
</body>
</html>