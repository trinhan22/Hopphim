<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HopPhim - Phim Hay Trong Tầm Tay</title>
    
    <meta property="og:title" content="HopPhim" />
    <meta property="og:image" content="https://hopphim.netlify.app/panel.webp" />
    
    <link rel="icon" type="image/webp" href="/LOGO.WEBP" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==========================================================================
           1. CSS CORE & VARIABLES (DESIGN SYSTEM)
           ========================================================================== 
        */
        :root {
            --bg-body: #191b24; 
            --bg-dark: #0f111a; 
            --bg-panel: #23252f; 
            --text-main: #ffffff; 
            --text-sub: #a0a0a0;
            --gradient-main: linear-gradient(135deg, #FF8F50 0%, #FF5E62 100%); 
            --primary-color: #FF5E62;
            --gold-color: linear-gradient(90deg, #FF8F50, #FF5E62);
            --font-main: 'Inter', sans-serif; 
            --card-radius: 12px;
            --mobile-menu-bg: #15171e; 
            --mobile-border: rgba(255,255,255,0.05);
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --z-header: 5000;
            --z-modal: 10000;
            --z-hover-detail: 99999;
        }

        /* Basic Resets */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            outline: none; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            font-family: var(--font-main); 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            overflow-x: hidden; 
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        a { text-decoration: none; color: inherit; transition: var(--transition-smooth); }
        ul { list-style: none; }
        button { border: none; cursor: pointer; font-family: var(--font-main); }

        /* Custom Scroller cho toàn trang */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* ==========================================================================
           2. UTILITY CLASSES & KEYFRAMES
           ========================================================================== 
        */
        .text-gradient { 
            background: var(--gradient-main); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            display: inline-block; 
            font-weight: 800;
        }

        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(1.1); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes floatIdle { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }
        @keyframes rotateBlur { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ==========================================================================
           3. TOAST & CONFIRM COMPONENTS
           ========================================================================== 
        */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 20000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { 
            background: #23252f; color: #fff; padding: 12px 22px; border-radius: 12px; 
            display: flex; align-items: center; gap: 12px; min-width: 280px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-left: 4px solid var(--primary-color); 
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1); pointer-events: auto; 
        }
        .toast.success { border-left-color: #2ecc71; }
        .toast.error { border-left-color: #ff4757; }

        .custom-confirm-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            z-index: 20001; display: none; justify-content: center; align-items: center; 
            opacity: 0; transition: 0.3s; backdrop-filter: blur(8px); 
        }
        .custom-confirm-overlay.active { display: flex; opacity: 1; }
        .confirm-box { 
            background: #1f222e; width: 90%; max-width: 400px; padding: 35px; 
            border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.1); 
            transform: scale(0.9); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        }
        .confirm-icon { font-size: 3rem; margin-bottom: 15px; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* ==========================================================================
           4. LOADING SCREEN
           ========================================================================== 
        */
        #loadingScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--bg-body); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .loading-img { width: 800px; max-width: 80vw; height: auto; object-fit: contain; animation: zoomIn 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards, floatIdle 4s ease-in-out infinite 0.8s; }
        .loading-img.zoom-out { animation: zoomOut 0.5s cubic-bezier(0.6, -0.28, 0.74, 0.05) forwards !important; }
        @media (max-width: 900px) { .loading-img { width: 500px; } }
        @keyframes zoomIn { 0% { transform: scale(1.1); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes floatIdle { 0% { transform: scale(1); } 50% { transform: scale(0.85); } 100% { transform: scale(1); } }
        @keyframes zoomOut { from { transform: scale(1); opacity: 1; } to { transform: scale(2.2); opacity: 0; } }

        /* ==========================================================================
           5. HEADER (REMOBILE MASTER: 3-BAR - LOGO - SEARCH)
           ========================================================================== 
        */
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; padding: 0 4%; 
            display: flex; justify-content: space-between; align-items: center; 
            z-index: 1000; background: transparent; transition: all 0.3s ease-in-out; 
        }
        header.scrolled { background: var(--bg-dark); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        
        .header-left-group { display: flex; align-items: center; gap: 30px; height: 100%; }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; z-index: 1002; }
        .logo img { height: 40px; object-fit: contain; }
        .logo-text { font-size: 1.5rem; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        /* Nav Links */
        .nav-links { display: flex; gap: 15px; list-style: none; height: 100%; align-items: center; }
        
        /* Item của Menu */
        .nav-item { 
            position: relative; height: 100%; display: flex; align-items: center; 
            padding: 0 10px; cursor: pointer;
        }
        
        .nav-link { 
            color: #ccc; text-decoration: none; font-size: 14px; font-weight: 600; 
            text-transform: uppercase; transition: 0.3s; white-space: nowrap; 
            display: flex; align-items: center; gap: 5px;
        }
        .nav-item:hover .nav-link { color: #fff; }
        .nav-link i { font-size: 0.8rem; margin-top: -2px; }

        /* DROPDOWN MENU (BẢNG XỔ XUỐNG) */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 70px; /* Bằng chiều cao header */
            left: 0;
            background: rgba(15, 17, 26, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-top: 2px solid var(--primary-color);
            padding: 20px;
            border-radius: 0 0 12px 12px;
            width: 500px; /* Chiều rộng bảng */
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform-origin: top left;
            animation: fadeIn 0.2s ease-out;
        }

        .dropdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Cột */
            gap: 12px;
        }

        .dropdown-item-link {
            color: #a0a0a0; text-decoration: none; font-size: 0.9rem; transition: 0.2s;
            padding: 5px 8px; border-radius: 6px;
        }
        .dropdown-item-link:hover {
            color: #fff; background: rgba(255,255,255,0.1);
        }

        /* Hover vào Nav Item thì hiện Dropdown */
        .nav-item:hover .dropdown-menu { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .right-elements { display: flex; align-items: center; gap: 15px; }
        .search-box { display: flex; align-items: center; background: #23252f; padding: 8px 16px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); }
        .search-box input { background: transparent; border: none; color: #fff; margin-left: 10px; font-family: var(--font-main); font-size: 14px; width: 150px; }
        .menu-toggle, .mobile-search-trigger { display: none; font-size: 1.5rem; color: #fff; cursor: pointer; }
        
        .btn-login { background: var(--gradient-main); color: #fff; border: none; padding: 8px 20px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: 0.3s; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary-color); cursor: pointer; display: none; object-fit: cover; }
        .user-dropdown { position: absolute; top: 100%; right: 0; width: 200px; margin-top: 15px; background: #23252f; border-radius: 8px; padding: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: none; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .user-dropdown.active { display: flex; }
        .user-info-item { padding: 12px; color: #fff; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .dropdown-item { background: transparent; border: none; color: #ccc; text-align: left; padding: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        
        /* --- MOBILE HEADER REMASTER (3-PART ARCHITECTURE) --- */
        @media (max-width: 900px) {
            header { height: 65px; padding: 0 15px; justify-content: center; position: fixed; width: 100%; display: flex; align-items: center; background: var(--bg-dark); }
            .header-left-group, .nav-links, .search-box, .desktop-auth { display: none !important; }
            
            /* Hamburger Trái Tuyệt Đối */
            .menu-toggle { 
                display: block !important; position: absolute; left: 15px; 
                font-size: 1.6rem; color: #fff; cursor: pointer; z-index: 5005;
            }
            /* Logo Giữa Tuyệt Đối */
            .logo { 
                position: absolute; left: 50%; top: 50%; 
                transform: translate(-50%, -50%); margin: 0; 
                display: flex !important; z-index: 5000;
            }
            .logo img { height: 32px; }
            .logo-text { font-size: 1.1rem; }
            /* Search Phải Tuyệt Đối */
            .mobile-search-trigger { 
                display: block !important; position: absolute; right: 15px; 
                font-size: 1.4rem; color: #fff; cursor: pointer; z-index: 5005;
            }
        }

        .right-elements { display: flex; align-items: center; gap: 20px; }
        .search-box { 
            display: flex; align-items: center; background: rgba(255,255,255,0.08); 
            padding: 8px 18px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); 
        }
        .search-box input { background: transparent; border: none; color: #fff; margin-left: 10px; width: 160px; font-weight: 500; }
        
        .btn-login { background: var(--gradient-main); color: #fff; border: none; padding: 10px 25px; border-radius: 50px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255, 94, 98, 0.4); }
        .user-avatar { width: 42px; height: 42px; border-radius: 50%; border: 2.5px solid var(--primary-color); cursor: pointer; display: none; object-fit: cover; }
        
        .user-dropdown { 
            position: absolute; top: 110%; right: 0; width: 220px; background: #23252f; 
            border-radius: 15px; padding: 10px; box-shadow: 0 15px 40px rgba(0,0,0,0.6); 
            display: none; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); 
        }
        .user-dropdown.active { display: flex; }

        /* ==========================================================================
           6. HERO SECTION & TOPICS (GLASS REDESIGN)
           ========================================================================== 
        */
        .hero { 
            height: 75vh; display: flex; align-items: center; justify-content: center; 
            position: relative; background: url('home-background.jpg') center/cover no-repeat;
        }
        .hero::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.3); }
        .hero::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 300px; 
            background: linear-gradient(to bottom, transparent, var(--bg-body)); 
        }
        .hero-content { position: relative; z-index: 10; text-align: center; max-width: 1000px; padding: 20px; }
        .hero-title { font-size: 5rem; font-weight: 900; line-height: 1.1; letter-spacing: -3px; }
        .hero-desc { font-size: 1.4rem; color: #eee; font-weight: 600; margin-top: 20px; }

        .topics-section { padding: 0 4%; margin-top: -60px; position: relative; z-index: 20; margin-bottom: 60px; }
        .section-label { font-size: 1.4rem; font-weight: 800; margin-bottom: 25px; color: #fff; }

        .topic-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 20px; }

        .topic-card { 
            height: 115px; border-radius: 20px; padding: 22px; 
            display: flex; flex-direction: column; justify-content: space-between; 
            cursor: pointer; position: relative; overflow: hidden; 
            transition: var(--transition-smooth);
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }

        .topic-card:hover { transform: translateY(-10px); border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4); }

        .topic-card::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 120px; height: 120px; border-radius: 50%;
            transform: translate(-50%, -50%);
            filter: blur(35px); opacity: 0.4; z-index: 1; transition: 0.6s ease;
        }
        .topic-card:hover::before { width: 160px; height: 160px; opacity: 0.7; }

        .topic-card i.floating-icon {
            position: absolute; bottom: -10px; right: -5px;
            font-size: 4rem; color: rgba(255, 255, 255, 0.05);
            transform: rotate(-15deg); transition: 0.5s; z-index: 1;
        }
        .topic-card:hover i.floating-icon { color: rgba(255, 255, 255, 0.1); transform: rotate(0deg) scale(1.1); }

        .topic-name { font-size: 1.3rem; font-weight: 900; z-index: 2; position: relative; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .topic-link { font-size: 0.8rem; font-weight: 800; display: flex; align-items: center; gap: 6px; z-index: 2; position: relative; color: rgba(255,255,255,0.7); }
        .bg-marvel::before { background: #ed1d24; }
        .bg-sitcom::before { background: #00d2ff; }
        .bg-voice::before { background: #a8ff78; }
        .bg-trans::before { background: #8e44ad; }
        .bg-ancient::before { background: #f1c40f; }
        .bg-4k::before { background: #ffffff; }

        /* ==========================================================================
           7. MERGED COUNTRY BLOCK (KỸ THUẬT LÚ HOÀN TOÀN - PORTAL STYLE)
           ========================================================================== 
        */
        .merged-block { 
            background: var(--bg-panel); border-radius: 24px; margin: 0 4% 60px; 
            padding: 30px 45px; border: 1px solid rgba(255,255,255,0.05); 
            box-shadow: 0 25px 70px rgba(0,0,0,0.3);
            overflow: visible !important; 
            isolation: isolate;
        }

        .country-section { margin-bottom: 40px; position: relative; overflow: visible !important; }
        .country-section:last-child { margin-bottom: 0; }
        .country-section:not(:last-child) { border-bottom: 1px solid rgba(255,255,255,0.04); padding-bottom: 20px; }

        .country-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }
        .ch-title { font-size: 2.2rem; font-weight: 900; letter-spacing: -0.5px; }
        .ch-link { font-size: 1rem; color: var(--text-sub); display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 700; }

        .grid-wrapper { position: relative; width: 100%; overflow: visible !important; }
        
        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 50px; height: 50px; background: rgba(0,0,0,0.85);
            border: 1px solid rgba(255,255,255,0.15); color: #fff;
            border-radius: 50%; cursor: pointer; z-index: 1002;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: var(--transition-smooth); backdrop-filter: blur(5px);
        }
        .grid-wrapper:hover .nav-arrow { opacity: 1; }
        .arrow-prev { left: -25px; }
        .arrow-next { right: -25px; }
        .nav-arrow:hover { background: var(--primary-color); border-color: transparent; transform: translateY(-50%) scale(1.1); }

        /* FIXED: Kỹ thuật Buffer-Padding giúp Card lú ra không bị khuyết */
        /* FIXED: Padding-Compensation để bung lụa ra ngoài container */

.country-grid { 
    display: flex; 
    flex-wrap: nowrap; 
    gap: 20px; 
    overflow-x: auto !important; 
    scroll-behavior: smooth; 
    scrollbar-width: none;
    /* Tạo vùng đệm 100px để Card Detail thoải mái "lú" ra */
    padding: 100px 0 !important; 
    margin: -100px 0 !important; 
}
.country-grid::-webkit-scrollbar { display: none; }


        /* Card System (PC: 4 Phim/Hàng) */

.n-card {
    flex: 0 0 calc(25% - 15px);
    position: relative; 
    aspect-ratio: 16/9; 
    border-radius: 10px; 
    cursor: pointer;
    transition: transform 0.4s ease; 
    background: #1a1c24;
    z-index: 10;
}

.n-poster { 
    width: 100%; height: 100%; 
    object-fit: cover; 
    border-radius: 10px; 
    display: block; 
}

        /* ======================== 
           REFINED MICRO HOVER DETAIL 
           ======================== */
.n-hover-detail {
    position: absolute; 
    top: -55%; /* Căn giữa card detail so với card gốc */
    left: -3%; 
    width: 106%; /* FIXED: Thu nhỏ chiều rộng tối đa */
    

    /* Hiệu ứng Kính lỏng cao cấp */
    background: rgba(20, 21, 26, 0.8) !important;
    backdrop-filter: blur(25px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(25px) saturate(180%) !important;


    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    box-shadow: 0 40px 100px rgba(0,0,0,1);

    
    opacity: 0; 
    visibility: hidden; 
    pointer-events: none;
    transform: scale(0.9); 
    transition: all 0.4s cubic-bezier(0.33, 1, 0.68, 1);
    z-index: 99999 !important; /* Luôn trên cùng */
    overflow: hidden;
}

.n-hover-detail::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255, 94, 98, 0.12) 0%, transparent 70%);
    animation: rotateBlur 12s linear infinite;
    z-index: -1;
}
.n-card:hover { z-index: 99998; }

.n-card:hover .n-hover-detail { 
    opacity: 1; 
    visibility: visible; 
    transform: scale(1.03); /* Phóng to rất nhẹ nhàng */
    pointer-events: auto;
}
        .c-info { padding: 10px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); position: absolute; bottom: 0; left: 0; width: 100%; border-radius: 0 0 10px 10px; }
        .n-card:hover .c-info { opacity: 0; }
        .c-title { font-weight: 800; font-size: 0.9rem; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .n-hover-img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
.n-popup-body { 
    padding: 12px 15px !important; /* Thu nhỏ không gian bên trong */
    background: linear-gradient(to bottom, transparent, rgba(15, 17, 26, 0.8));
}
.n-actions { display: flex; gap: 8px; margin-bottom: 10px; }     
        /* FIXED: Micro Buttons */
.btn-play-now {
    flex: 1; 
    background: var(--gradient-main); 
    color: #fff; 
    padding: 6px !important; 
    border-radius: 6px;
    font-weight: 800; 
    font-size: 0.75rem !important; /* Chữ siêu nhỏ gọn */
    display: flex; align-items: center; justify-content: center; gap: 5px;
}
.btn-icon-round {
    width: 28px !important; 
    height: 28px !important; 
    border-radius: 50%; 
    border: 1.5px solid rgba(255,255,255,0.2) !important;
    background: rgba(255,255,255,0.05);
    font-size: 0.8rem !important;
}

        /* FIXED: Compact Typography */
.n-title { 
    font-weight: 900; 
    font-size: 0.95rem !important; /* Tiêu đề nhỏ lại */
    margin-bottom: 4px; 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.n-desc { 
    font-size: 0.7rem !important; /* Mô tả nhỏ và mờ tinh tế */
    color: rgba(255, 255, 255, 0.5) !important;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; 
    overflow: hidden; line-height: 1.4; 
}
.n-meta-row { 
    display: flex; align-items: center; gap: 10px; 
    font-size: 0.7rem !important; /* Meta row nhỏ lại */
    color: #46d369; font-weight: 800; margin-bottom: 10px; 
}
.badge-hd { 
    border: 1px solid #555; padding: 0px 4px; border-radius: 2px; 
    color: #fff; font-size: 0.55rem !important; 
}
        /* ==========================================================================
           8. TOP 5 TRENDING (BALANCED RANK NUMBERS)
           ========================================================================== 
        */
        .top-10-wrapper { position: relative; z-index: 20; padding: 0 4% 80px; }
        .top-10-header { display: flex; align-items: center; gap: 20px; margin-bottom: 45px; }
        .top-10-header h2 { font-size: 2.8rem; font-weight: 900; font-style: italic; letter-spacing: -1px; text-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .top-5-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 25px; }

        .top-card-style2 { position: relative; cursor: pointer; transition: 0.4s ease; width: 100%; }
        .top-card-style2:hover { transform: translateY(-15px); }
        .top-poster-style2 { 
            width: 100%; aspect-ratio: 2/3; border-radius: 18px; overflow: hidden; position: relative; 
            box-shadow: 0 15px 45px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.08); 
        }
        .top-poster-style2 img { width: 100%; height: 100%; object-fit: cover; }
        
        .top-info-row { display: flex; align-items: flex-start; margin-top: 25px; }
        
        /* Rank numbers: 3.8rem */
        .top-rank-style2 { 
            font-size: 3.8rem; 
            line-height: 0.8; font-family: 'Impact', sans-serif; font-style: italic; font-weight: 900; 
            color: #eebb5d; margin-right: 15px; text-shadow: 3px 3px 0px #000; flex-shrink: 0; 
        }
        .top-text-style2 { flex: 1; padding-top: 5px; }
        .top-title-style2 { font-size: 1.1rem; font-weight: 800; color: #fff; margin-bottom: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .top-meta-style2 { font-size: 0.95rem; color: #777; font-weight: 600; }

        /* ==========================================================================
           9. MODAL & FOOTER (CENTERED MOBILE)
           ========================================================================== */
        footer { background: var(--bg-dark); padding: 60px 4% 20px; margin-top: 80px; border-top: 1px solid #23252f; font-size: 0.9rem; }
        .footer-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 40px; margin-bottom: 40px; }
        .footer-col h3 { font-size: 1.1rem; color: #fff; margin-bottom: 20px; font-weight: 700; }
        .footer-brand { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .footer-brand img { height: 50px; object-fit: contain; }
        .footer-col ul { list-style: none; } .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: var(--text-sub); text-decoration: none; transition: 0.3s; } .footer-col ul li a:hover { color: var(--primary-color); padding-left: 5px; }
        .footer-bottom { border-top: 1px solid #23252f; padding-top: 20px; display: flex; justify-content: space-between; align-items: center; color: #64748b; font-size: 0.8rem; }
        .modal { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(15, 17, 26, 0.95); padding: 40px; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .modal-grid .movie-card { width: 100%; height: 280px; }

        @media (max-width: 900px) {
            /* FIXED: Footer căn giữa mobile hoàn toàn */
            .footer-grid { grid-template-columns: 1fr; gap: 40px; text-align: center; }
            .footer-col ul { display: flex; flex-direction: column; align-items: center; }
            .footer-brand { justify-content: center; }

            .hero-title { font-size: 3rem; }
            .topic-grid { display: flex; overflow-x: auto; scrollbar-width: none; }
            .topic-card { flex: 0 0 160px; height: 95px; }
            
            .merged-block { padding: 35px 20px; border-radius: 0; margin: 0 0 40px; }
            .country-grid { gap: 15px; padding: 5px 0; }
            .n-card { flex: 0 0 260px; }
            .nav-arrow { display: none; } 

            .top-10-header h2 { font-size: 2rem; }
            .top-5-grid { display: flex !important; flex-wrap: nowrap !important; overflow-x: auto !important; gap: 15px; padding-bottom: 20px; scrollbar-width: none; }
            .top-card-style2 { flex: 0 0 160px; }
            .top-rank-style2 { font-size: 3.2rem !important; }

            .modal-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
        }

        /* Mobile Drawer */
        .mobile-overlay { position: fixed; inset: 0; z-index: 10000; transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1); }
        #mobileMenuOverlay { background: var(--mobile-menu-bg); transform: translateX(-100%); padding: 30px; width: 320px; box-shadow: 20px 0 60px rgba(0,0,0,0.8); }
        #mobileMenuOverlay.active { transform: translateX(0); }


/* Nút xoá lịch sử đặt bên trong Detail Card */
.btn-remove-history {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 28px; /* Micro size */
    height: 28px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 1.5px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 100; /* Luôn trên cùng của card detail */
    transition: 0.3s;
    font-size: 0.8rem;
}

.btn-remove-history:hover {
    background: #ff4757;
    border-color: transparent;
    transform: scale(1.1);
}
    </style>
</head>
<body>

    <div id="loadingScreen">
        <img src="/Loading.png" class="loading-img" alt="HopPhim">
    </div>

    <div id="toast-container"></div>

    <div id="confirmModal" class="custom-confirm-overlay">
        <div class="confirm-box">
            <div class="confirm-icon"><i class="fas fa-question-circle"></i></div>
            <h3 style="color:#fff; font-size:1.6rem; margin-bottom:12px;">Xác nhận</h3>
            <p id="confirmMsg" style="color:#888; font-size:1.05rem;">Bạn có chắc chắn muốn thực hiện hành động này?</p>
            <div class="confirm-actions" style="margin-top:25px;">
                <button class="btn-confirm btn-cancel" id="btnConfirmNo">Hủy bỏ</button>
                <button class="btn-confirm btn-ok" id="btnConfirmYes">Đồng ý</button>
            </div>
        </div>
    </div>

    <div id="mobileMenuOverlay" class="mobile-overlay">
        <div class="menu-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
            <div class="menu-logo" style="display:flex; align-items:center; gap:10px; font-weight:900;"><img src="/LOGO.WEBP" style="height:35px;"><span class="logo-text text-gradient">HOPPHIM</span></div>
            <i class="fas fa-times" onclick="closeMobileMenu()" style="font-size:1.8rem; color:#fff; cursor:pointer;"></i>
        </div>
        <button class="member-btn-large" id="mobileMemberBtn" onclick="window.location.href='/login.html'" style="width:100%; padding:18px; background:rgba(255,255,255,0.05); border-radius:12px; border:1px solid rgba(255,255,255,0.1); color:#fff; font-weight:800; display:flex; align-items:center; gap:15px; margin-bottom:30px; cursor:pointer;">
            <i class="fas fa-user-circle" style="font-size:1.8rem; color:var(--primary-color)"></i> 
            <span id="mobileMemberText">Đăng nhập / Đăng ký</span>
        </button>
        <div class="mobile-menu-list">
            <a href="/" class="mobile-menu-link" style="padding:15px 0; display:block; font-weight:700; color:#bbb;"><i class="fas fa-home" style="margin-right:15px; color:var(--primary-color)"></i> Trang chủ</a>
            <a href="#" onclick="loadCategory('phim-moi', 'Phim Mới')" class="mobile-menu-link" style="padding:15px 0; display:block; font-weight:700; color:#bbb;"><i class="fas fa-bolt" style="margin-right:15px; color:var(--primary-color)"></i> Phim Mới</a>
            <a href="#" onclick="loadCategory('phim-bo', 'Phim Bộ')" class="mobile-menu-link" style="padding:15px 0; display:block; font-weight:700; color:#bbb;"><i class="fas fa-tv" style="margin-right:15px; color:var(--primary-color)"></i> Phim Bộ</a>
            <a href="#" onclick="loadCategory('phim-le', 'Phim Lẻ')" class="mobile-menu-link" style="padding:15px 0; display:block; font-weight:700; color:#bbb;"><i class="fas fa-film" style="margin-right:15px; color:var(--primary-color)"></i> Phim Lẻ</a>
            <div style="margin:20px 0 8px; color:#444; font-size:0.75rem; font-weight:900; text-transform:uppercase; letter-spacing:1px;">Quản Lý</div>
            <a href="/hopteam" class="mobile-menu-link" style="padding:15px 0; display:block; font-weight:700; color:#bbb;"><i class="fas fa-users" style="margin-right:15px; color:var(--primary-color)"></i> Về HopTeam</a>
            <div id="mobileLogoutBtn" style="display:none; padding:15px 0; font-weight:700; color:#ff4757;" onclick="logout()"><i class="fas fa-sign-out-alt" style="margin-right:15px;"></i> Đăng xuất</div>
        </div>
    </div>

    <div id="mobileSearchOverlay" style="position:fixed; inset:0; z-index:10000; background:#0f111a; transform:translateY(-100%); opacity:0; padding:20px; transition:0.4s;">
        <div style="display:flex; align-items:center; background:#23252f; padding:15px 20px; border-radius:15px;">
            <i class="fas fa-search" style="color: #666;"></i>
            <input type="text" id="mobileSearchInput" style="flex:1; background:transparent; border:none; color:#fff; font-size:1.1rem; margin-left:10px;" placeholder="Tìm phim...">
            <i class="fas fa-times" onclick="closeMobileSearch()" style="color:#fff; cursor:pointer; margin-left: 15px;"></i>
        </div>
        <div id="mobileSearchResults" style="margin-top:20px;"></div>
    </div>

    <header id="siteHeader">
        <i class="fas fa-bars menu-toggle" style="display:none;" onclick="openMobileMenu()"></i>
        <div class="header-left-group">
            <div class="logo" onclick="loadHome()">
                <img src="/LOGO.WEBP" alt="Logo"><span class="logo-text text-gradient">HOPPHIM</span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li class="nav-item">
                    <a href="/" class="nav-link" onclick="loadHome()">Trang chủ</a>
                </li>
                
                <li class="nav-item">
                    <div class="nav-link">Thể loại <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu">
                        <div class="dropdown-grid">
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hanh-dong', 'Hành Động')">Hành Động</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tinh-cam', 'Tình Cảm')">Tình Cảm</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hai-huoc', 'Hài Hước')">Hài Hước</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('co-trang', 'Cổ Trang')">Cổ Trang</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tam-ly', 'Tâm Lý')">Tâm Lý</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hinh-su', 'Hình Sự')">Hình Sự</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('chien-tranh', 'Chiến Tranh')">Chiến Tranh</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('the-thao', 'Thể Thao')">Thể Thao</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vo-thuat', 'Võ Thuật')">Võ Thuật</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('vien-tuong', 'Viễn Tưởng')">Viễn Tưởng</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('phieu-luu', 'Phiêu Lưu')">Phiêu Lưu</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('khoa-hoc', 'Khoa Học')">Khoa Học</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('kinh-di', 'Kinh Dị')">Kinh Dị</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('am-nhac', 'Âm Nhạc')">Âm Nhạc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('than-thoai', 'Thần Thoại')">Thần Thoại</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('tai-lieu', 'Tài Liệu')">Tài Liệu</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('gia-dinh', 'Gia Đình')">Gia Đình</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCategory('hoc-duong', 'Học Đường')">Học Đường</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-le', 'Phim Lẻ')">Phim Lẻ</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('phim-bo', 'Phim Bộ')">Phim Bộ</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('hoat-hinh', 'Hoạt Hình')">Hoạt Hình</a></li>
                <li class="nav-item"><a href="#" class="nav-link" onclick="loadCategory('tv-shows', 'TV Shows')">TV Shows</a></li>

                <li class="nav-item">
                    <div class="nav-link">Quốc gia <i class="fas fa-caret-down"></i></div>
                    <div class="dropdown-menu" style="width: 400px;"> <div class="dropdown-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('trung-quoc', 'Trung Quốc')">Trung Quốc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('han-quoc', 'Hàn Quốc')">Hàn Quốc</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('nhat-ban', 'Nhật Bản')">Nhật Bản</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('thai-lan', 'Thái Lan')">Thái Lan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('au-my', 'Âu Mỹ')">Âu Mỹ</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('dai-loan', 'Đài Loan')">Đài Loan</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('hong-kong', 'Hồng Kông')">Hồng Kông</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('an-do', 'Ấn Độ')">Ấn Độ</a>
                            <a href="#" class="dropdown-item-link" onclick="loadCountry('viet-nam', 'Việt Nam')">Việt Nam</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item"><a class='nav-link' href='/hopteam'>Về HopTeam</a></li>
            </ul>
        </div>
        <div class="right-elements">
            <div class="mobile-search-trigger" onclick="openMobileSearch()"><i class="fas fa-search"></i></div>
            <div class="search-box"><i class="fas fa-search" style="color: #a0a0a0"></i><input type="text" id="searchInput" placeholder="Tìm kiếm phim..."></div>
            <div class="desktop-auth" style="position: relative;">
                <button id="btnLogin" class="btn-login" onclick="window.location.href='/login.html'">Đăng nhập</button>
                <img id="userAvatar" class="user-avatar" src="" alt="User" onclick="toggleUserDropdown()">
                <div id="userMenu" class="user-dropdown">
                    <div id="userNameDisplay" class="user-info-item">User</div>
                    <button class="dropdown-item" onclick="window.location.href='/profile.html'"><i class="fas fa-user-cog"></i> Tài khoản</button>
                    <button class="dropdown-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Đăng xuất</button>
                </div>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title"><span class="text-gradient">HopPhim - Phim Hay<BR>Trong Tầm Tay</span></h1>
            <p class="hero-desc">Xem phim chuẩn FHD Vietsub, cập nhật liên tục tại HopPhim.</p>
        </div>
    </section>

    <div class="topics-section">
        <div class="section-label">Gợi ý chủ đề</div>
        <div class="topic-grid">
            <div class="topic-card bg-marvel" onclick="loadCategory('hanh-dong', 'Marvel')"><i class="fab fa-quinscape floating-icon"></i><div class="topic-name">Marvel</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-sitcom" onclick="loadCategory('hai-huoc', 'Sitcom')"><i class="fas fa-laugh-squint floating-icon"></i><div class="topic-name">Sitcom</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-voice" onclick="loadCategory('hoat-hinh', 'Anime')"><i class="fas fa-shinto--gate floating-icon"></i><div class="topic-name">Anime</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-trans" onclick="loadCategory('vien-tuong', 'Viễn Tưởng')"><i class="fas fa-rocket floating-icon"></i><div class="topic-name">Viễn Tưởng</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-ancient" onclick="loadCategory('co-trang', 'Cổ Trang')"><i class="fas fa-dragon floating-icon"></i><div class="topic-name">Cổ Trang</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
            <div class="topic-card bg-4k" onclick="loadCategory('kinh-di', 'Kinh Dị')"><i class="fas fa-ghost floating-icon"></i><div class="topic-name">Kinh Dị</div><div class="topic-link">Xem ngay <i class="fas fa-arrow-right"></i></div></div>
        </div>
    </div>

    <div id="history-container"></div>

    <main id="main-content">
        <div class="merged-block">
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">Hàn Quốc</span></div><div class="ch-link" onclick="openModal('han-quoc', 'Phim Hàn Quốc')">Xem tất cả <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('koreaList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="koreaList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('koreaList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">Trung Quốc</span></div><div class="ch-link" onclick="openModal('trung-quoc', 'Phim Trung Quốc')">Xem tất cả <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('chinaList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="chinaList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('chinaList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="country-section">
                <div class="country-header"><div class="ch-title">Phim <span class="text-gradient">Thái Lan</span></div><div class="ch-link" onclick="openModal('thai-lan', 'Phim Thái Lan')">Xem tất cả <i class="fas fa-chevron-right"></i></div></div>
                <div class="grid-wrapper">
                    <button class="nav-arrow arrow-prev" onclick="scrollGrid('thaiList', -1)"><i class="fas fa-chevron-left"></i></button>
                    <div class="country-grid" id="thaiList"></div>
                    <button class="nav-arrow arrow-next" onclick="scrollGrid('thaiList', 1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </main>

    <section class="top-10-wrapper">
        <div class="top-10-header"><i class="fas fa-fire" style="color:var(--primary-color); font-size: 2.5rem;"></i><h2>TOP 5 THỊNH HÀNH</h2></div>
        <div class="top-5-grid" id="top5List"></div>
    </section>

    <div id="modalPopup" class="modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; border-bottom:1px solid #222; padding-bottom:20px;">
            <h2 id="modalTitle" class="text-gradient" style="font-size: 2rem;">Danh sách phim</h2>
            <i class="fas fa-times" onclick="closeModal()" style="font-size:2.5rem; color:#fff; cursor:pointer;"></i>
        </div>
        <div id="modalContent" class="modal-grid"></div>
    </div>

    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <div class="footer-brand"><img src="/logo.webp" alt="HopPhim"><span class="logo-text">HOPPHIM</span></div>
                <p style="color: #a0a0a0; line-height: 1.6; margin-top: 15px;">Trang xem phim trực tuyến miễn phí chất lượng cao.</p>
            </div>
            <div class="footer-col">
                <h3>Danh mục</h3>
                <ul>
                    <li><a href="#" onclick="loadCategory('phim-moi', 'Phim Mới Cập Nhật')">Phim Mới Cập Nhật</a></li>
                    <li><a href="#" onclick="loadCategory('phim-le', 'Phim Lẻ')">Phim Chiếu Rạp</a></li>
                    <li><a href="#" onclick="loadCategory('phim-bo', 'Phim Bộ')">Phim Bộ Độc Quyền</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Quốc gia</h3>
                <ul>
                    <li><a href="#" onclick="loadCountry('han-quoc', 'Hàn Quốc')">Hàn Quốc</a></li>
                    <li><a href="#" onclick="loadCountry('trung-quoc', 'Trung Quốc')">Trung Quốc</a></li>
                    <li><a href="#" onclick="loadCountry('au-my', 'Âu Mỹ')">Âu Mỹ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3>Hỗ trợ</h3>
                <ul>
                    <li><a href='/lienhequangcao'>Liên hệ quảng cáo</a></li>
                    <li><a href='/baoloi'>Báo lỗi</a></li>
                    <li><a href='/hopteam'>Về HopTeam</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom"><p>&copy; 2026 HopPhim. All Rights Reserved By HopTeam.</p></div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAT6SnKojUmsisDhnuEtsL3H59NwrhZxDc", authDomain: "hopphim-29e1c.firebaseapp.com", projectId: "hopphim-29e1c", storageBucket: "hopphim-29e1c.firebasestorage.app", messagingSenderId: "1076044580405", appId: "1:1076044580405:web:a3485f8533604f305e537c", measurementId: "G-6RT4CX2NR0" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // SPA Auth Logic
        onAuthStateChanged(auth, async (user) => {
            const btn = document.getElementById('btnLogin');
            const ava = document.getElementById('userAvatar');
            const mobileLogout = document.getElementById('mobileLogoutBtn');
            const mobileMemberText = document.getElementById('mobileMemberText');

            if (user) {
                window.currentUser = user;
                if(btn) btn.style.display = 'none';
                if(ava) { ava.style.display = 'block'; ava.src = user.photoURL || '/Guest.webp'; }
                document.getElementById('userNameDisplay').innerText = user.displayName;
                if(mobileMemberText) mobileMemberText.innerText = user.displayName;
                if(mobileLogout) mobileLogout.style.display = 'block';
                loadHistory(user.uid);
            } else {
                window.currentUser = null;
                if(btn) btn.style.display = 'block';
                if(ava) ava.style.display = 'none';
                if(mobileLogout) mobileLogout.style.display = 'none';
                document.getElementById('history-container').innerHTML = '';
            }
        });

        // AUTH FUNCTIONS
        window.logout = async () => {
            const ok = await window.customConfirm("Bạn có chắc muốn đăng xuất?");
            if(ok) {
                await signOut(auth);
                userMenu.classList.remove('active');
                closeMobileMenu();
                window.showToast("Đã đăng xuất!", "success");
            }
        }
        window.toggleUserDropdown = () => userMenu.classList.toggle('active');

        // --- WATCH HISTORY ENGINE ---
        window.saveToHistory = async (slug, name, thumb) => {
            if (!window.currentUser) return;
            const ref = doc(db, "users", window.currentUser.uid);
            try {
                const snap = await getDoc(ref);
                let history = snap.exists() ? (snap.data().watchHistory || []) : [];
                history = history.filter(m => m.slug !== slug);
                history.push({ slug, name, thumb_url: thumb, timestamp: Date.now() });
                if (history.length > 15) history.shift();
                if(snap.exists()) await updateDoc(ref, { watchHistory: history });
                else await setDoc(ref, { email: window.currentUser.email, watchHistory: history });
                loadHistory(window.currentUser.uid);
            } catch (e) { console.error(e); }
        };

        async function loadHistory(uid) {
            try {
                const snap = await getDoc(doc(db, "users", uid));
                if(snap.exists() && snap.data().watchHistory && snap.data().watchHistory.length > 0) {
                    window.renderHistoryRow(snap.data().watchHistory.reverse().slice(0, 8));
                }
            } catch(e) {}
        }

        window.addToMyList = async (slug, name, thumb) => {
            if (!window.currentUser) { window.showToast("Đăng nhập để lưu!", "error"); return; }
            const ref = doc(db, "users", window.currentUser.uid);
            const snap = await getDoc(ref);
            let list = snap.exists() ? (snap.data().myList || []) : [];
            if (list.some(m => m.slug === slug)) { window.showToast("Đã có!", "error"); return; }
            list.push({ slug, name, thumb_url: thumb, timestamp: Date.now() });
            if(snap.exists()) await updateDoc(ref, { myList: list }); else await setDoc(ref, { email: window.currentUser.email, myList: list });
            window.showToast(`Đã lưu: ${name}`);
        };

        window.toggleUserDropdown = () => document.getElementById('userMenu').classList.toggle('active');
    </script>

    <script>
        const API_BASE = 'https://ophim1.com/v1/api';
        const IMG_BASE = 'https://img.ophim1.com/uploads/movies/';

        // Unified Card Generator (Liquid Glass Integrated)
        window.createMovieCardHTML = (m, isHistory = false) => {
            const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
            const nameFixed = m.name.replace(/'/g, "\\'");
            return `
            <div class="n-card">
                <img src="${img}" class="n-poster" loading="lazy">
                <div class="n-hover-detail" onclick="saveToHistory('${m.slug}', '${nameFixed}','${m.thumb_url}'); window.location.href='/xem-phim/${m.slug}'">
                    <img src="${img}" class="n-hover-img">
                    <div class="n-popup-body">
                        <div class="n-actions">
                            <button class="btn-play-now"><i class="fas fa-play"></i> ${isHistory ? 'XEM TIẾP' : 'PHÁT NGAY'}</button>
                            <button class="btn-icon-round" onclick="event.stopPropagation(); addToMyList('${m.slug}', '${nameFixed}', '${m.thumb_url}')"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="n-title">${m.name}</div>
                        <div class="n-meta-row"><span class="match-score">98% phù hợp</span><span class="badge-hd">HD</span><span>${m.year || '2026'}</span></div>
                    </div>
                </div>
                <div class="c-info"><div class="c-title">${m.name}</div></div>
            </div>`;
        };

        // Render SPA History
window.renderHistoryRow = (movies) => {
    const container = document.getElementById('history-container');
    if(!movies || movies.length === 0) { container.innerHTML = ''; return; }
    
    let cards = '';
    movies.forEach(m => {
        const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
        cards += `
        <div class="n-card">
            <img src="${img}" class="n-poster">
            
            <div class="n-hover-detail">
                <button class="btn-remove-history" title="Xoá khỏi lịch sử" 
                        onclick="event.stopPropagation(); removeFromHistory('${m.slug}')">
                    <i class="fas fa-times"></i>
                </button>

                <img src="${img}" class="n-hover-img" onclick="window.location.href='/xem-phim/${m.slug}'">
                <div class="n-popup-body">
                    <div class="n-actions">
                        <button class="btn-play-now" onclick="window.location.href='/xem-phim/${m.slug}'">
                            <i class="fas fa-play"></i> XEM TIẾP
                        </button>
                    </div>
                    <div class="n-title">${m.name}</div>
                </div>
            </div>
            <div class="c-info"><div class="c-title">${m.name}</div></div>
        </div>`;
    });
    
    container.innerHTML = `
        <div class="merged-block" style="margin-top:0; padding-bottom:30px;">
            <div class="country-section" style="border:none;">
                <div class="country-header">
                    <div class="ch-title"><i class="fas fa-history" style="color:var(--primary-color)"></i> XEM TIẾP</div>
                </div>
                <div class="grid-wrapper">
                    <div class="country-grid">${cards}</div>
                </div>
            </div>
        </div>`;
}

        async function loadTop5() {
            const MANUAL_TOP_5 = ["con-ra-the-thong-gi-nua", "dia-nguc-doc-than-phan-5", "tieng-yeu-nay-anh-dich-duoc-khong", "con-say-mua-xuan", "kho-do-danh"];
            const container = document.getElementById('top5List');
            let html = '';
            for (let i = 0; i < MANUAL_TOP_5.length; i++) {
                try {
                    const res = await fetch(`${API_BASE}/phim/${MANUAL_TOP_5[i]}`);
                    const data = await res.json();
                    if(data.status) {
                        const m = data.data.item;
                        const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.poster_url;
                        html += `<div class="top-card-style2" onclick="window.location.href='/xem-phim/${m.slug}'"><div class="top-poster-style2"><img src="${img}"></div><div class="top-info-row"><div class="top-rank-style2">${i+1}</div><div class="top-text-style2"><div class="top-title-style2">${m.name}</div></div></div></div>`;
                    }
                } catch(e) {}
            }
            container.innerHTML = html;
        }

        async function loadCountrySection(slug, elementId) {
            try {
                const res = await fetch(`${API_BASE}/quoc-gia/${slug}?page=1`);
                const data = await res.json();
                if(data.data) {
                    let html = '';
                    data.data.items.slice(0, 16).forEach(m => html += window.createMovieCardHTML(m));
                    document.getElementById(elementId).innerHTML = html;
                }
            } catch(e) {}
        }

        window.scrollGrid = (id, direction) => {
            const el = document.getElementById(id);
            el.scrollBy({ left: direction * el.clientWidth, behavior: 'smooth' });
        };

        window.openModal = async (slug, title) => {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalPopup').classList.add('active');
            const res = await fetch(`${API_BASE}/quoc-gia/${slug}?page=1`);
            const data = await res.json();
            const container = document.getElementById('modalContent');
            let html = '';
            if(data.data) {
                data.data.items.forEach(m => {
                    const img = m.thumb_url.startsWith('http') ? m.thumb_url : IMG_BASE + m.thumb_url;
                    html += `<div class="modal-card" onclick="window.location.href='/xem-phim/${m.slug}'"><img src="${img}"><div style="padding:15px; font-weight:700; font-size:0.9rem;">${m.name}</div></div>`;
                });
            }
            container.innerHTML = html;
        }

        window.closeModal = () => document.getElementById('modalPopup').classList.remove('active');
        window.openMobileMenu = () => { document.getElementById('mobileMenuOverlay').classList.add('active'); }
        window.closeMobileMenu = () => { document.getElementById('mobileMenuOverlay').classList.remove('active'); }
        window.openMobileSearch = () => { document.getElementById('mobileSearchOverlay').classList.add('active'); }
        window.closeMobileSearch = () => { document.getElementById('mobileSearchOverlay').classList.remove('active'); }
        window.loadHome = () => window.location.href = '/';

        window.addEventListener('load', () => {
            loadTop5();
            loadCountrySection('han-quoc', 'koreaList');
            loadCountrySection('trung-quoc', 'chinaList');
            loadCountrySection('thai-lan', 'thaiList');
            setTimeout(() => document.getElementById('loadingScreen').style.display = 'none', 1000);
        });

        window.addEventListener('scroll', () => {
            document.getElementById('siteHeader').classList.toggle('scrolled', window.scrollY > 50);
        });
    </script>
</body>
</html>